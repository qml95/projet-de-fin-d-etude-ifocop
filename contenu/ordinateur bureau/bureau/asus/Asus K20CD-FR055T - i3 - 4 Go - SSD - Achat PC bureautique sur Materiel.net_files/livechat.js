!function(t){if("function"==typeof define&&define.amd){var e=define;define=t}!function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return r(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,n,i){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,i){function o(t){if("string"!=typeof t)return t;var e=/(?:^|[^\d])(\d{4}[\- ]?\d{4}[\- ]?\d{2}[\- ]?\d{2}[\- ]?\d{1,4})(?:[^\d]|$)/;return t.replace(e,"xxxx-xxxx-xxxx-xxxx")}function a(){"use strict";i("#idz_postmsg").prop("disabled",!1),i(".idz_writting").html(""),n.chat.disableLoading()}function s(){"use strict";!0!==i("#idz_postmsg").prop("disabled")&&(i("#idz_postmsg").prop("disabled",!0),i(".idz_writting").html(n.T("livechat.xmpp.connection.disconnected")))}function c(){"use strict";i(".idz_writting").html(""),n.chat.putOpAlert(n.T("CONNECTION_ERREUR"))}function u(t,e,r){var o=t.status,a=i.Deferred();if(n.opOffline=o.opOffline,n.c2cOffline=o.c2cOffline,n.opWatching=o.opWatching,n.opBusy=o.opBusy,n.initSession=!1,!o.opOffline){n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,m.room.join(n.conversationJid,n.vuid,10).done(function(){m.room.groupchat(e,r),a.resolve()},a.reject),setTimeout(function(){m.getConnection().connected&&n.chat.sendPresence("dnd")},2500);var s=h();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+s),_.emit("conversation.chat.started")}return(o.opOffline||o.opBusy)&&a.reject(),a.promise()}function l(t){var e=t.status;n.opOffline=e.opOffline,n.c2cOffline=e.c2cOffline,n.opBusy=e.opBusy,n.initSession=!1;var r=i.Deferred();if(e.opOffline)setTimeout(function(){n.setStatus()},400),n.chat.disableLoading();else{n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,m.room.join(n.conversationJid,n.vuid,10).done(function(){m.getConnection().connected&&n.chat.sendPresence("dnd"),r.resolve()},r.reject),n.operator=t.operator,-1===n.operator.id&&x.queue(),n.c2coperator=t.c2coperator?t.c2coperator:t.operator,n.on_call&&(n.operator=t.c2coperator);var o=h();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+o),_.emit("conversation.chat.started"),n.customize.floating_button>0&&n.floatingWidget.onPresenceChange(!0),n.vaSCI&&n.chat.sendAlert("!vaSCI","",!0)}return(e.opOffline||e.opBusy)&&r.reject(),r.promise()}function d(){var t="visitor";(n.flags.proactif_alert||n.flags.proactif_invit)&&(t="proactif"),n.callbacks.onChatStarted({id:n.chat.history_id,startedBy:t})}function f(t){return!g.isUndefined(t)&&(!!g.some(E,t)||(E.push(t),E.length>5&&E.shift(),!1))}function h(){var t=String(new Date),e=/\((.*)\)/.exec(t,"g");return!e||e.length<2?"":e[1]}if(!iAdvize.lock){var p,g=e("lodash"),m=n.require("xmpp"),v=n.require("logger"),_=n.require("eventManager"),b=_.events,y=n.require("emojis-service");_.on(b.OnXmppRoomJoined,function(){m.sendChatState("paused")}),_.on(b.OnXmppConnectionDisconnected,function(){s()}),_.on(b.OnXmppReconnectionFailed,function(){c()}),_.on(b.OnXmppConnectionConnected,function(){a()});var w,S;n.call.isEnabled&&(w=n.require("livechat/call")),n.callMeeting.enabled&&n.require("livechat/callmeeting"),1==n.preferences.mirroring_enabled&&(S=n.require("mirror"))&&S.listen&&S.listen(_),n.visio.enabled&&n.require("visio"),n.define("emitter",function(){function t(t){function e(){for(var e=-1,i=n.length;++e<i;)n[e].apply(this,arguments);return t}var n=[];return e.on=function(e){return n.push(e),t},e}return function(){for(var e=-1,n=arguments.length,i={};++e<n;)i[arguments[e]]=t(i);return i.on=function(t,e){return i[t].on(e)},i}}),n.noDefaultScrollTemplate="iphone"==n.customize.layout||"mobile"==n.customize.layout||"tablette"==n.customize.layout||"chomette"==n.customize.layout||"monoprix2"==n.customize.layout||"interflora-uk"==n.customize.layout||"natixis-caissedepargne-espaceclient"==n.customize.layout||"nexecur"==n.customize.layout||"vvf"==n.customize.layout||"sfr3"==n.customize.layout||"boursorama3"==n.customize.layout||"fortuneo2"==n.customize.layout||"mecatechnic2"==n.customize.layout||"mecatechnic3"==n.customize.layout||"carglass"==n.customize.layout||"autosphere2"==n.customize.layout||"nordnet2"==n.customize.layout||"flowercampings"==n.customize.layout||"neckermannreisen"==n.customize.layout||"dermacenter"==n.customize.layout||"cdiscountv4"==n.customize.layout||"groupalia"==n.customize.layout||"entega2"==n.customize.layout;var T=function(){if(n.Templates.newTemplates)n.noOfferPanelTemplate=n.Templates.isResponsive;else{var t=n.require("template").customizer;n.noOfferPanelTemplate=t.noOfferPanelTemplate(n.customize.layout)}return n.noOfferPanelTemplate};n.initSession=!1;var O=function(t,e){return t&&e?t.toLowerCase()===e.toLowerCase():t===e},C=function(){1!==n.chat.satisfaction?(2===n.chat.status?window.confirm(n.T("VISITOR_CONFIRM_CLOSE"))&&(n.flags.visio_status&&_.emit(b.OnConversationVisioClosed),-1===n.operator.id||1===n.virtualOP||"1"!==n.preferences.param_satisfaction||2===n.chat.satisfaction||2!==n.chat.status||n.blocked?(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})):(n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed()),n.chat.sendChatClose(),n.callbacks.onChatEnded({id:n.chat.history_id,endedBy:"visitor"})):(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})),n.chatbox_state=n.chat.CHATBOX_STATES.CHATBAR_HIDDEN):n.Templates.removeSatisfaction()};n.define("waiting",function(t){function e(){var t={jid:Strophe.getBareJidFromJid(m.getConnection().jid),sid:n.website_id,u:n.vuid,dep:n.forceDep,hid:n.chat.history_id};i.getJSON(n.chaturl+"rpc/waitinglist.php?callback=?",t).done(x.remind),r.update()}var r=t("emitter")("queue","unqueue","update");return{queue:function(){n.flags.waitinglist=1,n.chat.status=2,r.queue(),e()},unqueue:function(t){n.opBusy=0,n.flags.waitinglist=2,n.util.addScript("getop",n.chaturl+"rpc/getop.php?persist=1&sid="+n.website_id+"&u="+n.vuid+"&getop="+t),r.unqueue()},update:e,remind:function(t){var e=n.T(t.message||"waiting.reminder").replace(/\{queuepos\}/g,t.position);e=n.util.nl2br(n.util.htmlspecialchars(e)),e=n.Templates.opAlert.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,n.chat.getMsgTime()),n.chat.put_dialog(e),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"WAITING_LIST "+t.position)},justUnqueued:function(){var t=2===n.flags.waitinglist;return t&&(n.flags.waitinglist=0),t},on:r.on}});var x=n.require("waiting");n.playSound=function(t){var e='<embed src="'+n.chaturl+"sounds/swf.php?s="+n.website_id+"&q="+t+'" width="1" height="1" quality="high" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash">';i("#idz_sound_container").html(e)},n.onCoreLoaded=function(t){return n.coreloaded?("function"==typeof t&&t(),!1):(n.coreloaded=!0,i(document).keypress(function(t){27==t.keyCode&&t.preventDefault()}),n.chat.cCook=document.cookie,n.callbacks.onCookieSaved(),n.hasFocus=1,n.blinktm=null,n.oTitle=document.title,i(window).bind("scroll.activity",function(){n.onActivity()}),i(window.document).bind("keypress.activity",function(){n.onActivity()}),i("body").bind("mousemove.activity",function(){n.onActivity()}),i(window).focus(function(){n.hasFocus=1,null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null,document.title=n.oTitle)}),i(window).blur(function(){n.hasFocus=0,n.vStats.activeSince=null}),n.monitoredForms&&i("form").submit(function(t){if("post"==t.target.method.toLowerCase()){for(var e=n.monitoredForms.length;e--;)if(n.monitoredForms[e]==t.target.id){n.usePOST=t.target.id;break}}else n.usePOST=null}),n.onChatLoaded(t),!0)},n.onChatLoaded=function(t){if(!n.chatloaded){n.chatloaded=!0,n.chat.history_id=+n.flags.history_id,n.chat.prev_history=+n.flags.prev_history,n.chat.status=+n.flags.chat_status,n.chat.satisfaction=+n.flags.satisfaction_status,n.chat.cobrowsing=+n.flags.chat_cobrowsing,n.proactif_timeElapsed=n.flags.proactif_timeElapsed,n.proactif_activated=n.flags.proactif_activated,n.conversationJid=n.flags.conversationJid,n.chat.popinLeft=n.flags.popinLeft,n.chat.popinTop=n.flags.popinTop,n.callbacks.onScriptLoaded(),""===n.iframeID&&n.chat.bindWidgetEvents();var e=3===n.chat.status&&"0"===n.flags.operator_closed&&"1"===n.flags.visitor_closed;n.chat.history_id>0&&(2===n.chat.status||e)&&(_.on(b.OnXmppConnectionConnected,function(){m.room.join(n.conversationJid,n.vuid)}),m.connect(!0).fail(n.chat.showConnectionError));try{setTimeout(function(){n.Templates&&n.Templates.restoreState&&n.Templates.restoreState(),(n.chat.history_id>0||n.chat.prev_history>0)&&""==n.iframeID&&n.chat.reloadHistory(),2===n.chat.status&&"1"===n.flags.visio_status&&_.emit(b.OnConversationVisioRequested),i.each(["hideUI","hideDialog","minimizeChatbar"],function(t,e){var i=n.Templates[e];n.Templates[e]=function(){i.apply(n.Templates),n.callbacks.onChatHidden()}})},100)}catch(t){n.errorMailer("onChatLoaded try to connect: ",t,"")}}"function"==typeof t&&t()},n.transfer=function(t){var e=i.parseJSON(t);n.chat.putOpAlert(n.T("OPERATEUR_TRANSFER")),n.operator=e.operator,n.c2coperator=n.operator,n.chat.history_id=e.newConversationID,n.vStats.history_id=e.newConversationID,!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer());var r=h();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+e.newConversationID+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+e.newConversationID+"&u="+n.vuid+"&timezoneAbbr="+r),n.chat.sendPresence("available"),n.callbacks.onVisitorTransferred({operatorId:n.operator.id,historyId:n.chat.history_id})},n.createConversation=function(t,e,r,o,a){if(n.initSession)return i.Deferred().reject().promise();n.initSession=!0;var s={sid:n.website_id,vuid:n.vuid,dep:n.forceDep,r:n.flags.proactif_activatedId||0,nick:Strophe.getNodeFromJid(m.getConnection().jid),msg:e?encodeURIComponent(e):"",messageId:a,op:n.operator.id||0,o:n.forceAgent?n.forceAgent:0,h:n.forceAgent&&n.vStats.merpHash?n.vStats.merpHash:"",br:n.vStats.browserInfo||""};if(void 0!==window.idzCustomData&&(idzCustomData.page_type&&(s.pt=encodeURIComponent(idzCustomData.page_type)),idzCustomData.brand&&(s.pb=encodeURIComponent(idzCustomData.brand)),idzCustomData.rayon&&(s.pr=encodeURIComponent(idzCustomData.rayon)),idzCustomData.univers&&(s.pu=encodeURIComponent(idzCustomData.univers)),idzCustomData.cust_name&&(s.pcna=encodeURIComponent(idzCustomData.cust_name)),idzCustomData.cust_firstname&&(s.pcfn=encodeURIComponent(idzCustomData.cust_firstname)),idzCustomData.cust_address&&(s.pcad=encodeURIComponent(idzCustomData.cust_address)),idzCustomData.cust_city&&(s.pcci=encodeURIComponent(idzCustomData.cust_city)),idzCustomData.cust_zipcode&&(s.pczc=encodeURIComponent(idzCustomData.cust_zipcode)),idzCustomData.cust_country&&(s.pcco=encodeURIComponent(idzCustomData.cust_country)),idzCustomData.cust_phonenumber&&(s.pcpn=encodeURIComponent(idzCustomData.cust_phonenumber)),idzCustomData.cust_email&&(s.pcem=encodeURIComponent(idzCustomData.cust_email))),"visio"===t)return i.getJSON(n.chaturl+"rpc/visio.php",s);n.vaSCI&&(s.va=n.vaSCI),s.cd=window.idzCustomData||[];var c=n.routing.enabled?"init_routing.php":"init_session.php";return(p=i.getJSON(n.chaturl+"rpc/"+c+"?lang="+n.curlang+"&log_uuid="+r+"&callback=?",s)).then(function(t){return n.routing.enabled?u(t,e,a):l(t)})},n.doInit=function(){2!=n.chat.status?n.chat.sendPresence("available"):n.chat.sendPresence("dnd"),n.chat.connected=!0};var E=[],A={OPERATOR:1,VISITOR:2,OPERATOR_ALERT:3,VISITOR_ALERT:4,VISITOR_NAVIGATION:5,OPERATOR_RICH_CONTENT:6,VISITOR_RICH_CONTENT:7},I={HIDDEN:1,OPENED:2,MINIMIZED:3,CHATBAR_HIDDEN:4};n.chat={MESSAGE_TYPES:A,CHATBOX_STATES:I,chatbox_state:I.HIDDEN,status:0,history_id:0,composing:0,watch:0,connected:!1,reconnecting:!1,started:!1,cobrowsing:0,offercount:1,satisfaction:0,automatedStartMessageId:555,automatedEndMessageId:777,buildChat:function(){try{if(n.chatbuilt)return;n.chatbuilt=!0,n.Templates.loadChatCss(),_.emit("events.chatBuilt")}catch(t){}try{n.Templates.appendChat();var t=document.createElement("div");t.setAttribute("id","idz_sound_container"),i("body").append(t);var e=n.Templates.append2header();""!=e&&i("head").append(e)}catch(t){n.errorMailer("buildChat 2: ",t,"")}try{var r=n.T("BESOIN_AIDE"),o=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA"),a="message";if(n.customize["chatbar_txt1_"+n.curlang]&&0!=n.customize["chatbar_txt1_"+n.curlang].length&&(r=n.customize["chatbar_txt1_"+n.curlang]),n.customize["chatbar_txt2_"+n.curlang]&&0!=n.customize["chatbar_txt2_"+n.curlang].length){o=n.customize["chatbar_txt2_"+n.curlang];a="message_edit"}var s=n.Templates.getChatContent().replace(/\{CHATBAR_TXT1\}/g,r).replace(/\{CHATBAR_TXT2\}/g,o).replace(/\{CHATBAR_TITLE\}/g,a);i("#idz_chatglobal").html(s),""!=(e=n.Templates.append2body())&&i("body").append(e),n.Templates.loadLayout()}catch(t){n.errorMailer("buildChat 3: ",t,"")}try{n.chat.loadLayout()}catch(t){n.errorMailer("buildChat 4: ",t,"")}},addCobrowsingImg:function(){i("body").append("<img src='https://static.iadvize.com/images/livechat/anim_clic.gif' id='anim_clic' width='163px' height='161px' style='position: absolute; z-index: 999999999998; top: -3000px; left: -3000px;' />"),i("body").append("<img src='https://static.iadvize.com/images/livechat/op_cursor.png' id='visitor_cursor' width='70px' height='70px' style='position: absolute; z-index: 999999999999; top: -3000px; left: -3000px;' />")},loadLayout:function(){1==n.chat.cobrowsing&&n.chat.addCobrowsingImg(),n.chat.bindSendMessage(),n.chat.bindChatStatesEvents(),i("#idz_chatbox_main").on("click","#idz_button_font_pos, .idz_button_font_pos",function(){var t=1.1*parseFloat(i("#idz_dialogbox").css("font-size"));return t<=21&&(i("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),i("#idz_chatbox_main").on("click","#idz_button_font_neg, .idz_button_font_neg",function(){var t=.9*parseFloat(i("#idz_dialogbox").css("font-size"));return t>=10&&(i("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),i("#idz_button_close, .idz_button_close").click(function(){if(_.emit("conversation.closed"),2===n.chat.status){var t=Strophe.getBareJidFromJid(m.getConnection().jid);m.getConnection().send($msg({to:t,from:t,type:"chat",website:n.website_id}).c("body").t("!magic_event disabled"))}return(n.Templates.closeDialog||C)(),!1}),i("#idz_button_hide, .idz_button_hide").click(function(){return i("#idz_chatbox").hasClass("idz_chatbox_hide")?(n.Templates.showDialog(),n.chat.sendAlert("!chatshow",n.T("VISITEUR_CHATBOX_OPEN")),n.chatbox_state=n.chat.CHATBOX_STATES.OPENED):(n.Templates.hideDialog(),n.chat.sendAlert("!chathide",n.T("VISITOR_CHATBOX_MINIMIZE")),n.chatbox_state=n.chat.CHATBOX_STATES.MINIMIZED),n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state}),!1}),setTimeout(function(){n.customize["chatbar_txt2_"+n.curlang]&&0==n.customize["chatbar_txt2_"+n.curlang].length&&i("#idz_msgmsg").width()<=370&&i("#idz_msgmsg").val(n.T("POSER_VOTRE_QUESTION_ICI"))},500),i("#idz_button_mail, .idz_button_mail").click(function(){var t=i("#idz_dialogbox div.idz_msg_visitor").last().size(),e=i("#idz_dialogbox div.idz_msg_operator").last().size();if(!(t>0||e>0))return i("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),i("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1;var r=window.prompt(n.T("EMAIL_PROMPT"),"");if(""===r||null===r)return!1;var o=n.chat.history_id;0==n.chat.history_id&&(o=n.chat.prev_history);var a=h();i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+o+"&to="+encodeURIComponent(r)+"&u="+n.vuid+"&timezoneAbbr="+a),i("#mailFrame").length&&i("#mailFrame").remove(),i("body").append("<iframe id='mailFrame' name='mailFrame' style='width:0px; height:0px; border: 0px'></iframe>")}),i("#idz_button_print, .idz_button_print").click(function(){var t=i("#idz_dialogbox div.idz_msg_visitor").last().size(),e=i("#idz_dialogbox div.idz_msg_operator").last().size();return t>0||e>0?(i("#idz_button_print").attr("target","_blank"),!0):(i("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),i("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1)}),i(".idz_slide_link_close a").click(function(t){t.preventDefault(),i(t.currentTarget).parents(".idz_slide").toggle()}),i("#idz_button_private").click(function(t){t.preventDefault(),i("#idz_chatbox_private").toggle()}),i(".idz_toggle").click(function(t){var e=i(t.currentTarget).find(".idz_toggle_button"),r=e.siblings("input"),o=r.val();e.toggleClass("idz_toggle_on"),e.toggleClass("idz_toggle_off"),1==o?(r.val(0),e.animate({"background-position-x":"-11px"},200)):(r.val(1),e.animate({"background-position-x":"-49px"},200));var a=r.val();n.JSONStore.saveData({visitorDeleteDataEnabled:a}),"1"===a?n.chat.sendAlert("!datadeletionenabled"):n.chat.sendAlert("!datadeletiondisabled")}),1==n.flags.visitorDeleteDataEnabled&&i(".idz_toggle").trigger("click"),setTimeout(function(){n.Templates.minimizeChatbarHide()},1e3),i("#idz_chatbar_minifier, .idz_chatbar_minifier").click(function(){return n.chat.sendAlert("!chatmini",n.T("VISITEUR_CHATBAR_MINIMIZE")),n.Templates.minimizeChatbar(),!1}),i("#idz_chatbar_mini, .idz_chatbar_mini").click(function(){return n.chat.sendAlert("!chatmaxi",n.T("VISITEUR_CHATBAR_OPEN")),n.Templates.maximizeChatbar(),n.Visio&&(n.Visio.reLaunchVideo=!0),i(this).hide(),!1}),i("#idz_msgmsg").charcount({max:n.preferences.chat_message_maxlength,className:"idz_char_counter",maxReachedClassName:"idz_char_counter_max",maxReachedText:n.T("MAXLENGTH_REACHED")}),i("#idz_chatbar").on("click",".idz_upload_trigger",function(t){t.stopPropagation(),t.preventDefault(),i(this).find("input").click()}),i("#idz_chatbar").on("change",".idz_upload_trigger input",function(t){_.emit(b.OnConversationChatFileSelected,t),t.preventDefault(),t.stopPropagation(),i(this).val("")}).on("click",".idz_upload_trigger input",function(t){t.stopPropagation()}),i("#idz_dialogbox").on("click",".idz_upload_abort",function(t){_.emit(b.OnConversationChatUploadAborted,i(this).parents(".idz_upload").data("id")),t.preventDefault(),t.stopPropagation()})},outframeChat:function(){i("body").append("<style>#idz_chatglobal, #idz_chatbar_mini {visibility:hidden;left:-9999px}</style>")},loadInvitation:function(t){n.invitLoaded||(n.Templates.loadChatCss(),n.invitLoaded=!0,1!==n.chat.composing&&(n.callbacks.onInvitationDisplayed({id:t}),n.Templates.hideDialog(),(iAdvize.$LAB||window.$LAB).script(n.chaturl+"invitation.php?id="+t+"&t="+n.customize.layout+"&sid="+n.website_id+"&lang="+n.curlang).wait(function(){})))},onClickChatWidget:function(){0==n.opOffline?(n.butMessage||(2!=n.chat.status&&n.chat.putOpAlert(n.T("SAISIR_UN_MESSAGE")),n.butMessage=!0),n.Templates.maximizeChatbar(),n.Templates.showDialog()):0==n.preferences.param_noconnectedwidget&&(n.butMessage||(2!=n.chat.status&&n.chat.putOpAlert(n.T("SAISIR_UN_MESSAGE")),n.butMessage=!0),n.Templates.maximizeChatbar(),n.Templates.showDialog())},onClickC2cWidget:function(){n.chat.showC2cPopin()},bindWidgetEvents:function(){try{i(".idz_widget")&&i(".idz_widget").length&&(i("#operator_status_textarea")&&i("#operator_status_textarea").length?(i(".idz_widget").click(function(){return 0==n.opOffline&&""!==i("#operator_status_textarea").val()&&(i("#idz_msgmsg").val(i("#operator_status_textarea").val()),i("#operator_status_textarea").val(""),i("#idz_postmsg").click()),!1}),i("#operator_status_textarea").focus(function(){i("#operator_status_textarea").val()==n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&(i("#operator_status_textarea").val(""),i("#operator_status_textarea").removeAttr("style"))})):i(".idz_widget").click(function(){return n.chat.onClickChatWidget(),!1}))}catch(t){}try{i("#operator_status_textarea")&&i("#operator_status_textarea").length&&i("#operator_status_textarea").keyup(function(t){13==t.which&&(i("#idz_msgmsg").val(i("#operator_status_textarea").val()),i("#operator_status_textarea").val(""),i("#idz_postmsg").click())})}catch(t){}try{i(".idz_widget_v2")&&i(".idz_widget_v2").length&&i(".idz_chatwidget").click(function(){return n.chat.onClickChatWidget(),!1})}catch(t){}try{i(".idz_c2cwidget").length&&i(".idz_c2cwidget").click(function(){return n.chat.onClickC2cWidget(),!1})}catch(t){}i(".idz_c2vwidget").length&&i(".idz_c2vwidget").click(function(){return _.emit(b.OnConversationVisioRequested),!1})},showC2cPopin:function(){_.emit("call.popin.open")},showC2cBusyMessage:function(t){w&&w.View.showC2cBusyMessage(t)},showC2cError:function(t){w&&w.View.showC2cError(t)},closeC2cPopin:function(){w&&w.View.closeC2cPopin()},resetC2cPopin:function(){w&&w.View.resetC2cPopin()},bindChatStatesEvents:function(){var t=function(t){n.operator.barejid&&(m.sendChatState(t),"composing"===t?(n.chat.composing=1,n.callbacks.onVisitorWriting()):(n.chat.composing=0,n.callbacks.onVisitorStopWriting()))};i("#idz_msgmsg").focusout(function(){t("paused")}).focusin(function(){t("active")}).keydown(function(e){13===e.which?t("active"):0===n.chat.composing&&t("composing")}).keyup(function(){!i(this).val().trim()&&n.chat.composing&&t("active")}),i("#idz_msgmsg").keydown(function(t){if(!t.ctrlKey||13!==t.keyCode&&10!==t.keyCode){if(13===t.which)return t.preventDefault(),void i("#idz_postmsg").click()}else{var e=i(this).val()+" \n";i(this).val(e)}})},bindSendMessage:function(){i("#idz_postmsg").on("click",function(){if(!i(this).prop("disabled")){try{var t=i("#idz_msgmsg").css("left"),e=i("#idz_msgmsg").css("top"),r=i("#idz_msgmsg").get(0).value;if(1===n.chat.satisfaction){var o=parseInt(i("#idzq1").attr("rel"),10)+1+"|";o=(o=o+(parseInt(i("#idzq2").attr("rel"),10)+1)+"|")+(parseInt(i("#idzq3").attr("rel"),10)+1)+"|",r===n.T("VOTRE_COMMENTAIRE_LIBRE")&&(r=""),o+=r;var a=n.chat.history_id||n.chat.prev_history;return n.util.addScript("satisfaction",n.chaturl+"rpc/satisfaction.php?save="+n.website_id+"&u="+n.vuid+"&hid="+a+"&data="+encodeURIComponent(o)),n.chat.sendAlert("!satisfaction completed",n.T("SATISFACTION_REPONDU")),n.Templates.removeSatisfaction(),i("#idz_msgmsg").val("").change(),n.chat.composing=0,n.callbacks.onSatisfactionAnswered(),!1}if(""===r||r===n.T("POSER_VOTRE_QUESTION_ICI")||r===n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")||r===n.customize["chatbar_txt2_"+n.curlang])return setTimeout(function(){i("#idz_msgmsg").css({left:parseInt(t,10)+"px",top:parseInt(e,10)+"px"})},1030),!1;if(i("#idz_msgmsg").val("").change(),n.operator.barejid&&(1!==n.on_call&&1===n.opOffline||n.blocked)&&2!==n.chat.status){var s=n.chat.getVmsg(r);return n.Templates.showDialog(),n.chat.put_dialog(s),n.chat.disableLoading(),setTimeout(function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.setStatus()},300),!1}if(n.blocked||!r)return!1;var c=m.connect().fail(n.chat.showConnectionError);if(1===n.flags.waitinglist)return c.then(function(){n.Templates.showDialog(),n.chat.putVmsg(r),x.update()});if(n.operator.barejid||1===n.chat.satisfaction)c.done(function(){n.chat.onSendMessage(r)});else{var u=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}(),l=m.getConnection().getUniqueId();n.chat.enableLoading(),c.then(function(){return n.createConversation("chat",r,u,null,l)}).then(function(){if(n.routing.enabled){var t=n.$.Deferred();return n.operator.barejid||(n.operator.barejid="i_will_be_back"),t.resolve(l),t.promise()}return m.room.groupchat(r,l),n.util.retry(4,n.chat.onSendFirstMessage,n.chat,[r,l])}).done(function(t){d(),n.chat.putVmsg(r,t,u),!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer())}).fail(function(){1===n.flags.waitinglist?n.chat.putVmsg(r):(n.chat.put_dialog(n.chat.getVmsg(n.util.nl2br(n.util.htmlspecialchars(r)))),n.chat.showUnavailableMessage()),n.chat.disableLoading()})}}catch(t){n.errorMailer("bindSendMessage: ",t,"")}return!1}})},enableLoading:function(){i("#idz_msgmsg").attr("disabled","disabled"),i(".idz_loading").show()},disableLoading:function(){i("#idz_msgmsg").attr("disabled",!1),i(".idz_loading").hide()},showUnavailableMessage:function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.chat.status=1,n.operator={}},sendProactifAlert:function(){n.flags.proactif_alert&&""!=n.flags.proactif_alert&&n.chat.sendAlert(n.flags.proactif_alert,n.flags.message,!0)},onSendFirstMessage:function(t,e){var r=i.Deferred();return n.chat.dialogCount(),n.Templates.showDialog(),m.invitation.sendEngage(e,t,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id).then(function(t){n.chat.sendProactifAlert(),n.chat.sendProfile(n.operator.barejid,n.vStats.getProfile()),r.resolve(t)},r.reject),setTimeout(r.reject,4e3),n.proactif_now=0,r.promise()},onSendMessage:function(t){if("1"===n.preferences.bankcard_number_hidden&&(t=o(t)),t){n.Templates.showDialog();var e=m.getConnection().getUniqueId();n.chat.sendMessage(t,e).fail(function(){}),n.chat.putVmsg(t,e),n.proactif_now=0}},dialogCount:function(){n.flags.proactif_activatedId&&!n.flags.proactif_dialogIsCounted&&(n.flags.proactif_dialogIsCounted=!0,setTimeout(function(){n.util.addScript("proactifDialogcount",n.chaturl+"rpc/proactif_dialogCount.php?inc="+n.flags.proactif_activatedId+"&sid="+n.website_id+"&u="+n.vuid+"&hid="+n.chat.history_id)},1650))},updateHistory:function(t,e,i,r){if(e){i=i||0;var o=n&&n.vStats?n.vStats.browserInfo+" | "+n.vStats.country:"";r||(r=""),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&update="+n.chat.history_id+"&u="+n.vuid+"&oid="+n.operator.id+"&data="+encodeURIComponent(e)+"&type="+t+"&id="+i+"&nick="+Strophe.getNodeFromJid(m.getConnection().jid)+"&userData="+o+"&log_uuid="+r)}},reloadHistory:function(){n.chat.buildChat(),setTimeout(function(){var t=n.chat.history_id||n.chat.prev_history,e=h();n.util.addScript("IDZRhistory",n.chaturl+"rpc/chat_history.php?reload="+t+"&u="+n.vuid),i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t+"&u="+n.vuid+"&timezoneAbbr="+e)},400)},convertLinks:function(t,e){var n="";return e&&(n="target=_blank "),t.replace(/((ftp|https?):\/\/([-\w\.]+)+(:\d+)?(\/([\w/_\.\(\)\-,\#\~\%\=\+&;:]*(\?\S+)?)?)?)/gm,"<a "+n+'rel="nofollow" href="$1">$1</a>')},getVmsg:function(e,i){var r=i!=t?i:n.chat.getMsgTime();return e=n.chat.convertLinks(e,!0),e=y.replaceAliasesToShortname(e),e=y.replaceUtf8ToShortname("apple",e),e=y.replaceShortnameToImage("apple",e),n.Templates.vMsg.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,r)},putVmsg:function(t,e,i){e=e||0;var r=n.util.nl2br(n.util.htmlspecialchars(t));n.chat.put_dialog(n.chat.getVmsg(r),e),t=y.replaceShortnameToUtf8("apple",t),n.chat.updateHistory(n.chat.MESSAGE_TYPES.VISITOR,t,e,i),n.chat.disableLoading(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.callbacks.onVisitorStopWriting(),n.callbacks.onMessageSent({time:n.chat.getMsgTime(),msg:r})},getOpAlert:function(e,i){var r=i!=t?i:n.chat.getMsgTime();return e=n.util.nl2br(n.util.htmlspecialchars(e)),e=e.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),n.Templates.opAlert.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,r)},putOpAlert:function(t,e){n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.chat.getOpAlert(t)),e&&1===e&&n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,t),n.callbacks.onAlertReceived({time:n.chat.getMsgTime(),msg:t})},getOperatorAvatarUrl:function(){var t=n.static_url+"images/livechat/blank.gif";return n.operator.avatar&&(t=n.operator.avatar),t},getOpMsg:function(e,r){var o=r!=t?r:n.chat.getMsgTime(),a=n.chat.getOperatorAvatarUrl(),s="";if(n.operator.pseudo){s=n.util.htmlspecialchars(n.operator.pseudo);var c="";n.operator.isExpert&&(c=" "+iAdvize.T("SEE_MORE")),s=s+'<span class="idz_colonspace">'+c+"</span> : "}-1===e.indexOf(n.autoAnswer)&&(e=-1===e.indexOf(n.website_url)?n.chat.convertLinks(e,!0):n.chat.convertLinks(e,!1)),e=e.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),e=y.replaceUtf8ToImage("apple",e);var u=n.Templates.opMsg.replace(/\{PSEUDO\}/g,s).replace(/\{AVATAR\}/g,a).replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,o);if(n.operator.direct_phone&&""!=n.operator.direct_phone&&0===n.phoneDisplayed){n.phoneDisplayed=1;var l=n.Templates.opMsgFooter.replace(/\{PHONE_PRICE\}/g,n.operator.phone_facturation).replace(/\{PHONE_NUMBER\}/g,n.operator.direct_phone);u=u.replace(/\{FOOTER\}/g,l)}else u=u.replace(/\{FOOTER\}/g,"");return n.operator.id&&(_.emit("events.operatorMessageSent",n.operator),u=i(u).attr("data-operatorid",n.operator.id)[0].outerHTML),u},tagAutomatedMessages:function(t,e){e==n.chat.automatedStartMessageId&&t.find(".idz_msgtext:last, .idz_msgtime:last").addClass("idz_automatedMessage idz_automatedStartMessage"),e==n.chat.automatedEndMessageId&&t.find(".idz_msgtext:last, .idz_msgtime:last").addClass("idz_automatedMessage idz_automatedEndMessage")},putOpFile:function(t,e){i('.idz_upload[data-id="'+t+'"]').remove(),e.find("img").on("load",function(){n.Templates.scrollChatBoxDialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.Templates.scrollChatBoxDialog()},putOpProduct:function(t,e){e.find("img").on("load",function(){n.Templates.scrollChatBoxDialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.Templates.scrollChatBoxDialog()},putOpMessageWithMultipleChoices:function(t,e,r){r?r.append(e):(n.Templates.showDialog(),n.Templates.maximizeChatbar(),i("#idz_dialogbox #idz_dialogbox_bottom").before(e),n.Templates.scrollChatBoxDialog()),e.find(".idz_choice_button").on("click",function(t){t.preventDefault();var e=i(this),r=e.parents("#hist_container").length>0,o=r&&i("#hist_container").is(":nth-last-child(2)"),a=e.parents(".idz_msg_operator").is(":nth-last-child(2)");o||!r&&a?n.chat.onSendMessage(t.target.innerText):e.off(t)})},putOpMsg:function(t,e,r,o){var a="";if(a=o?n.util.nl2br(e):n.util.nl2br(n.util.htmlspecialchars(e)),!f(t)){n.Templates.showDialog(),n.Templates.maximizeChatbar();var s=n.chat.getOpMsg(a);n.chat.put_dialog(s),_.emit("events.operatorMessageAppended",n.operator),null!=t&&i("#idz_dialogbox").find(".idz_msgtext:last").attr({id:t}),n.chat.tagAutomatedMessages(i("#idz_dialogbox"),t),1===r?n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR,e,t):2===r&&setTimeout(function(){n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR,e,t)},2200),n.callbacks.onMessageReceived({time:n.chat.getMsgTime(),msg:e})}},onCommand:function(t){var e=t.body,o=t.from,a=t.barejid,s=t.getCommand(),c=function(){var t=n.operator.barejid;return null===t||O(t,a)},u=s.name,l=s.param1,f=s.param2;if(""===n.iframeID){if("routing_operator_found"===u){var h=function(){if(!n.operator.id){if(n.routing.enabled&&!n.activeCall&&(0===n.chat.history_id||0===n.vStats.history_id||!n.conversationJid))return n.errorMailer("Routing operator found with invalid states",new Error("invalid routing states"),"",{historyId:n.chat.history_id,vStatsHistoryId:n.vStats.history_id,jid:n.conversationJid,profile:i,operator:n.operator}),n.chat.putOpMsg(null,n.T("AN_ERROR_OCCURED_PLEASE_RETRY"),0,1),void n.chat.disableLoading();var t=e.substr(e.indexOf(" ")+1),i=JSON.parse(t);n.operator=i,!0===n.operator.isExpert&&n.chat.putOpAlert(n.chat.getExpertDisclaimer()),n.activeCall?w&&w.Service.onCallOperator(i.barejid):(n.logMailer("conversations.routing.operator.found","Routing operator found",{vuid:iAdvize.vuid,barejid:i.barejid}),m.invitation.sendEngage(i.identifier,i.message,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id).then(n.chat.sendProactifAlert),n.chat.sendProfile(i.barejid,n.vStats.getProfile()),_.emit("events.chatBuilt",null))}};n.activeCall?h():p.then(h)}if("vprofile"===u&&n.chat.sendProfile(o,n.vStats.getProfile()),"remindqueued"===u&&x.remind({position:l}),"unqueued"===u&&x.unqueue(a),"windowsize"===u&&n.chat.sendCommand(o,"!windowsize "+i(window).width()+"|"+i(window).height()),"getcook"===u&&n.chat.sendCookie(o),"customdata"===u&&n.chat.sendCustomData(o),"visio"===u&&("refused"===l?_.emit(b.OnConversationVisioRefused):"timeout"===l?_.emit(b.OnConversationVisioTimeout):"close"===l&&_.emit(b.OnConversationVisioClose)),c()&&"push"===u){var g="";l=n.util.nl2br(n.util.htmlspecialchars(l)),f=n.util.nl2br(n.util.htmlspecialchars(f)),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"PUSH "+l+" "+f),n.callbacks.onLinkReceived({name:f,url:l,push:!0}),-1===l.indexOf(n.website_url)?g=" target='_blank'":setTimeout(function(){window.parent.location.href=l},800);var v=n.Templates.putLinkItem(l,f,g);T()?n.chat.put_dialog(v):n.chat.putOpAlert(n.T("OPERATEUR_PUSHLINK"))}if("blockme"===u&&(2===n.chat.status?(n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.blocked=!0):n.Templates.hideUI()),c()&&"links"===u&&(g="",l=n.util.nl2br(n.util.htmlspecialchars(decodeURIComponent(l))),f=n.util.nl2br(n.util.htmlspecialchars(f)),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"LINKS "+l+" "+f),-1===l.indexOf(n.website_url)&&(g=" target='_blank'"),v=n.Templates.putLinkItem(l,f,g),T()?n.chat.put_dialog(v):n.chat.putOpAlert(n.T("OPERATEUR_SENDLINK")),n.callbacks.onLinkReceived({name:f,url:l,push:!1})),c()&&"offers"===u){g="",n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"OFFERS "+n.util.htmlspecialchars(l)+" "+n.util.htmlspecialchars(f)),-1===l.indexOf(n.website_url)&&(g=" target='_blank'");y=n.Templates.putOfferItem(n.util.htmlspecialchars(l),n.util.htmlspecialchars(f),g);T()?n.chat.put_dialog(y):n.chat.putOpAlert(n.T("OPERATEUR_SENDOFFER")),n.callbacks.onOfferReceived({name:f.split("|")[0],url:l})}if(c()&&"pushoffer"===u){g="",n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"OFFERS "+n.util.htmlspecialchars(l)+" "+n.util.htmlspecialchars(f)),-1===l.indexOf(n.website_url)?g=" target='_blank'":setTimeout(function(){window.parent.location.href=l},800);var y=n.Templates.putOfferItem(n.util.htmlspecialchars(l),n.util.htmlspecialchars(f),g);T()?n.chat.put_dialog(y):n.chat.putOpAlert(n.T("OPERATEUR_PUSHOFFER"))}if(c()&&"closedialog"===u){if(2===n.chat.status){i("#idz_msgmsg, #idz_postmsg").prop("disabled",!0),n.flags.visio_status&&_.emit(b.OnConversationVisioClosed),n.chat.putOpAlert(n.T("FIN_DISCUSSION")),n.callbacks.onChatEnded({id:n.chat.history_id,endedBy:"operator"}),delete n.operator.barejid;var C=4e3;iAdvize.REDOUTE&&(C=8e3),169===n.client_id&&(C=1e4),setTimeout(function(){i("#idz_msgmsg, #idz_postmsg").prop("disabled",!1),-1===n.operator.id||1===n.virtualOP||"1"!=n.preferences.param_satisfaction||0!==n.chat.satisfaction||n.blocked?n.Templates.hideDialog():(n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed())},C)}n.flags.popup_mode&&delete n.flags.popup_mode,n.chat.EndOfChat()}if("nomoreslot"===u||"routing_operator_not_found"===u){if(n.routing.enabled&&!n.operator.barejid)return;n.routing.enabled&&n.logMailer("conversations.routing.operator.nomoreslot","Routing operator unavailable",{vuid:iAdvize.vuid,barejid:n.operator.id,history_id:n.chat.history_id}),n.chat.putOpMsg(null,n.T("BONJOUR_NOTRE_SERVICE_CLIENT_EST_ACTUELLEMENT_FERME"),0,1),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&missed="+n.chat.history_id+"&oid="+n.operator.id+"&u="+n.vuid),n.opOffline=1,n.chat.status=1,n.operator={}}if("showinvit"===u&&n.chat.loadInvitation(l),"c2c"===u){if(clearTimeout(n.c2cTimeout),"opanswered"===l){var E=i(t.raw).attr("conversationJid");m.room.join(E,n.vuid),n.conversationJid=E,n.callbacks.onCallStarted(),1===n.preferences.c2c_callvisitorfirst?i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT2")):i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3")),1!==n.preferences.call_offline_enabled&&(n.on_call=1),n.opOffline=0,n.chat.status=2,n.chat.history_id=f,n.vStats.history_id=f,n.chat.dialogCount(),n.setStatus(),n.operator=n.c2coperator,O(n.c2coperator.barejid,a)||(n.c2coperator.barejid=a,n.operator.barejid=a,n.util.addScript("getop",n.chaturl+"rpc/getop.php?sid="+n.website_id+"&u="+n.vuid+"&getop="+a)),n.flags.proactif_alert&&""!=n.flags.proactif_alert&&n.chat.sendAlert(n.flags.proactif_alert,n.flags.message,!0),n.c2cTimeout=setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},1e4)}else"start"===l?(i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3")),n.chat.dialogCount(),1!==n.preferences.call_offline_enabled&&(n.on_call=1),n.opOffline=0,n.chat.status=2,n.chat.history_id=f,setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},7e3)):"stop"===l?(m.room.leave(n.conversationJid,n.vuid),n.callbacks.onCallEnded(),i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT1")),n.on_call=0,n.chat.status=3,n.chatbox_state=n.chat.CHATBAR_HIDDEN,n.activeCall=null,setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},7e3),"1"==n.preferences.param_satisfaction&&0==n.chat.satisfaction&&(n.chat.buildChat(),n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed())):"redial"==l?w&&w.Service.onMakeCall():"error"==l&&(n.chat.showC2cError(n.T(f.trim())),n.on_call=0,n.chat.status=1);n.JSONStore.saveData({on_call:n.on_call,chat_status:n.chat.status,history_id:n.chat.history_id,chatbox_state:n.chatbox_state})}if("init_cobro"===u&&S){if(!S.init)return!0;S.init().done(function(){n.operator.barejid&&n.chat.sendCommand(n.operator.barejid,"!cobro_init")})}}if("magic_event"===u){if(!S)return!0;if(!S.isReceiver||!S.changeState)return n.errorMailer("Mirroring magic_event error: Defined Mirror but undefined methods",{object:S,type:void 0===S?"undefined":r(S),browser:window.navigator.userAgent,url:window.location.href},""),!0;"sender"==l||"disabled"==l||"receiver"==l?("sender"==l&&S.isReceiver()&&(i("#op_cursor").animate({top:"-3000px",left:"-3000px"},150),""==n.iframeID&&(n.Templates.showDialog(),n.chat.cobrowsing=0,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.chat.putOpAlert(n.T("COBROWSING_STOP")),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_STOP"),n.callbacks.onCobrowsingStopped())),"sender"!=l||n.operator.barejid||(n.monitor_jid=a),"disabled"==l&&2!=n.chat.status&&delete n.monitor_jid,S.changeState(l)):"receiver_request"==l&&""==n.iframeID&&(n.chat.buildChat(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.Templates.askCobrowsing.replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_ASK"),i('[id="idz_cobrowsing_accept"]').bind("click",function(t){return n.chat.addCobrowsingImg(),i(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_ACCEPT")).replace(/\{TIME\}/g,n.chat.getMsgTime())),S.state("receiver"),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_ACCEPT"),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_accept"),"numericable"==n.customize.layout||n.flags.streamId||(n.Templates.hideDialog(),n.chatbar_state=1,n.JSONStore.saveData({chatbar_state:n.chatbar_state})),n.chat.cobrowsing=1,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.callbacks.onCobrowsingAccepted(),!1}),i('[id="idz_cobrowsing_refuse"]').bind("click",function(t){return i(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_REFUSE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"COBROWSING_REFUSE"),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_refuse"),n.callbacks.onCobrowsingRefused(),!1}),n.callbacks.onCobrowsingRequested())}"change_page"===u&&(document.location.href=decodeURIComponent(l)),"ackEngage"===u&&(n.routing.enabled&&n.logMailer("conversations.routing.operator.engage.acknowledge","Routing acknowledge received",{vuid:iAdvize.vuid,barejid:iAdvize.operator.barejid,historyId:n.chat.history_id}),2!==n.chat.status&&d(),n.chat.status=2,n.operator.barejid=a)},onChatStates:function(t,e){try{O(n.operator.pseudo,t)&&""===n.iframeID&&("composing"===e?(i(".idz_writting").html(n.T("OPERATEUR_COMPOSING")),n.callbacks.onOperatorWriting()):(i(".idz_writting").html(" "),n.callbacks.onOperatorStopWriting()))}catch(t){n.PROD?n.errorMailer("onChatState: ",t,e):console&&console.debug&&console.debug("[Erreur][onChatStates]",t.message,e)}},onMessage:function(t){var e=t.body,r=t.id,o=t.from,a=t.barejid;if(!function(t){return Strophe.getResourceFromJid(t)===n.vuid}(o)&&""==n.iframeID){if(n.opBusy=0,!function(){var t=n.conversationJid;return null===t||O(t,a)}())return n.chat.sendCommand(a,"!chatting"),i(".idz_writting").html(" "),!0;if(n.operator.barejid||(n.operator.barejid=a),n.chat.putOpMsg(r,e,1),setTimeout(function(){i(".idz_writting").html(" ")},350),n.chat.status=2,n.chatbox_state=n.chat.OPENED,n.virtualOP=0,n.blink_title(),"1"==n.customize.sound_alert){var s=x.justUnqueued()?"outofqueue":"message";n.playSound(s)}}},onMessageReceipt:function(t){try{if(t.isCommand()){var e=t.getCommand();"transfer"===e.name&&n.transfer(e.param1)}}catch(e){n.PROD?n.errorMailer("onReceipt: ",e,t):console&&console.debug&&console.debug("[Erreur][onMessageReceipt]",e.message,t)}return!0},EndOfChat:function(){n.chat.status=3,(0==n.chat.prev_history||isNaN(n.chat.prev_history)||n.chat.history_id>n.chat.prev_history)&&(n.chat.prev_history=n.chat.history_id),n.chat.history_id=0,n.chatbox_state=n.chat.CHATBOX_STATES.CHATBAR_HIDDEN,n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state,chatbar_state:n.chatbar_state}),n.operator={},m.getConnection().connected&&(m.room.leave(n.conversationJid,n.vuid),n.chat.sendPresence("available"))},EndOfWaiting:function(){n.chat.status=3,(0==n.chat.prev_history||isNaN(n.chat.prev_history)||n.chat.history_id>n.chat.prev_history)&&(n.chat.prev_history=n.chat.history_id),n.chat.history_id=0,n.chatbox_state=n.chat.CHATBOX_STATES.MINIMIZED,n.operator={},n.chat.sendPresence("available"),n.chat.putOpAlert(n.T("WAITING_CONNECTION_ERREUR"))},showConnectionError:function(){(i("#idz_chatglobal").is(":visible")||2==n.chat.status)&&(i(".idz_writting").html(""),n.chat.putOpAlert(n.T("CONNECTION_ERREUR")),n.chat.disableLoading(),i("#idz_msgmsg, #idz_postmsg").prop("disabled",!0))},sendMessage:function(t,e){var r=i.Deferred();try{if(!t||""===t)return r.reject("desk.publish.error.empty"),r.promise();if(n.blocked)return r.reject("desk.publish.error.blocked"),r.promise();if(3==n.chat.status&&n.chat.history_id>0&&n.chat.sendPresence("dnd"),n.chat.status=2,n.chatbox_state=n.chat.CHATBOX_STATES.OPENED,n.chatbar_state=0,-1===n.operator.id)return r.reject("desk.publish.error.waiting"),r.promise();m.room.groupchat(t,e).done(function(t){r.resolve(t)}).fail(n.chat.onRetrySendMessage)}catch(t){return r.reject("desk.publish.error.unknown",t)}return r.promise()},onRetrySendMessage:function(t,e,i){i&&i.done(function(t){}).fail(n.chat.onRetrySendMessage)},sendChatClose:function(){var t=n.chat.sendAlert("!chatclose",n.T("VISITOR_CHATBOX_CLOSE"));1!=n.chat.status&&(n.chat.status=3,n.flags.waitinglist=0,n.chat.sendPresence("available"),n.JSONStore.saveData({chat_status:n.chat.status,visitor_closed:1,waitinglist:0}),n.chat.updateHistory(n.chat.MESSAGE_TYPES.OPERATOR_ALERT,"VISITOR_CHAT_CLOSE",t))},sendAlert:function(t,e,i){try{if(1==n.virtualOP)return;var r=(new Date).getTime();if(2==n.chat.status||i){var o=$msg({to:n.operator.barejid,from:m.getConnection().jid,type:"chat",id:r,website:n.website_id}).c("body").t(t);return m.getConnection().send(o),r}}catch(i){n.errorMailer("sendAlert: ",i,t+"\n\n"+e)}},sendPresence:function(t){var e={site:n.website_id,opid:n.operator.id,frameid:n.iframeID};n.chat.history_id&&(e.history=n.chat.history_id),"unavailable"==t?m.getConnection().send($pres({type:"unavailable"})):"available"==t?m.getConnection().send($pres(e).c("status").t(location.href)):"away"!=t&&"dnd"!=t||m.getConnection().send($pres(e).c("show").t(t).up().c("status").t(location.href))},sendCommand:function(t,e){if(m.isOnline(t)){var i=(new Date).getTime();m.getConnection().send($msg({id:i,to:t+"/operators",from:m.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}},sendProfile:function(t,e){m.getConnection().send($msg({to:t,from:m.getConnection().jid,type:"command",website:n.website_id}).c("body").t("!vprofile "+e))},sendCookie:n.util.runOnce(1500,function(t){var e="!getcook "+n.chat.cCook;m.getConnection().send($msg({to:t[0],from:m.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}),sendCustomData:function(t){var e="!customdata "+n.vStats.customData();m.getConnection().send($msg({to:t,from:m.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))},getMsgTime:function(){var t=new Date,e=t.getHours(),n=t.getMinutes();return n<10&&(n="0"+n),e+":"+n},put_dialog:function(t,e){var r=i(t);r.find(".idz_msgtext").attr("data-id",e);var o=r.attr("class"),a=i("#idz_dialogbox_bottom"),s=a.prev("div").attr("class"),c=a.prev("div").find(".idz_msgtime:last").html();if("idz_msg_operator"!=o&&"idz_msg_visitor"!=o||o!=s)i("#idz_dialogbox #idz_dialogbox_bottom").before(t);else{var u=r.find(".idz_msgtext"),l=r.find(".idz_msgtime");c==l.html()&&(l=""),a.prev("div").find(".idz_msgtext:last").after(u).after(l),"idz_msg_operator"==o&&i(".idz_opename:last").remove()}n.Templates.scrollChatBoxDialog()},getLocalTime:function(t){var e=6e4*(new Date).getTimezoneOffset(),n=new Date,i=new Date(n.getTime()+e);i.setHours(t.split(":")[0]),i.setMinutes(t.split(":")[1]);var r=new Date(i.getTime()-e),o=r.getHours(),a=r.getMinutes();return a<10&&(a="0"+a),o+":"+a},prepare_history:function(t){try{t=JSON.parse("["+t+"]")}catch(e){return void n.errorMailer("prepare_history JSON.parse: ",e,t)}var e=i("<div id='hist_container'></div>"),r="",o="",a="",s="",c="",u=!0,l=!1,d="",h="",p="",m=0;g.forEach(t,function(t){var i={type:t[0],time:t[1],content:t[2],id:t[3]};if(f(i.id))return!0;if(h=n.util.htmlSimpleEscape(i.content),h=h.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),m!=i.type||i.type!=n.chat.MESSAGE_TYPES.OPERATOR&&i.type!=n.chat.MESSAGE_TYPES.VISITOR?i.type==n.chat.MESSAGE_TYPES.OPERATOR?e.append(n.chat.getOpMsg(h,i.time)):i.type==n.chat.MESSAGE_TYPES.VISITOR&&e.append(n.chat.getVmsg(h,i.time)):(d=p==i.time?"":"<div class='idz_msgtime'>"+i.time+"</div>",h=y.replaceUtf8ToImage("apple",h),h=n.chat.convertLinks(h,!0),e.find(".idz_msgtext:last").after("<div class='idz_msgtext'>"+h+"</div>").after(d)),n.chat.tagAutomatedMessages(e,i.id),m=i.type,p=i.time,i.type==n.chat.MESSAGE_TYPES.VISITOR&&u&&(u=!1,!0===n.operator.isExpert&&(e.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer(),p)),m=n.chat.MESSAGE_TYPES.OPERATOR_ALERT,l=!0)),i.type==n.chat.MESSAGE_TYPES.OPERATOR_ALERT){if(r=i.content,"LINKS"===(o=r.split(" ")[0])||"PUSH"===o){a=r.split(" ")[1],s=r.substr(a.length+o.length+2),-1==a.indexOf(n.website_url,0)&&(c=" target='_blank'");var g=n.Templates.putLinkItem(a,s,c);T()?e.append(g):("LINKS"===o&&e.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDLINK"),i.time)),"PUSH"===o&&e.append(n.chat.getOpAlert(n.T("OPERATEUR_PUSHLINK"),i.time)))}if("OFFERS"===o){a=r.split(" ")[1],s=r.substr(a.length+o.length+2),-1===a.indexOf(n.website_url)&&(c=" target='_blank'");var v=n.Templates.putOfferItem(a,s,c);T()?e.append(v):e.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDOFFER"),i.time))}"VISIOCONF_ACCEPT"===o&&e.append(n.chat.getOpAlert(n.T("VISIOCONF_ACCEPT"),i.time)),"COBROWSING_ASK"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_ASK_SHORT"),i.time)),"COBROWSING_ACCEPT"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_ACCEPT"),i.time)),"COBROWSING_REFUSE"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_REFUSE"),i.time)),"COBROWSING_STOP"===o&&e.append(n.chat.getOpAlert(n.T("COBROWSING_STOP"),i.time)),"CHAT_CLOSE"!==o&&"VISITOR_CHAT_CLOSE"!==o&&"OPERATOR_CHAT_CLOSE"!==o||e.append(n.chat.getOpAlert(n.T("FIN_DISCUSSION_SHORT"),i.time))}if(i.type==n.chat.MESSAGE_TYPES.OPERATOR&&E.push(i.id),i.type===n.chat.MESSAGE_TYPES.OPERATOR_RICH_CONTENT||i.type===n.chat.MESSAGE_TYPES.VISITOR_RICH_CONTENT)try{var w=JSON.parse(i.content),S=i.type===n.chat.MESSAGE_TYPES.OPERATOR_RICH_CONTENT?"operator":"visitor";_.emit(b.OnXmppOOBReceived,i.id,S,i.time,w.type,w.data.url,w.data,e)}catch(t){console.error(t)}}),!1===l&&!0===n.operator.isExpert&&e.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer())),i("#idz_dialogbox #idz_dialogbox_bottom").before(e),_.emit("events.operatorMessageAppended",n.operator),i("#idz_dialogbox").find(".idz_msgtime").each(function(){i(this).text(n.chat.getLocalTime(i(this).text()))}),n.chatbox_state==n.chat.CHATBOX_STATES.OPENED&&n.chat.offercount>1&&(T()||n.Templates.showOfferPanel()),n.Templates.scrollChatBoxDialog(),n.Templates.scrollLinkDialog()},getExpertDisclaimer:function(){return n.T("chatbox.operatorAlert.expertDisclaimer").replace(/\{\{ company }}/g,n.website_label)}},n.blink_title=function(){1!==n.hasFocus&&(null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null),n.blinktm=setInterval(function(){i("title").html()===n.oTitle?document.title=n.T("NOUVEAU_MESSAGE"):document.title=n.oTitle},1500))},n.lastPreview=null,n.livePreview=window.setInterval(function(){if(n.chat&&2===n.chat.status&&n.operator&&n.operator.barejid){var t=i("#idz_msgmsg").val();if(""!=t&&n.lastPreview!=t&&t!=n.T("POSER_VOTRE_QUESTION_ICI")&&t!=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&t!=n.customize["chatbar_txt2_"+n.curlang]){n.lastPreview=t,"1"===n.preferences.bankcard_number_hidden&&(t=o(t));var e=$msg({to:Strophe.getBareJidFromJid(n.operator.barejid)+"/operators",from:m.getConnection().jid,type:"command",website:n.website_id}).c("body").t("!preview "+t);m.getConnection().send(e)}}},2800),n.findOPDelayed=function(){return n.routing.enabled?0:setTimeout(function(){n.AvailableOp.find()},1500)},n.findOpCallback=function(t){var e=n.preferences.priority_channel;if("all"!=e&&0==t.opOffline&&0==t.c2cOffline&&("chat"==e&&(t.c2cOffline=1),"call"==e&&(t.opOffline=1)),n.opOffline=t.opOffline,n.c2cOffline=t.c2cOffline,n.callMeeting.available=!!t.callMeeting&&t.callMeeting.available,n.callMeeting.enabled=!!t.callMeeting&&t.callMeeting.enabled,n.callInstant.available=!!t.callInstant&&t.callInstant.available,n.callInstant.enabled=!!t.callInstant&&t.callInstant.enabled,n.callOffline.available=!!t.callOffline&&t.callOffline.available,n.callOffline.enabled=!!t.callOffline&&t.callOffline.enabled,n.c2vOffline=t.c2vOffline,void 0!==t.opBusy&&(n.opBusy=t.opBusy),setTimeout(function(){2!=n.chat.status&&(n.callbacks.onStatusChanged({offline:t.opOffline,busy:t.opBusy,c2cOffline:t.c2cOffline}),n.callbacks.onCallStatusChanged({offline:t.c2cOffline,chatOffline:t.opOffline}))},450),1==t.opOffline&&1==n.c2cOffline&&1==n.c2vOffline){try{n.setStatus(),!0===n.chat.connected&&S&&S.disable&&S.disable()}catch(t){}try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}}else if(setTimeout(n.setStatus,300),1==t.opOffline)try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}_.emit("targeting.poll.callback",t)},n.onActivity=function(){n.vStats.lastMove=(new Date).getTime(),null==n.vStats.activeSince&&(n.vStats.activeSince=(new Date).getTime())},n.setStatus=function(){if(n.flags.popup_mode&&!n.popout)return!0;n.floatingWidget&&n.floatingWidget.onPresenceChange(),n.SetOnline(),n.SetOffline(),n.OCallBack&&(1==n.opOffline&&1==n.c2cOffline||1==n.on_call?n.OCallBack.onOffline():n.OCallBack.onOnline());var t="";i(".idz_widget_v2").length&&(n.opOffline&&n.c2cOffline?0!=n.preferences.param_noconnectedwidget?i(".idz_widget_v2").hide():(i(".idz_widget_v2 .wtext1").html(" "),i(".idz_widget_v2 .wtext2").html(n.T("OPERATEURS_INDISPONIBLES_ENVOYER_EMAIL")),i(".idz_widget_v2 .wtext5").show()):(n.opOffline?i(".idz_chatwidget").hide():(t+="Nous vous assistons en direct par chat.",i(".idz_chatwidget").show()),n.opOffline||n.c2cOffline||(t+=" <span>OU</span> "),n.c2cOffline?(i(".idz_c2cwidget").hide(),n.chat&&n.chat.closeC2cPopin(),i("#call_button_online,.call_button_online").hide(),i("#call_button_offline,.call_button_offline").show()):(t+=n.T("NOUS_VOUS_RAPPELONS_GRATUITEMENT"),i(".idz_c2cwidget").show()),1==n.preferences.param_connectedwidget?i(".idz_widget_v2").hide():(i(".idz_widget_v2 .wtext1").html(n.T("PUIS_JE_VOUS_AIDER")),i(".idz_widget_v2 .wtext2").html(t),i(".idz_widget_v2").show()),i(".idz_widget_v2 .wtext5").hide()))},n.onChatButtonDisplay=function(){_.emit(b.chatButtonDisplayed),n.callButCB||(n.callbacks.onChatButtonDisplayed(),n.callButCB=!0)},n.onCallButtonDisplay=function(){_.emit(b.callButtonDisplayed),n.chatButCB||(n.callbacks.onCallButtonDisplayed(),n.chatButCB=!0)},n.onVisioButtonDisplay=function(){_.emit(b.videoButtonDisplayed),n.visioButCB||(n.callbacks.onVideoButtonDisplayed(),n.visioButCB=!0)},n.SetOnline=function(){1!=n.on_call&&(0==n.opOffline&&("1"==n.customize.chatbar_avatar&&(i("#idz_avatar_status").addClass("idz_online").removeClass("idz_offline").html(n.T("EN_LIGNE")),i("#idz_status_msg").html(n.T("NOS_CONSEILLERS_SONT_ACTUELLEMENT_A_VOTRE_DISPOSITION"))),i(".idz_widget").length&&i("#button_online").is(":hidden")&&(1!=n.preferences.param_connectedwidget?(i("#button_offline").hide(),i("#button_online").show(),n.onChatButtonDisplay()):(i("#button_offline").hide(),i("#button_online").hide()))),0==n.c2cOffline&&(i(".idz_c2cwidget").length&&(1!=n.preferences.param_c2c_connectedwidget?(i(".idz_c2cwidget").show(),n.onCallButtonDisplay()):i(".idz_c2cwidget").hide()),1!=n.preferences.param_c2c_connectedwidget?(i("#call_button_online,.call_button_online").show(),i("#call_button_offline,.call_button_online").hide()):(i("#call_button_online,.call_button_online").hide(),i("#call_button_offline,.call_button_offline").hide())),0==n.c2vOffline&&(i(".idz_c2vwidget").length&&(1!=n.preferences.param_visio_connectedwidget?(i(".idz_c2vwidget").show(),n.onVisioButtonDisplay()):i(".idz_c2vwidget").hide()),1!=n.preferences.param_visio_connectedwidget?(i("#visio_button_online,.visio_button_online").show(),i("#visio_button_offline,.visio_button_online").hide()):(i("#visio_button_online,.visio_button_online").hide(),i("#visio_button_offline,.visio_button_offline").hide())))},n.SetOffline=function(){1!=n.opOffline&&1!=n.on_call||("1"==n.customize.chatbar_avatar&&(i("#idz_avatar_status").addClass("idz_offline").removeClass("idz_online").html(n.T("HORS_LIGNE")),i("#idz_status_msg").html(n.T("BONJOUR_AUCUN_CONSEILLER_EST_DISPONIBLE_POUR_VOUS_REPONDRE"))),i(".idz_widget").length&&(i("#button_offline").length&&i("#button_offline").is(":hidden")?0==n.preferences.param_noconnectedwidget?(i("#button_offline").show(),i("#button_online").hide()):(i("#button_offline").hide(),i("#button_online").hide()):i("#button_online").hide()),i(".idz_chatwidget").length&&i(".idz_chatwidget").hide()),1==n.c2vOffline&&(i(".idz_c2vwidget").length&&i(".idz_c2vwidget").hide(),0==n.preferences.param_visio_noconnectedwidget?(i("#visio_button_offline,.visio_button_offline").show(),i("#visio_button_online,.visio_button_offline").hide()):(i("#visio_button_offline,.visio_button_offline").hide(),i("#visio_button_online,.visio_button_offline").hide()))},n.logMailer=v.info,n.errorMailer=v.error,void 0===n.Utils&&(n.Utils={}),n.Utils.errorMailer=n.errorMailer}}(iAdvize,iAdvize.$)},{lodash:34}],2:[function(t,e,n){iAdvize.define("livechat/call",function(t,e){iAdvize.$;var n=t("livechat/call/service"),i=t("livechat/call/view"),r=t("livechat/call/event");i.init({CallEvent:r}),r.init({CallView:i,CallService:n}),e.Service=n,e.View=i,e.Event=r})},{}],3:[function(t,e,n){iAdvize.define("livechat/call/event",function(t,e){function n(){return s.closeC2cPopin(),!1}function i(t){return t.stopPropagation(),l("#c2cpopin_flag_list").show(),!1}function r(){l("body").unbind("click.clickoutsideCountry"),l("#c2cpopin_flag_list").is(":visible")&&l("#c2cpopin_flag_list").fadeOut()}function o(){var t=u.Templates.buildC2cPopin,e=u.call.countries,n=l(this).attr("id");return s.updateSelectedCountryC2c(n,t,e),l("#c2cpopin_flag_list").is(":visible")&&l("#c2cpopin_flag_list").fadeOut(),!1}function a(){return l(this).hasClass("c2cpopin_phone_default")&&l(this).removeClass("c2cpopin_phone_default"),!1}var s,c,u=iAdvize,l=u.$,d=t("eventManager");e.init=function(t){s=t.CallView,c=t.CallService,d.on("call.popin.open",s.showC2cPopin)},e.bindEvents=function(t){t.find("#c2cpopin_close").click(n),t.find(".c2cpopin_call").off("click").click(c.onMakeCall),t.find("#c2cpopin_flag_selector").click(i),l("body").bind("click.clickoutsideCountry",r),t.find("#c2cpopin_flag_list li").click(o),t.find("#c2cpopin_phone").focus(a)}})},{}],4:[function(t,e,n){iAdvize.define("livechat/call/service",function(t,e){function n(t,e){if(!o.ringing){o.activeCall=t,o.ringing=!0;var n=void 0!==window.idzCustomData?idzCustomData:{};a.each(n,function(t,e){"city_cp"==t?n.city=e:"name_firstname"==t?n.name=e:"extID"==t&&(n.extid=e)});var i={customData:n},r=o.routing.enabled?"c2c_routing.php":"c2c.php";s.connect().done(function(){o.util.addScript("IDZc2cCall",o.chaturl+"rpc/"+r+"?sid="+o.website_id+"&oid="+o.c2coperator.id+"&vphone="+encodeURIComponent(t)+"&u="+o.vuid+"&visitorCountryCode="+e+"&visitorLocale="+o.visitor.locale+"&dep="+o.forceDep+"&vnick="+Strophe.getBareJidFromJid(s.getConnection().jid)+"&forcedLang="+o.forcedLang+"&"+a.param(i))})}}function i(t,e){a("#c2cpopin_step1").hide(),a("#c2cpopin_step2").show(),n(t,e)}function r(t,e){var n=o.call.countries[e];if(!n)throw new Error("Unknown country or not referenced in the countries list");if(n.number_pattern&&!new RegExp(n.number_pattern).test(t))throw new Error("The given phone number format is unknown");return parseInt(n.zero_prefixed,10)&&(t=t.substr(1)),"+"+n.calling_code+t}var o=iAdvize,a=o.$,s=t("xmpp"),c=t("eventManager");c.on("call.phone.format.validated",i),c.on("call.phone.callOperator",function(t,e,n){var i=void 0!==window.idzCustomData?idzCustomData:{};a.each(i,function(t,e){"city_cp"==t?i.city=e:"name_firstname"==t?i.name=e:"extID"==t&&(i.extid=e)});var r={customData:i};s.connect().done(function(){o.util.addScript("IDZc2cCall",o.chaturl+"rpc/c2c_routing_operator.php?sid="+o.website_id+"&operator="+t+"&vphone="+encodeURIComponent(e)+"&u="+o.vuid+"&visitorCountryCode="+n+"&visitorLocale="+o.visitor.locale+"&dep="+o.forceDep+"&vnick="+Strophe.getBareJidFromJid(s.getConnection().jid)+"&forcedLang="+o.forcedLang+"&"+a.param(r))})}),e.onMakeCall=function(){var t=a("#c2cpopin_phone").val(),e=a("#c2cpopin_flag_selector div").attr("rel");try{if(!t)throw new Error("No phone number provided");phoneNumber=r(t,e)}catch(t){return o.chat.showC2cError(o.T("INVALID_PHONE_NUMBER"))}return a("#c2cpopin_step1").removeClass("c2cpopin_error"),c.emit("call.phone.format.validated",phoneNumber,e),!1},e.onCallOperator=function(t){o.activeCall;var e=a("#c2cpopin_flag_selector div").attr("rel");return c.emit("call.phone.callOperator",t,phoneNumber,e),!1},e.onPhoneValidated=i,e.getInternationalPhoneNumberFormat=r})},{}],5:[function(t,e,n){iAdvize.define("livechat/call/view",function(t,e){function n(t,e){var n,r,o=[],a=[];for(n in t)r=t[n],o.push(i(r,e)),a.push(r);return u=a.shift(),"<ul>"+o.join("")+"</ul>"}function i(t,e){return e.replace(/{([\s\S]+?)}/g,function(e,n){return t[n]||""})}function r(t,e,i){var r,o,a=d(window).height();t?(r=n(e,i),o=l.Templates.buildC2cPopin(r)):o=l.Templates.c2cPopin;var s=d(o);return l.Templates.buildC2cPopin&&s.find("#c2cpopin_flag_list .flag").hide(),s.find("#c2coverlay").css({height:a}),s}function o(){var t=d(window).height();d("#c2coverlay").css({height:t}),d("#c2coverlay").show(),d("#c2cpopin").show()}function a(){d("#idzc2c").remove()}function s(t,e,n){var i,r=d("#c2cpopin_flag_selector div"),o=r.find("img"),a="";t&&"string"==typeof t&&(t=t.toLowerCase()),n[t]||n[t=l.curlang]||(t=u.country_code),r.removeClass().addClass("flag flag_"+t),r.attr({rel:t}),e&&(i=n[t].icon_path,r.css("background","none"),a=(o.data("basepath")||"")+i,o.attr("src",a))}var c,u,l=iAdvize,d=l.$,f=t("xmpp"),h=t("eventManager");e.init=function(t){c=t.CallEvent},e.updateSelectedCountryC2c=s,e.showC2cPopin=function(){var t,e=l.Templates.buildC2cPopin,n=l.call.countries,i=l.Templates.countryItemTemplate;if(l.ringing=!1,l.chat.connected||f.connect(),d("#c2cpopin").length>0)o();else{var a=r(e,n,i);c.bindEvents(a),a.appendTo("body")}l.visitor.country&&(t=l.visitor.country),s(t,e,n),l.callInstant.available||d("#c2cpopin_step1 .c2cpopin_call").hide(),h.emit("call.popin.open.after")},e.closeC2cPopin=function(){l.ringing=!1,a(),d("#c2coverlay").hide(),d("#c2cpopin").hide()},e.showC2cError=function(t){clearTimeout(l.c2cTimeout),this.showC2cPopin(),d("#c2cpopin_step2").hide(),d("#c2cpopin_step1").show(),d("#c2cpopin_step1").addClass("c2cpopin_error"),d(".c2cpopin_label_error").attr("style","").html(l.util.htmlspecialchars(t))},e.showC2cBusyMessage=function(t){this.showC2cPopin(),d("#c2cpopin_step2").hide(),d("#c2cpopin_step1").show(),d("#c2cpopin_step1").addClass("c2cpopin_error"),d(".c2cpopin_label_error").html(l.util.htmlspecialchars(t)).css("color","black")},e.resetC2cPopin=a})},{}],6:[function(t,e,n){"use strict";e.exports=t("./lib/emojisService.js")},{"./lib/emojisService.js":8}],7:[function(t,e,n){"use strict";e.exports={"<3":"heavy-black-heart","</3":"broken-heart",":)":"slightly-smiling-face","(:":"slightly-smiling-face",":-)":"slightly-smiling-face","C:":"grinning-face","c:":"grinning-face",":D":"grinning-face",":-D":"grinning-face",";)":"winking-face",";-)":"winking-face","):":"slightly-frowning-face",":(":"slightly-frowning-face",":-(":"slightly-frowning-face",":'(":"crying-face","=)":"smiling-face-with-open-mouth","=-)":"smiling-face-with-open-mouth",":*":"kissing-face",":-*":"kissing-face",":>":"grinning-face",":->":"grinning-face","8)":"smiling-face-with-sunglasses",":\\":"confused-face",":-\\":"confused-face",":/":"confused-face",":-/":"confused-face",":|":"neutral-face",":-|":"neutral-face",":O":"face-with-open-mouth",":-o":"face-with-open-mouth",">:(":"angry-face",">:-(":"angry-face",":-p":"face-with-stuck-out-tongue",":P":"face-with-stuck-out-tongue",":-P":"face-with-stuck-out-tongue",":-b":"face-with-stuck-out-tongue",";p":"face-with-stuck-out-tongue-and-winking-eye",";-p":"face-with-stuck-out-tongue-and-winking-eye",";b":"face-with-stuck-out-tongue-and-winking-eye",";-b":"face-with-stuck-out-tongue-and-winking-eye",";P":"face-with-stuck-out-tongue-and-winking-eye",";-P":"face-with-stuck-out-tongue-and-winking-eye",":o)":"monkey-face","D:":"anguished-face",":fu:":"reversed-hand-with-middle-finger-extended",xD:"rolling-on-the-floor-laughing"}},{}],8:[function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=t("lodash"),o=t("emoji-aware").split,a=t("store"),s=t("./aliases.js");e.exports=function(t){var e=r.get(t,"baseUrl","/"),n=r.get(t,"blackList",[]),c=/:([a-z0-9-]+):/gm,u=r.chain(r.clone(s)).mapKeys(function(t,e){return e.replace("\\","\\\\").replace(")","\\)").replace(":","\\:").replace(";","\\;").replace("-","\\-").replace("*","\\*").replace("|","\\|").replace("(","\\(").replace("/","\\/")}).keys().value().join("|"),l=new RegExp("(\\s|^)("+u+")(?:(?=\\s|$))","mg"),d={recents:"idz-icon-emojis-recent",people:"idz-icon-emojis-people",nature:"idz-icon-emojis-animals-plants","food-drink":"idz-icon-emojis-food",objects:"idz-icon-emojis-objects","travel-places":"idz-icon-emojis-car",activity:"idz-icon-emojis-activity",symbols:"idz-icon-emojis-symbols",flags:"idz-icon-emojis-flag"},f={},h={},p={},g={},m={},v=function(t){for(var e=0,n=0,i=0,r=[];e<t.length;)n=t.charCodeAt(e++),i?(r.push((65536+(i-55296<<10)+(n-56320)).toString(16)),i=0):55296<=n&&n<=56319?i=n:r.push(n.toString(16));return r.join("-")},_=function(t,n){var i=g[t][n];return e+"/"+t+"/"+i.category+"/"+n+".png"},b=function(t){var e=r.get(a.get("emojis"),t,{name:"recents",emojis:[{char:"no recent",shortname:"noRecent",category:"recent",count:0}],fullName:"Recents"});return e.emojis=r.chain(e.emojis).sortBy(function(t){return t.count}).reverse().value(),e},y=function(t){var e=r.assign({},t);return r.forEach(e,function(t){t.emojis=r.filter(t.emojis,function(t){return!r.includes(n,t.shortname)})}),e},w=function(t,e){p[t]={},h[t]={},g[t]={},m[t]={},r.each(e,function(e){"recents"!==e.name&&r.each(e.emojis,function(e){p[t][e.unicode]=e.shortname,h[t][e.shortname]=e.char,g[t][e.shortname]=e,m[t][e.unicode]=e,r.has(e,"modifiers")&&r.each(e.modifiers,function(e){p[t][e.unicode]=e.shortname,h[t][e.shortname]=e.char,g[t][e.shortname]=e,m[t][e.unicode]=e})})})},S=function(t,e){var n=o(e);return!1===n?T(e):(n=r.map(n,function(e){var n=v(e);return r.has(m[t],n)?":"+p[t][n]+":":r.has(m.apple,n)?":"+p.apple[n]+":":e}),T(n.join("")))},T=function(t){return t.replace(l,function(t,e,n){return e+":"+s[n]+":"})},O=function(t,e,n){var i='<img src="<%url%>" data-char="<%char%>" data-shortname="<%shortname%>" class="emoji idzEmoji'+(n?" emojiBig":"")+'" alt="<%char%>"/>';return e=e.replace(c,function(e,n){var o=e;return r.has(h.apple,n)&&(o=i.replace(/<%char%>/g,h.apple[n]).replace(/<%url%>/g,_("apple",n)).replace(/<%shortname%>/g,n)),r.has(h[t],n)&&(o=i.replace(/<%char%>/g,h[t][n]).replace(/<%url%>/g,_(t,n)).replace(/<%shortname%>/g,n)),o})};return{getUnicode:v,getEmojiUrl:_,getSpriteUrl:function(t){return e+"/"+t+"/"+t+".png"},getJSONUrl:function(t){return e+"/"+t+"/"+t+".json"},getHistory:b,updateHistory:function(t,e){var n=a.get("emojis"),o=b(t).emojis;r.remove(o,{shortname:"noRecent"}),-1===r.findIndex(o,function(t){return t.unicode===e.unicode})?o=o.concat({shortname:e.shortname,char:e.char,category:"recent",count:1,unicode:e.unicode}):r.find(o,function(t){return t.unicode===e.unicode}).count+=1,r.size(o)>14&&(o=r.chain(o).sortBy("count").drop().value()),a.set("emojis",r.assign({},n,i({},t,r.assign(b(t),{emojis:o}))))},getEmojis:function(t,e){var n=f[t]||{};return e&&(n=r.assign(n,{recents:b(t)})),n},setEmojis:function(t,e){var n=y(e);return f[t]=r.merge(f[t]||{},n),w(t,n),f[t]},hasTheme:function(t){return r.has(f,t)},getIcons:function(){return d},replaceUtf8ToImage:function(t,e){var n=o(e),i=n&&1===n.length;return O(t,S(t,e),i)},replaceUtf8ToShortname:S,replaceAliasesToShortname:T,replaceShortnameToImage:O,replaceShortnameToUtf8:function(t,e){var n=T(e);return n=n.replace(c,function(e,n){var i=e;return r.has(h.apple,n)&&(i=h.apple[n]),r.has(h[t],n)&&(i=h[t][n]),i})}}}},{"./aliases.js":7,"emoji-aware":14,lodash:34,store:36}],9:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("fileupload",{connection:null,init:function(t){this.connection=t},requestSlot:function(e,n,i,r){var o=$iq({id:this.connection.getUniqueId(),from:this.connection.jid,to:"upload."+t.getDomainFromJid(this.connection.jid),type:"get"}).c("request",{xmlns:"urn:xmpp:http:upload"}).c("filename",{},e.name).c("size",{},e.size).c("content-type",{},e.contentType);this.connection.sendIQ(o,n,i,r)}})}},{}],10:[function(t,e,n){var i,r,o={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}};Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(t){return this._connection=t,this._muc_handler=null,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig"),Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(t,e,n,i,o,a,s,c){var u,l;return l=this.test_append_nick(t,e),u=$pres({from:this._connection.jid,to:l}).c("x",{xmlns:Strophe.NS.MUC}),null!=s&&(u=u.c("history",s).up()),null!=a&&u.cnode(Strophe.xmlElement("password",[],a)),null!=c&&u.up().cnode(c),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler(function(e){return function(n){var i,r,o,a,s,c,u,l,d;if(!(i=n.getAttribute("from")))return!0;if(c=i.split("/")[0],!e.rooms[c])return!0;if(t=e.rooms[c],r={},"message"===n.nodeName)r=t._message_handlers;else if("presence"===n.nodeName&&(d=n.getElementsByTagName("x")).length>0)for(o=0,s=d.length;o<s;o++)if(u=d[o],(l=u.getAttribute("xmlns"))&&l.match(Strophe.NS.MUC)){r=t._presence_handlers;break}for(a in r)(0,r[a])(n,t)||delete r[a];return!0}}(this))),this.rooms.hasOwnProperty(t)||(this.rooms[t]=new r(this,t,e,a),i&&this.rooms[t].addHandler("presence",i),n&&this.rooms[t].addHandler("message",n),o&&this.rooms[t].addHandler("roster",o),this.roomNames.push(t)),this._connection.send(u)},leave:function(t,e,n,i){var r,o,a,s;return r=this.roomNames.indexOf(t),delete this.rooms[t],r>=0&&(this.roomNames.splice(r,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),s=this.test_append_nick(t,e),a=this._connection.getUniqueId(),o=$pres({type:"unavailable",id:a,from:this._connection.jid,to:s}),null!=i&&o.c("status",i),null!=n&&this._connection.addHandler(n,null,"presence",null,a),this._connection.send(o),a},message:function(t,e,n,i,r,o){var a,s,c;return c=this.test_append_nick(t,e),r=r||(null!=e?"chat":"groupchat"),o=o||this._connection.getUniqueId(),(a=$msg({to:c,from:this._connection.jid,type:r,id:o}).c("body").t(n)).up(),null!=i&&(a.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).h(i),0===a.node.childNodes.length?(s=a.node.parentNode,a.up().up(),a.node.removeChild(s)):a.up().up()),a.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(a),o},groupchat:function(t,e,n,i){return this.message(t,null,e,n,void 0,i)},invite:function(t,e,n){var i,r;return r=this._connection.getUniqueId(),i=$msg({from:this._connection.jid,to:t,id:r}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:e}),null!=n&&i.c("reason",n),this._connection.send(i),r},multipleInvites:function(t,e,n){var i,r,o,a,s;for(a=this._connection.getUniqueId(),r=$msg({from:this._connection.jid,to:t,id:a}).c("x",{xmlns:Strophe.NS.MUC_USER}),i=0,o=e.length;i<o;i++)s=e[i],r.c("invite",{to:s}),null!=n&&(r.c("reason",n),r.up()),r.up();return this._connection.send(r),a},directInvite:function(t,e,n,i){var r,o,a;return a=this._connection.getUniqueId(),r={xmlns:"jabber:x:conference",jid:t},null!=n&&(r.reason=n),null!=i&&(r.password=i),o=$msg({from:this._connection.jid,to:e,id:a}).c("x",r),this._connection.send(o),a},queryOccupants:function(t,e,n){var i,r;return i={xmlns:Strophe.NS.DISCO_ITEMS},r=$iq({from:this._connection.jid,to:t,type:"get"}).c("query",i),this._connection.sendIQ(r,e,n)},configure:function(t,e,n){var i,r;return i=$iq({to:t,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),r=i.tree(),this._connection.sendIQ(r,e,n)},cancelConfigure:function(t){var e,n;return e=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=e.tree(),this._connection.sendIQ(n)},saveConfiguration:function(t,e,n,i){var r,o,a,s,c;if(a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),void 0!==Strophe.x&&void 0!==Strophe.x.Form&&e instanceof Strophe.x.Form)e.type="submit",a.cnode(e.toXML());else for(a.c("x",{xmlns:"jabber:x:data",type:"submit"}),o=0,s=e.length;o<s;o++)r=e[o],a.cnode(r).up();return c=a.tree(),this._connection.sendIQ(c,n,i)},createInstantRoom:function(t,e,n){var i;return i=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(i.tree(),e,n)},createConfiguredRoom:function(t,e,n,i){var r,a,s;(a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"})).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up();for(r in e)o.call(e,r)&&(s=e[r],a.c("field",{var:r}).c("value").t(s).up().up());return this._connection.sendIQ(a.tree(),n,i)},setTopic:function(t,e){var n;return n=$msg({to:t,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e),this._connection.send(n.tree())},_modifyPrivilege:function(t,e,n,i,r){var o;return o=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(e.node),null!=n&&o.c("reason",n),this._connection.sendIQ(o.tree(),i,r)},modifyRole:function(t,e,n,i,r,o){var a;return a=$build("item",{nick:e,role:n}),this._modifyPrivilege(t,a,i,r,o)},kick:function(t,e,n,i,r){return this.modifyRole(t,e,"none",n,i,r)},voice:function(t,e,n,i,r){return this.modifyRole(t,e,"participant",n,i,r)},mute:function(t,e,n,i,r){return this.modifyRole(t,e,"visitor",n,i,r)},op:function(t,e,n,i,r){return this.modifyRole(t,e,"moderator",n,i,r)},deop:function(t,e,n,i,r){return this.modifyRole(t,e,"participant",n,i,r)},modifyAffiliation:function(t,e,n,i,r,o){var a;return a=$build("item",{jid:e,affiliation:n}),this._modifyPrivilege(t,a,i,r,o)},ban:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"outcast",n,i,r)},member:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"member",n,i,r)},revoke:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"none",n,i,r)},owner:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"owner",n,i,r)},admin:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"admin",n,i,r)},changeNick:function(t,e){var n,i;return i=this.test_append_nick(t,e),n=$pres({from:this._connection.jid,to:i,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(t,e,n,i){var r,o;return o=this.test_append_nick(t,e),r=$pres({from:this._connection.jid,to:o}),null!=n&&r.c("show",n).up(),null!=i&&r.c("status",i),this._connection.send(r.tree())},registrationRequest:function(t,e,n){var i;return i=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(i,function(t){var n,i,r,o,a,s;for((i=t.getElementsByTagName("field")).length,o={required:[],optional:[]},a=0,s=i.length;a<s;a++)r={var:(n=i[a]).getAttribute("var"),label:n.getAttribute("label"),type:n.getAttribute("type")},n.getElementsByTagName("required").length>0?o.required.push(r):o.optional.push(r);return e(o)},n)},submitRegistrationForm:function(t,e,n,i){var r,o,a;(r=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER})).c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up();for(o in e)a=e[o],r.c("field",{var:o}).c("value").t(a).up().up();return this._connection.sendIQ(r,n,i)},listRooms:function(t,e,n){var i;return i=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(i,e,n)},test_append_nick:function(t,e){var n,i;return i=Strophe.escapeNode(Strophe.getNodeFromJid(t)),n=Strophe.getDomainFromJid(t),i+"@"+n+(null!=e?"/"+e:"")}}),r=function(){function t(t,e,n,i){this.client=t,this.name=e,this.nick=n,this.password=i,this._roomRosterHandler=a(this._roomRosterHandler,this),this._addOccupant=a(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return t.prototype.join=function(t,e,n){return this.client.join(this.name,this.nick,t,e,n,this.password)},t.prototype.leave=function(t,e){return this.client.leave(this.name,this.nick,t,e),delete this.client.rooms[this.name]},t.prototype.message=function(t,e,n,i){return this.client.message(this.name,t,e,n,i)},t.prototype.groupchat=function(t,e){return this.client.groupchat(this.name,t,e)},t.prototype.invite=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.multipleInvites=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.directInvite=function(t,e){return this.client.directInvite(this.name,t,e,this.password)},t.prototype.configure=function(t){return this.client.configure(this.name,t)},t.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},t.prototype.saveConfiguration=function(t){return this.client.saveConfiguration(this.name,t)},t.prototype.queryOccupants=function(t,e){return this.client.queryOccupants(this.name,t,e)},t.prototype.setTopic=function(t){return this.client.setTopic(this.name,t)},t.prototype.modifyRole=function(t,e,n,i,r){return this.client.modifyRole(this.name,t,e,n,i,r)},t.prototype.kick=function(t,e,n,i){return this.client.kick(this.name,t,e,n,i)},t.prototype.voice=function(t,e,n,i){return this.client.voice(this.name,t,e,n,i)},t.prototype.mute=function(t,e,n,i){return this.client.mute(this.name,t,e,n,i)},t.prototype.op=function(t,e,n,i){return this.client.op(this.name,t,e,n,i)},t.prototype.deop=function(t,e,n,i){return this.client.deop(this.name,t,e,n,i)},t.prototype.modifyAffiliation=function(t,e,n,i,r){return this.client.modifyAffiliation(this.name,t,e,n,i,r)},t.prototype.ban=function(t,e,n,i){return this.client.ban(this.name,t,e,n,i)},t.prototype.member=function(t,e,n,i){return this.client.member(this.name,t,e,n,i)},t.prototype.revoke=function(t,e,n,i){return this.client.revoke(this.name,t,e,n,i)},t.prototype.owner=function(t,e,n,i){return this.client.owner(this.name,t,e,n,i)},t.prototype.admin=function(t,e,n,i){return this.client.admin(this.name,t,e,n,i)},t.prototype.changeNick=function(t){return this.nick=t,this.client.changeNick(this.name,nick)},t.prototype.setStatus=function(t,e){return this.client.setStatus(this.name,this.nick,t,e)},t.prototype.addHandler=function(t,e){var n;switch(n=this._handler_ids++,t){case"presence":this._presence_handlers[n]=e;break;case"message":this._message_handlers[n]=e;break;case"roster":this._roster_handlers[n]=e;break;default:return this._handler_ids--,null}return n},t.prototype.removeHandler=function(t){return delete this._presence_handlers[t],delete this._message_handlers[t],delete this._roster_handlers[t]},t.prototype._addOccupant=function(t){var e;return e=new i(t,this),this.roster[e.nick]=e,e},t.prototype._roomRosterHandler=function(e){var n,i,r,o,a;switch(n=t._parsePresence(e),o=n.nick,r=n.newnick||null,n.type){case"error":return!0;case"unavailable":r&&(n.nick=r,this.roster[o]&&this.roster[r]&&(this.roster[o].update(this.roster[r]),this.roster[r]=this.roster[o]),this.roster[o]&&!this.roster[r]&&(this.roster[r]=this.roster[o].update(n))),delete this.roster[o];break;default:this.roster[o]?this.roster[o].update(n):this._addOccupant(n)}a=this._roster_handlers;for(i in a)(0,a[i])(this.roster,this)||delete this._roster_handlers[i];return!0},t._parsePresence=function(t){var e,n,i,r,o,a,s,c,u;for((i={}).nick=Strophe.getResourceFromJid(t.getAttribute("from")),i.type=t.getAttribute("type"),i.states=[],r=0,a=(c=t.childNodes).length;r<a;r++)switch((e=c[r]).nodeName){case"status":i.status=e.textContent||null;break;case"show":i.show=e.textContent||null;break;case"x":if(e.getAttribute("xmlns")===Strophe.NS.MUC_USER)for(o=0,s=(u=e.childNodes).length;o<s;o++)switch((n=u[o]).nodeName){case"item":i.affiliation=n.getAttribute("affiliation"),i.role=n.getAttribute("role"),i.jid=n.getAttribute("jid"),i.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&i.states.push(n.getAttribute("code"))}}return i},t}(),function(){function t(t){this.parse=a(this.parse,this),null!=t&&this.parse(t)}t.prototype.parse=function(t){var e,n,i,r,o,a,s,c,u,l,d,f,h;for(f=t.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,u=f.length;o<u;o++)switch(i=f[o],n=i.attributes,i.nodeName){case"identity":for(a={},s=0,l=n.length;s<l;s++)a[(e=n[s]).name]=e.textContent;this.identities.push(a);break;case"feature":this.features.push(i.getAttribute("var"));break;case"x":if("FORM_TYPE"===!i.childNodes[0].getAttribute("var")||"hidden"===!i.childNodes[0].getAttribute("type"))break;for(c=0,d=(h=i.childNodes).length;c<d;c++)(r=h[c]).attributes.type||this.x.push({var:r.getAttribute("var"),label:r.getAttribute("label")||"",value:r.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}}}(),i=function(){function t(t,e){this.room=e,this.update=a(this.update,this),this.admin=a(this.admin,this),this.owner=a(this.owner,this),this.revoke=a(this.revoke,this),this.member=a(this.member,this),this.ban=a(this.ban,this),this.modifyAffiliation=a(this.modifyAffiliation,this),this.deop=a(this.deop,this),this.op=a(this.op,this),this.mute=a(this.mute,this),this.voice=a(this.voice,this),this.kick=a(this.kick,this),this.modifyRole=a(this.modifyRole,this),this.update(t)}return t.prototype.modifyRole=function(t,e,n,i){return this.room.modifyRole(this.nick,t,e,n,i)},t.prototype.kick=function(t,e,n){return this.room.kick(this.nick,t,e,n)},t.prototype.voice=function(t,e,n){return this.room.voice(this.nick,t,e,n)},t.prototype.mute=function(t,e,n){return this.room.mute(this.nick,t,e,n)},t.prototype.op=function(t,e,n){return this.room.op(this.nick,t,e,n)},t.prototype.deop=function(t,e,n){return this.room.deop(this.nick,t,e,n)},t.prototype.modifyAffiliation=function(t,e,n,i){return this.room.modifyAffiliation(this.jid,t,e,n,i)},t.prototype.ban=function(t,e,n){return this.room.ban(this.jid,t,e,n)},t.prototype.member=function(t,e,n){return this.room.member(this.jid,t,e,n)},t.prototype.revoke=function(t,e,n){return this.room.revoke(this.jid,t,e,n)},t.prototype.owner=function(t,e,n){return this.room.owner(this.jid,t,e,n)},t.prototype.admin=function(t,e,n){return this.room.admin(this.jid,t,e,n)},t.prototype.update=function(t){return this.nick=t.nick||null,this.affiliation=t.affiliation||null,this.role=t.role||null,this.jid=t.jid||null,this.status=t.status||null,this.show=t.show||null,this},t}()},{}],11:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("outofband",{_conn:null,init:function(e){this._conn=e,t.addNamespace("OUTOFBAND","jabber:iq:oob")},sendIq:function(e,n){var i=null;return $(e).filter("iq").each(function(){var e=$(this).find("url:first").text(),r=$(this).find("desc:first").text();switch(n){case null:i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"result",id:$(this).attr("id")});break;case"404":i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},r).up().c("error",{code:"404",type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;case"406":i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},r).up().c("error",{code:"406",type:"modify"}).c("not-acceptable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;default:console.log("Unhandled errorcode: a response has not been sent")}}),i&&(console.log(i.toString()),this._conn.send(i)),i},sendUrl:function(e,n,i){var r=$iq({id:this._conn.getUniqueId(),type:"set",from:this._conn.jid,to:e}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},n).c("desc",{},i);this._conn.send(r)},addOutOfBandHandler:function(e,n,i,r){this._conn.addHandler(e,t.NS.OUTOFBAND,"iq",n,null,i,r)}})}},{}],12:[function(t,e,n){Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,_requestCallbacks:{},init:function(t){this._conn=t,Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(t){if(t===Strophe.Status.CONNECTED||t===Strophe.Status.ATTACHED){var e=this;setTimeout(function(){e.resendQueue()},4e3)}},sendMessage:function(t,e,n){var i=t.tree().getAttribute("id");i||(i=+new Date,t.tree().setAttribute("id",i));var r=Strophe.xmlElement("request",{xmlns:Strophe.NS.RECEIPTS});return t.tree().appendChild(r),this._msgQueue[i]=t,this._retries[i]=0,(e||n)&&(this._requestCallbacks[i]=[e,n]),this._conn.send(t),n||this.resendMessage(i),i},resendMessage:function(t){var e=this;setTimeout(function(){if(e._msgQueue[t]){if(!e._conn.connected)return void e.resendMessage(t);if(++e._retries[t]>e._resendCount)return;e._msgQueue[t].tree().setAttribute("from",e._conn.jid),e._conn.send(e._msgQueue[t]),e.resendMessage(t)}},this._resendTime)},addReceiptHandler:function(t,e,n,i){var r=this;this._conn.addHandler(function(e){var n=t(e);return r._processReceipt(e,n),n},Strophe.NS.RECEIPTS,"message",e,null,n,i)},_processReceipt:function(t,e){var n=t.getAttribute("id"),i=t.getAttribute("from"),r=t.getElementsByTagName("request"),o=t.getElementsByTagName("received"),a="error"===t.getAttribute("type"),s=this;if(r.length>0&&!a&&(e&&"object"==typeof e&&"done"in e?e.done(function(){s.sendReceipt(i,n)}):this.sendReceipt(i,n)),o.length>0){var c=o[0].getAttribute("id");if(c&&(delete this._msgQueue[c],delete this._retries[c],c in this._requestCallbacks)){var u=this._requestCallbacks[c][a?1:0];u&&u.apply(null),delete this._requestCallbacks[c]}}},sendReceipt:function(t,e){var n=$msg({to:t,from:this._conn.jid,id:this._conn.getUniqueId()}),i=Strophe.xmlElement("received",{xmlns:Strophe.NS.RECEIPTS,id:e});n.tree().appendChild(i),this._conn.send(n)},resendQueue:function(){if(this._conn.connected)for(var t in this._msgQueue)this._msgQueue.hasOwnProperty(t)&&(this._msgQueue[t].tree().setAttribute("from",this._conn.jid),this._conn.send(this._msgQueue[t]));else{var e=this;setTimeout(function(){e.resendQueue()},4e3)}},getUnreceivedMsgs:function(){var t=[];for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&t.push(this._msgQueue[e]);return t},clearMessages:function(){this._msgQueue={}}})},{}],13:[function(e,n,i){!function(t,e){"function"==typeof define&&define.amd?define("strophe-base64",function(){return e()}):t.Base64=e()}(this,function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var n,i,r,o,a,s,c,u="",l=0;do{o=(n=e.charCodeAt(l++))>>2,a=(3&n)<<4|(i=e.charCodeAt(l++))>>4,s=(15&i)<<2|(r=e.charCodeAt(l++))>>6,c=63&r,isNaN(i)?(a=(3&n)<<4,s=c=64):isNaN(r)&&(c=64),u=u+t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(c)}while(l<e.length);return u},decode:function(e){var n,i,r,o,a,s,c="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{n=t.indexOf(e.charAt(u++))<<2|(o=t.indexOf(e.charAt(u++)))>>4,i=(15&o)<<4|(a=t.indexOf(e.charAt(u++)))>>2,r=(3&a)<<6|(s=t.indexOf(e.charAt(u++))),c+=String.fromCharCode(n),64!=a&&(c+=String.fromCharCode(i)),64!=s&&(c+=String.fromCharCode(r))}while(u<e.length);return c}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-sha1",function(){return e()}):t.SHA1=e()}(this,function(){function t(t,i){t[i>>5]|=128<<24-i%32,t[15+(i+64>>9<<4)]=i;var a,s,c,u,l,d,f,h,p=new Array(80),g=1732584193,m=-271733879,v=-1732584194,_=271733878,b=-1009589776;for(a=0;a<t.length;a+=16){for(u=g,l=m,d=v,f=_,h=b,s=0;s<80;s++)p[s]=s<16?t[a+s]:o(p[s-3]^p[s-8]^p[s-14]^p[s-16],1),c=r(r(o(g,5),e(s,m,v,_)),r(r(b,p[s]),n(s))),b=_,_=v,v=o(m,30),m=g,g=c;g=r(g,u),m=r(m,l),v=r(v,d),_=r(_,f),b=r(b,h)}return[g,m,v,_,b]}function e(t,e,n,i){return t<20?e&n|~e&i:t<40?e^n^i:t<60?e&n|e&i|n&i:e^n^i}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function i(e,n){var i=a(e);i.length>16&&(i=t(i,8*e.length));for(var r=new Array(16),o=new Array(16),s=0;s<16;s++)r[s]=909522486^i[s],o[s]=1549556828^i[s];var c=t(r.concat(a(n)),512+8*n.length);return t(o.concat(c),672)}function r(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e){return t<<e|t>>>32-e}function a(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function s(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function c(t){for(var e,n,i="",r=0;r<4*t.length;r+=3)for(e=(t[r>>2]>>8*(3-r%4)&255)<<16|(t[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|t[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)8*r+6*n>32*t.length?i+="=":i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-n)&63);return i}return{b64_hmac_sha1:function(t,e){return c(i(t,e))},b64_sha1:function(e){return c(t(a(e),8*e.length))},binb2str:s,core_hmac_sha1:i,str_hmac_sha1:function(t,e){return s(i(t,e))},str_sha1:function(e){return s(t(a(e),8*e.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-md5",function(){return e()}):t.MD5=e()}(this,function(t){var e=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},n=function(t,e){return t<<e|t>>>32-e},i=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},r=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},o=function(t){for(var e="",n=0;n<4*t.length;n++)e+="0123456789abcdef".charAt(t[n>>2]>>n%4*8+4&15)+"0123456789abcdef".charAt(t[n>>2]>>n%4*8&15);return e},a=function(t,i,r,o,a,s){return e(n(e(e(i,t),e(o,s)),a),r)},s=function(t,e,n,i,r,o,s){return a(e&n|~e&i,t,e,r,o,s)},c=function(t,e,n,i,r,o,s){return a(e&i|n&~i,t,e,r,o,s)},u=function(t,e,n,i,r,o,s){return a(e^n^i,t,e,r,o,s)},l=function(t,e,n,i,r,o,s){return a(n^(e|~i),t,e,r,o,s)},d=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var i,r,o,a,d=1732584193,f=-271733879,h=-1732584194,p=271733878,g=0;g<t.length;g+=16)i=d,r=f,o=h,a=p,d=s(d,f,h,p,t[g+0],7,-680876936),p=s(p,d,f,h,t[g+1],12,-389564586),h=s(h,p,d,f,t[g+2],17,606105819),f=s(f,h,p,d,t[g+3],22,-1044525330),d=s(d,f,h,p,t[g+4],7,-176418897),p=s(p,d,f,h,t[g+5],12,1200080426),h=s(h,p,d,f,t[g+6],17,-1473231341),f=s(f,h,p,d,t[g+7],22,-45705983),d=s(d,f,h,p,t[g+8],7,1770035416),p=s(p,d,f,h,t[g+9],12,-1958414417),h=s(h,p,d,f,t[g+10],17,-42063),f=s(f,h,p,d,t[g+11],22,-1990404162),d=s(d,f,h,p,t[g+12],7,1804603682),p=s(p,d,f,h,t[g+13],12,-40341101),h=s(h,p,d,f,t[g+14],17,-1502002290),f=s(f,h,p,d,t[g+15],22,1236535329),d=c(d,f,h,p,t[g+1],5,-165796510),p=c(p,d,f,h,t[g+6],9,-1069501632),h=c(h,p,d,f,t[g+11],14,643717713),f=c(f,h,p,d,t[g+0],20,-373897302),d=c(d,f,h,p,t[g+5],5,-701558691),p=c(p,d,f,h,t[g+10],9,38016083),h=c(h,p,d,f,t[g+15],14,-660478335),f=c(f,h,p,d,t[g+4],20,-405537848),d=c(d,f,h,p,t[g+9],5,568446438),p=c(p,d,f,h,t[g+14],9,-1019803690),h=c(h,p,d,f,t[g+3],14,-187363961),f=c(f,h,p,d,t[g+8],20,1163531501),d=c(d,f,h,p,t[g+13],5,-1444681467),p=c(p,d,f,h,t[g+2],9,-51403784),h=c(h,p,d,f,t[g+7],14,1735328473),f=c(f,h,p,d,t[g+12],20,-1926607734),d=u(d,f,h,p,t[g+5],4,-378558),p=u(p,d,f,h,t[g+8],11,-2022574463),h=u(h,p,d,f,t[g+11],16,1839030562),f=u(f,h,p,d,t[g+14],23,-35309556),d=u(d,f,h,p,t[g+1],4,-1530992060),p=u(p,d,f,h,t[g+4],11,1272893353),h=u(h,p,d,f,t[g+7],16,-155497632),f=u(f,h,p,d,t[g+10],23,-1094730640),d=u(d,f,h,p,t[g+13],4,681279174),p=u(p,d,f,h,t[g+0],11,-358537222),h=u(h,p,d,f,t[g+3],16,-722521979),f=u(f,h,p,d,t[g+6],23,76029189),d=u(d,f,h,p,t[g+9],4,-640364487),p=u(p,d,f,h,t[g+12],11,-421815835),h=u(h,p,d,f,t[g+15],16,530742520),f=u(f,h,p,d,t[g+2],23,-995338651),d=l(d,f,h,p,t[g+0],6,-198630844),p=l(p,d,f,h,t[g+7],10,1126891415),h=l(h,p,d,f,t[g+14],15,-1416354905),f=l(f,h,p,d,t[g+5],21,-57434055),d=l(d,f,h,p,t[g+12],6,1700485571),p=l(p,d,f,h,t[g+3],10,-1894986606),h=l(h,p,d,f,t[g+10],15,-1051523),f=l(f,h,p,d,t[g+1],21,-2054922799),d=l(d,f,h,p,t[g+8],6,1873313359),p=l(p,d,f,h,t[g+15],10,-30611744),h=l(h,p,d,f,t[g+6],15,-1560198380),f=l(f,h,p,d,t[g+13],21,1309151649),d=l(d,f,h,p,t[g+4],6,-145523070),p=l(p,d,f,h,t[g+11],10,-1120210379),h=l(h,p,d,f,t[g+2],15,718787259),f=l(f,h,p,d,t[g+9],21,-343485551),d=e(d,i),f=e(f,r),h=e(h,o),p=e(p,a);return[d,f,h,p]};return{hexdigest:function(t){return o(d(i(t),8*t.length))},hash:function(t){return r(d(i(t),8*t.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-utils",function(){return e()}):t.stropheUtils=e()}(this,function(){return{utf16to8:function(t){var e,n,i="",r=t.length;for(e=0;e<r;e++)(n=t.charCodeAt(e))>=0&&n<=127?i+=t.charAt(e):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},addCookies:function(t){var e,n,i,r,o,a,s;for(e in t||{})o="",a="",s="",i="object"==typeof(n=t[e]),r=escape(unescape(i?n.value:n)),i&&(o=n.expires?";expires="+n.expires:"",a=n.domain?";domain="+n.domain:"",s=n.path?";path="+n.path:""),document.cookie=e+"="+r+o+a+s}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-polyfill",[],function(){return e()}):t.polyfills=e()}(this,function(){var t={bind:function(t,e){var n=Array.prototype.slice,i=Array.prototype.concat,r=n.call(arguments,2);return function(){return t.apply(e||this,i.call(r,n.call(arguments,0)))}}};return Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),t}),function(t,e){if("function"==typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return e.apply(this,arguments)});else{var n=e(t.SHA1,t.Base64,t.MD5,t.stropheUtils,t.polyfills);t.Strophe=n.Strophe,t.$build=n.$build,t.$iq=n.$iq,t.$msg=n.$msg,t.$pres=n.$pres}}(this,function(e,n,i,r,o){function a(t,e){return new u.Builder(t,e)}function s(t){return new u.Builder("iq",t)}function c(t){return new u.Builder("presence",t)}var u,l=o.bind;return u={bind:l,VERSION:"3.2.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<u.XHTML.tags.length;e++)if(t==u.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==u.XHTML.attributes[t]&&u.XHTML.attributes[t].length>0)for(var n=0;n<u.XHTML.attributes[t].length;n++)if(e==u.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<u.XHTML.css.length;e++)if(t==u.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){u.NS[t]=e},forEachChild:function(t,e,n){var i,r;for(i=0;i<t.childNodes.length;i++)(r=t.childNodes[i]).nodeType!=u.ElementType.NORMAL||e&&!this.isTagEqual(r,e)||n(r)},isTagEqual:function(t,e){return t.tagName==e},_xmlGenerator:null,_makeGenerator:function(){var e;return document.implementation.createDocument===t||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return u._xmlGenerator||(u._xmlGenerator=u._makeGenerator()),u._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(e){if(!e)return null;var n,i,r,o=u.xmlGenerator().createElement(e);for(n=1;n<arguments.length;n++){var a=arguments[n];if(a)if("string"==typeof a||"number"==typeof a)o.appendChild(u.xmlTextNode(a));else if("object"==typeof a&&"function"==typeof a.sort)for(i=0;i<a.length;i++){var s=a[i];"object"==typeof s&&"function"==typeof s.sort&&s[1]!==t&&null!==s[1]&&o.setAttribute(s[0],s[1])}else if("object"==typeof a)for(r in a)a.hasOwnProperty(r)&&a[r]!==t&&null!==a[r]&&o.setAttribute(r,a[r])}return o},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return u.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;return window.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType==u.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==u.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return u.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType==u.ElementType.NORMAL){for(n=u.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(u.copyElement(t.childNodes[e]))}else t.nodeType==u.ElementType.TEXT&&(n=u.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,i,r,o,a,s,c,l,d,f;if(t.nodeType==u.ElementType.NORMAL)if(r=t.nodeName.toLowerCase(),u.XHTML.validTag(r))try{for(n=u.xmlElement(r),e=0;e<u.XHTML.attributes[r].length;e++)if(o=u.XHTML.attributes[r][e],void 0!==(a=t.getAttribute(o))&&null!==a&&""!==a&&!1!==a&&0!==a)if("style"==o&&"object"==typeof a&&void 0!==a.cssText&&(a=a.cssText),"style"==o){for(s=[],c=a.split(";"),i=0;i<c.length;i++)d=(l=c[i].split(":"))[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),u.XHTML.validCSS(d)&&(f=l[1].replace(/^\s*/,"").replace(/\s*$/,""),s.push(d+": "+f));s.length>0&&(a=s.join("; "),n.setAttribute(o,a))}else n.setAttribute(o,a);for(e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]))}catch(t){n=u.xmlTextNode("")}else for(n=u.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]));else if(t.nodeType==u.ElementType.FRAGMENT)for(n=u.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(u.createHtml(t.childNodes[e]));else t.nodeType==u.ElementType.TEXT&&(n=u.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=u.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,i,r=t.nodeName;for(t.getAttribute("_realname")&&(r=t.getAttribute("_realname")),e="<"+r,n=0;n<t.attributes.length;n++)"_realname"!=t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+u.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch((i=t.childNodes[n]).nodeType){case u.ElementType.NORMAL:e+=u.serialize(i);break;case u.ElementType.TEXT:e+=u.xmlescape(i.nodeValue);break;case u.ElementType.CDATA:e+="<![CDATA["+i.nodeValue+"]]>"}e+="</"+r+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){u._connectionPlugins[t]=e}},u.Builder=function(t,e){"presence"!=t&&"message"!=t&&"iq"!=t||(e&&!e.xmlns?e.xmlns=u.NS.CLIENT:e||(e={xmlns:u.NS.CLIENT})),this.nodeTree=u.xmlElement(t,e),this.node=this.nodeTree},u.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return u.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(e){for(var n in e)e.hasOwnProperty(n)&&(e[n]===t?this.node.removeAttribute(n):this.node.setAttribute(n,e[n]));return this},c:function(t,e,n){var i=u.xmlElement(t,e,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(e){var n,i=u.xmlGenerator();try{n=i.importNode!==t}catch(t){n=!1}var r=n?i.importNode(e,!0):u.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(t){var e=u.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=u.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},u.Handler=function(t,e,n,i,r,o,a){this.handler=t,this.ns=e,this.name=n,this.type=i,this.id=r,this.options=a||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=o?u.getBareJidFromJid(o):null:this.from=o,this.user=!0},u.Handler.prototype={isMatch:function(t){var e,n=null;if(n=this.options.matchBare?u.getBareJidFromJid(t.getAttribute("from")):t.getAttribute("from"),e=!1,this.ns){var i=this;u.forEachChild(t,null,function(t){t.getAttribute("xmlns")==i.ns&&(e=!0)}),e=e||t.getAttribute("xmlns")==this.ns}else e=!0;var r=t.getAttribute("type");return!(!e||this.name&&!u.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(r):r!=this.type)||this.id&&t.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw t.sourceURL?u.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",t,t.message)),u.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message)):u.fatal("error: "+t.message+"\n"+t.stack),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},u.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},u.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},u.Connection=function(t,e){this.service=t,this.options=e||{};var n=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new u.Websocket(this):this._proto=new u.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(l(this._onIdle,this),100),r.addCookies(this.options.cookies);for(var i in u._connectionPlugins)if(u._connectionPlugins.hasOwnProperty(i)){var o=u._connectionPlugins[i],a=function(){};a.prototype=o,this[i]=new a,this[i].init(this)}},u.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},connect:function(t,e,n,i,r,o,a){this.jid=t,this.authzid=u.getBareJidFromJid(this.jid),this.authcid=a||u.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=u.getDomainFromJid(this.jid),this._changeConnectStatus(u.Status.CONNECTING,null),this._proto._connect(i,r,o)},attach:function(t,e,n,i,r,o,a){if(!(this._proto instanceof u.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,i,r,o,a)},restore:function(t,e,n,i,r){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,i,r)},_sessionCachingSupported:function(){if(this._proto instanceof u.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(t,e,n,i){var r=null,o=this;"function"==typeof t.tree&&(t=t.tree());var a=t.getAttribute("id");a||(a=this.getUniqueId("sendIQ"),t.setAttribute("id",a));var s=t.getAttribute("to"),c=this.jid,l=this.addHandler(function(t){r&&o.deleteTimedHandler(r);var i=!1,a=t.getAttribute("from");if(a!==s&&(s||a!==u.getBareJidFromJid(c)&&a!==u.getDomainFromJid(c)&&a!==c)||(i=!0),!i)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+a+"\nExpected jid: "+s};var l=t.getAttribute("type");if("result"==l)e&&e(t);else{if("error"!=l)throw{name:"StropheError",message:"Got bad IQ type of "+l};n&&n(t)}},null,"iq",["error","result"],a);return i&&(r=this.addTimedHandler(i,function(){return o.deleteHandler(l),n&&n(null),!1})),this.send(t),a},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(l(this._onIdle,this),100)},addTimedHandler:function(t,e){var n=new u.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,i,r,o,a){var s=new u.Handler(t,e,n,i,r,o,a);return this.addHandlers.push(s),s},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},disconnect:function(t){if(this._changeConnectStatus(u.Status.DISCONNECTING,t),u.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=c({xmlns:u.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,l(this._onDisconnectTimeout,this)),this._proto._disconnect(e)}else u.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(t,e){for(var n in u._connectionPlugins)if(u._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(t,e)}catch(t){u.error(n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){u.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),u.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(u.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){u.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==u.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==u.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(u.serialize(n)));for(var i,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),(i=this.handlers.indexOf(r))>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var o,a,s=n.getAttribute("type");if(null!==s&&"terminate"==s){if(this.disconnecting)return;return o=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"==o&&a.length>0&&(o="conflict"),this._changeConnectStatus(u.Status.CONNFAIL,o)):this._changeConnectStatus(u.Status.CONNFAIL,"unknown"),void this._doDisconnect(o)}var c=this;u.forEachChild(n,null,function(t){var e,n;for(n=c.handlers,c.handlers=[],e=0;e<n.length;e++){var i=n[e];try{!i.isMatch(t)||!c.authenticated&&i.user?c.handlers.push(i):i.run(t)&&c.handlers.push(i)}catch(t){u.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}}},mechanisms:{},_connect_cb:function(t,e,n){u.info("_connect_cb was called"),this.connected=!0;var i;try{i=this._proto._reqToData(t)}catch(t){if("badformat"!=t)throw t;this._changeConnectStatus(u.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(i&&(this.xmlInput!==u.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==u.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(u.serialize(i))),this._proto._connect_cb(i)!==u.Status.CONNFAIL)){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var r;r=i.getElementsByTagNameNS?i.getElementsByTagNameNS(u.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0;var o,a,s=i.getElementsByTagName("mechanism"),c=[];if(r){if(s.length>0)for(o=0;o<s.length;o++)a=u.getText(s[o]),this.mechanisms[a]&&c.push(this.mechanisms[a]);this._authentication.legacy_auth=i.getElementsByTagName("auth").length>0,this._authentication.legacy_auth||c.length>0?!1!==this.do_authentication&&this.authenticate(c):this._proto._no_auth_received(e)}else this._proto._no_auth_received(e)}},authenticate:function(t){var e;for(e=0;e<t.length-1;++e){for(var i=e,r=e+1;r<t.length;++r)t[r].prototype.priority>t[i].prototype.priority&&(i=r);if(i!=e){var o=t[e];t[e]=t[i],t[i]=o}}var c=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(l(this._sasl_success_cb,this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(l(this._sasl_failure_cb,this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(l(this._sasl_challenge_cb,this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var d=a("auth",{xmlns:u.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var f=this._sasl_mechanism.onChallenge(this,null);d.t(n.encode(f))}this.send(d.tree()),c=!0;break}c||(null===u.getNodeFromJid(this.jid)?(this._changeConnectStatus(u.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(u.Status.AUTHENTICATING,null),this._addSysHandler(l(this._auth1_cb,this),null,null,null,"_auth_1"),this.send(s({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(t){var e=n.decode(u.getText(t)),i=this._sasl_mechanism.onChallenge(this,e),r=a("response",{xmlns:u.NS.SASL});return""!==i&&r.t(n.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(t){var e=s({type:"set",id:"_auth_2"}).c("query",{xmlns:u.NS.AUTH}).c("username",{}).t(u.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return u.getResourceFromJid(this.jid)||(this.jid=u.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(u.getResourceFromJid(this.jid)),this._addSysHandler(l(this._auth2_cb,this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,i=/([a-z]+)=([^,]+)(,|$)/,r=n.decode(u.getText(t)).match(i);if("v"==r[1]&&(e=r[2]),e!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}u.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],a=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return l(this._sasl_auth1_cb,this)(e),!1};return o.push(this._addSysHandler(l(function(t){l(a,this)(o,t)},this),null,"stream:features",null,null)),o.push(this._addSysHandler(l(function(t){l(a,this)(o,t)},this),u.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)"bind"==(n=t.childNodes[e]).nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;this._addSysHandler(l(this._sasl_bind_cb,this),null,null,null,"_bind_auth_2");var i=u.getResourceFromJid(this.jid);return i?this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).c("resource",{}).t(i).tree()):this.send(s({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:u.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"==t.getAttribute("type")){u.info("SASL binding failed.");var e;return t.getElementsByTagName("conflict").length>0&&(e="conflict"),this._changeConnectStatus(u.Status.AUTHFAIL,e),!1}var n,i=t.getElementsByTagName("bind");if(!(i.length>0))return u.info("SASL binding failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;(n=i[0].getElementsByTagName("jid")).length>0&&(this.jid=u.getText(n[0]),this.do_session?(this._addSysHandler(l(this._sasl_session_cb,this),null,null,null,"_session_auth_2"),this.send(s({type:"set",id:"_session_auth_2"}).c("session",{xmlns:u.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"==t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null);else if("error"==t.getAttribute("type"))return u.info("Session creation failed."),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(u.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"==t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(u.Status.CONNECTED,null)):"error"==t.getAttribute("type")&&(this._changeConnectStatus(u.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new u.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,i,r){var o=new u.Handler(t,e,n,i,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return u.info("_onDisconnectTimeout was called"),this._changeConnectStatus(u.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var i=(new Date).getTime();for(n=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(e.lastCalled+e.period-i<=0?e.run()&&n.push(e):n.push(e));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(l(this._onIdle,this),100))}},u.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},u.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},u.SASLAnonymous=function(){},u.SASLAnonymous.prototype=new u.SASLMechanism("ANONYMOUS",!1,10),u.SASLAnonymous.prototype.test=function(t){return null===t.authcid},u.Connection.prototype.mechanisms[u.SASLAnonymous.prototype.name]=u.SASLAnonymous,u.SASLPlain=function(){},u.SASLPlain.prototype=new u.SASLMechanism("PLAIN",!0,20),u.SASLPlain.prototype.test=function(t){return null!==t.authcid},u.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,r.utf16to8(e)},u.Connection.prototype.mechanisms[u.SASLPlain.prototype.name]=u.SASLPlain,u.SASLSHA1=function(){},u.SASLSHA1.prototype=new u.SASLMechanism("SCRAM-SHA-1",!0,40),u.SASLSHA1.prototype.test=function(t){return null!==t.authcid},u.SASLSHA1.prototype.onChallenge=function(t,o,a){var s=a||i.hexdigest(1234567890*Math.random()),c="n="+r.utf16to8(t.authcid);return c+=",r=",c+=s,t._sasl_data.cnonce=s,t._sasl_data["client-first-message-bare"]=c,c="n,,"+c,this.onChallenge=l(function(t,i){for(var o,a,s,c,u,l,d,f,h,p,g,m="c=biws,",v=t._sasl_data["client-first-message-bare"]+","+i+",",_=t._sasl_data.cnonce,b=/([a-z]+)=([^,]+)(,|$)/;i.match(b);){var y=i.match(b);switch(i=i.replace(y[0],""),y[1]){case"r":o=y[2];break;case"s":a=y[2];break;case"i":s=y[2]}}if(o.substr(0,_.length)!==_)return t._sasl_data={},t._sasl_failure_cb();v+=m+="r="+o,a=n.decode(a),a+="\0\0\0";var w=r.utf16to8(t.pass);for(c=l=e.core_hmac_sha1(w,a),d=1;d<s;d++){for(u=e.core_hmac_sha1(w,e.binb2str(l)),f=0;f<5;f++)c[f]^=u[f];l=u}for(c=e.binb2str(c),h=e.core_hmac_sha1(c,"Client Key"),p=e.str_hmac_sha1(c,"Server Key"),g=e.core_hmac_sha1(e.str_sha1(e.binb2str(h)),v),t._sasl_data["server-signature"]=e.b64_hmac_sha1(p,v),f=0;f<5;f++)h[f]^=g[f];return m+=",p="+n.encode(e.binb2str(h))},this),c},u.Connection.prototype.mechanisms[u.SASLSHA1.prototype.name]=u.SASLSHA1,u.SASLMD5=function(){},u.SASLMD5.prototype=new u.SASLMechanism("DIGEST-MD5",!1,30),u.SASLMD5.prototype.test=function(t){return null!==t.authcid},u.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},u.SASLMD5.prototype.onChallenge=function(t,e,n){for(var o,a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=n||i.hexdigest(""+1234567890*Math.random()),c="",u=null,d="";e.match(a);)switch(o=e.match(a),e=e.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":c=o[2];break;case"nonce":d=o[2];break;case"qop":o[2];break;case"host":u=o[2]}var f=t.servtype+"/"+t.domain;null!==u&&(f=f+"/"+u);var h=r.utf16to8(t.authcid+":"+c+":"+this._connection.pass),p=i.hash(h)+":"+d+":"+s,g="AUTHENTICATE:"+f,m="";return m+="charset=utf-8,",m+="username="+this._quote(r.utf16to8(t.authcid))+",",m+="realm="+this._quote(c)+",",m+="nonce="+this._quote(d)+",",m+="nc=00000001,",m+="cnonce="+this._quote(s)+",",m+="digest-uri="+this._quote(f)+",",m+="response="+i.hexdigest(i.hexdigest(p)+":"+d+":00000001:"+s+":auth:"+i.hexdigest(g))+",",m+="qop=auth",this.onChallenge=l(function(){return""},this),m},u.Connection.prototype.mechanisms[u.SASLMD5.prototype.name]=u.SASLMD5,u.SASLOAuthBearer=function(){},u.SASLOAuthBearer.prototype=new u.SASLMechanism("OAUTHBEARER",!0,50),u.SASLOAuthBearer.prototype.test=function(t){return null!==t.authcid},u.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,a=";return e+=t.authzid,e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",r.utf16to8(e)},u.Connection.prototype.mechanisms[u.SASLOAuthBearer.prototype.name]=u.SASLOAuthBearer,u.SASLExternal=function(){},u.SASLExternal.prototype=new u.SASLMechanism("EXTERNAL",!0,60),u.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},u.Connection.prototype.mechanisms[u.SASLExternal.prototype.name]=u.SASLExternal,{Strophe:u,$build:a,$msg:function(t){return new u.Builder("message",t)},$iq:s,$pres:c,SHA1:e,Base64:n,MD5:i,polyfills:o}}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build,t.polyfills)})}(this,function(t,e,n){var i=n.bind;return t.Request=function(e,n,i,r){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=i,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"==(e=this.xhr.responseXML.documentElement).tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=i(this.func,null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,r){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var o=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});r&&o.attrs({route:r});var a=this._conn._connect_cb;this._requests.push(new t.Request(o.tree(),i(this._onRequestStateChange,this,i(a,this._conn)),o.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,i,r,o,a,s){this._conn.jid=e,this.sid=n,this.rid=i,this._conn.connect_callback=r,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=a||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,i,r,o){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==a&&null!==a&&a.rid&&a.sid&&a.jid)||void 0!==e&&null!==e&&t.getBareJidFromJid(a.jid)!=t.getBareJidFromJid(e))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,i,r,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,i,r=e.getAttribute("type");if(null!==r&&"terminate"==r)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),i=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var a=e.getAttribute("hold");a&&(this.hold=parseInt(a,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?i(e,this._conn):i(this._conn._connect_cb,this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),i(this._onRequestStateChange,this,i(e,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)(t=this._requests.pop()).abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),r=0;r<e.length;r++)null!==e[r]&&("restart"===e[r]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[r]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),i(this._onRequestStateChange,this,i(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)n.abort=!1;else{var i;if(4==n.xhr.readyState){i=0;try{i=n.xhr.status}catch(t){}if(void 0===i&&(i=0),this.disconnecting&&i>=400)return void this._hitError(i);var r=this._requests[0]==n,o=this._requests[1]==n;(i>0&&i<500||n.sends>5)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200==i?((o||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0):(t.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),(0===i||i>=400&&i<600||i>=12e3)&&(this._hitError(i),i>=400&&i<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect()))),i>0&&i<500||n.sends>5||this._throttledRequestHandler()}}},_processRequest:function(e){var n=this,i=this._requests[e],r=-1;try{4==i.xhr.readyState&&(r=i.xhr.status)}catch(n){t.error("caught an error in _requests["+e+"], reqStatus: "+r)}if(void 0===r&&(r=-1),i.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var o=i.age(),a=!isNaN(o)&&o>Math.floor(t.TIMEOUT*this.wait),s=null!==i.dead&&i.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4==i.xhr.readyState&&(r<1||r>=500);if((a||s||c)&&(s&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){t.debug("request id "+i.id+"."+i.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),i.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(i.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&i.xhr.setRequestHeader(e,t[e])}i.xhr.send(i.data)};if(i.sends>1){var d=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout(function(){l()},d)}else l();i.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)}},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e==this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var r=new t.Request(n.tree(),i(this._onRequestStateChange,this,i(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"));this._requests.push(r),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(i(this._conn._onIdle,this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(this,function(t,e,n){var i=n.bind;return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var i;if(0===(i=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return!1;for(var r=i[0],o="",a="",s=0;s<r.childNodes.length;s++){var c=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?a=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",a&&(u+=" - "+o),t.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=i(this._onOpen,this),this.socket.onerror=i(this._onError,this),this.socket.onclose=i(this._onClose,this),this.socket.onmessage=i(this._connect_cb_wrapper,this)},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,i=e.getAttribute("xmlns");"string"!=typeof i?n="Missing xmlns in <open />":i!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+i);var r=e.getAttribute("version");return"string"!=typeof r?n="Missing version in <open />":"1.0"!==r&&(n="Wrong version in <open />: "+r),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data),this._handleStreamStart(r)&&this._connect_cb(r)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var o=e.getAttribute("see-other-uri");o?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var a=this._streamWrap(e.data),s=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=i(this._onMessage,this),this._conn._connect_cb(s,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var i=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(i);var r=t.serialize(i);this._conn.rawOutput(r);try{this.socket.send(r)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=i(e,this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var i,r;i="restart"===e[n]?this._buildStream().tree():e[n],r=t.serialize(i),this._conn.xmlOutput(i),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var n,i,r='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===r)return this._conn.rawInput(r),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else i=this._streamWrap(e.data),n=(new DOMParser).parseFromString(i,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),i(this._conn._onIdle,this._conn)()}},t})},{}],14:[function(t,e,n){"use strict";n.consoleFormat=t("./lib/console-format.js");var i=n.isEmoji=t("./lib/is-emoji.js"),r=n.split=t("./parsers/unicode-and-emoji.js").parse;n.withoutEmoji=function(t){var e=r(t);return e?e.filter(function(t){return!i(t)}):e},n.onlyEmoji=function(t){var e=r(t);return e?e.filter(function(t){return i(t)}):e}},{"./lib/console-format.js":15,"./lib/is-emoji.js":16,"./parsers/unicode-and-emoji.js":18}],15:[function(t,e,n){"use strict";var i=t("./is-emoji.js"),r=t("../parsers/unicode-and-emoji.js").parse;e.exports=function(t){var e="";return r(t).forEach(function(t){e+=i(t)?t+" ":t}),e}},{"../parsers/unicode-and-emoji.js":18,"./is-emoji.js":16}],16:[function(t,e,n){"use strict";var i=t("../parsers/emoji.js").Emoji;e.exports=function(t){return i.parse(t).status}},{"../parsers/emoji.js":17}],17:[function(t,e,n){"use strict";var i=t("parsimmon"),r=t("lodash.flattendeep"),o=n.OptionalVariationSelector=i.regex(/[\uFE0E\uFE0F]{0,1}/).desc("an optional variation selector (\\uFE0E or \\uFE0F)"),a=i.seq(i.regex(/[0-9#*]/),o,i.string("")).desc("a keycap emoji"),s=i.regex(/\uD83C[\uDDE6-\uDDFF]/).times(2).desc("a flag emoji"),c=i.string("").desc("zero-width joiner (\\u200D)"),u=i.regex(/(\uD83C[\uDFFB-\uDFFF]){0,1}/).desc("an optional Fitzpatrick modifier"),l=i.alt(i.regex(/[\u203C-\u3299]/),i.regex(/[\u2702-\u27B0]/),s,i.regex(/\uD83C[\uDC04-\uDFFF]/),i.regex(/\uD83D[\uDC00-\uDFFF]/),i.regex(/\uD83E[\uDC00-\uDFFF]/),i.string(""),i.string("")),d=i.seq(l,o,i.seq(c,l,o).times(1,3)),f=n.Emoji=i.seq(i.alt(d,i.seq(l,o),a),u).map(function(t){return r(t).join("")});n.parseOne=function(t){var e=f.parse(t);return!!e.status&&e.value},n.parse=function(t){var e=f.many().parse(t);return!!e.status&&e.value}},{"lodash.flattendeep":30,parsimmon:35}],18:[function(t,e,n){"use strict";var i=t("./emoji.js").Emoji,r=t("parsimmon"),o=t("lodash.flattendeep"),a=r.regex(/[\uD800-\uDBFF][\uDC00-\uDFFF]/),s=n.Unicode=r.alt(i,r.regex(/[\u0000-\uD799]/),a);n.parseOne=function(t){var e=s.parse(t);return!!e.status&&o(e.value).join("")},n.parse=function(t){var e=s.many().parse(t);return!!e.status&&e.value.map(function(t){return o(t).join("")})}},{"./emoji.js":17,"lodash.flattendeep":30,parsimmon:35}],19:[function(e,n,i){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||t}function o(t){return"function"==typeof t}function a(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function c(t){return void 0===t}n.exports=r,r.EventEmitter=r,r.prototype._events=t,r.prototype._maxListeners=t,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,i,r,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],c(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(s(n))for(r=Array.prototype.slice.call(arguments,1),i=(u=n.slice()).length,a=0;a<i;a++)u[a].apply(this,r);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=c(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,i,r,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],r=n.length,i=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=r;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],20:[function(e,n,i){(function(e){"use strict";!function(e){function r(e){var n=arguments.length>1&&arguments[1]!==t?arguments[1]:{},i=[],r=0,c=void 0,u=void 0,l=void 0,d=void 0,f=void 0,h=void 0,p=void 0,g=void 0,m=void 0,v=void 0,_=void 0,b=void 0,y=void 0,w=void 0;if(isNaN(e))throw new Error("Invalid arguments");return l=!0===n.bits,_=!0===n.unix,u=n.base||2,v=n.round!==t?n.round:_?1:2,b=n.spacer!==t?n.spacer:_?"":" ",w=n.symbols||n.suffixes||{},y=2===u?n.standard||"jedec":"jedec",m=n.output||"string",f=!0===n.fullform,h=n.fullforms instanceof Array?n.fullforms:[],c=n.exponent!==t?n.exponent:-1,g=Number(e),p=g<0,d=u>2?1e3:1024,p&&(g=-g),(-1===c||isNaN(c))&&(c=Math.floor(Math.log(g)/Math.log(d)))<0&&(c=0),c>8&&(c=8),0===g?(i[0]=0,i[1]=_?"":a[y][l?"bits":"bytes"][c]):(r=g/(2===u?Math.pow(2,10*c):Math.pow(1e3,c)),l&&(r*=8)>=d&&c<8&&(r/=d,c++),i[0]=Number(r.toFixed(c>0?v:0)),i[1]=10===u&&1===c?l?"kb":"kB":a[y][l?"bits":"bytes"][c],_&&(i[1]="jedec"===y?i[1].charAt(0):c>0?i[1].replace(/B$/,""):i[1],o.test(i[1])&&(i[0]=Math.floor(i[0]),i[1]=""))),p&&(i[0]=-i[0]),i[1]=w[i[1]]||i[1],"array"===m?i:"exponent"===m?c:"object"===m?{value:i[0],suffix:i[1],symbol:i[1]}:(f&&(i[1]=h[c]?h[c]:s[y][c]+(l?"bit":"byte")+(1===i[0]?"":"s")),i.join(b))}var o=/^(b|B)$/,a={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},s={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};r.partial=function(t){return function(e){return r(e,t)}},void 0!==i?n.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):e.filesize=r}("undefined"!=typeof window?window:e)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(t,e,n){e.exports=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}},{}],22:[function(t,e,n){e.exports=function(t,e){for(var n=-1,i=t.length;++n<i&&!1!==e(t[n],n,t););return t}},{}],23:[function(t,e,n){var i=t("lodash._basecopy"),r=t("lodash.keys");e.exports=function(t,e){return null==e?t:i(e,r(e),t)}},{"lodash._basecopy":25,"lodash.keys":33}],24:[function(e,n,i){(function(i){function r(e,n,i,a,p,m,_){var b;if(i&&(b=p?i(e,a,p):i(e)),b!==t)return b;if(!l(e))return e;var w=g(e);if(w){if(b=s(e),!n)return d(e,b)}else{var T=U.call(e),O=T==y;if(T!=S&&T!=v&&(!O||p))return z[T]?u(e,T,n):p?e:{};if(b=c(O?{}:e),!n)return h(b,e)}m||(m=[]),_||(_=[]);for(var C=m.length;C--;)if(m[C]==e)return _[C];return m.push(e),_.push(b),(w?f:o)(e,function(t,o){b[o]=r(t,n,i,o,e,m,_)}),b}function o(t,e){return p(t,e,m)}function a(t){var e=new B(t.byteLength);return new H(e).set(new H(t)),e}function s(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&L.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function c(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}function u(t,e,n){var i=t.constructor;switch(e){case C:return a(t);case _:case b:return new i(+t);case x:case E:case A:case I:case R:case N:case M:case k:case j:var r=t.buffer;return new i(n?a(r):r,t.byteOffset,t.length);case w:case O:return new i(t);case T:var o=new i(t.source,D.exec(t));o.lastIndex=t.lastIndex}return o}function l(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var d=e("lodash._arraycopy"),f=e("lodash._arrayeach"),h=e("lodash._baseassign"),p=e("lodash._basefor"),g=e("lodash.isarray"),m=e("lodash.keys"),v="[object Arguments]",_="[object Boolean]",b="[object Date]",y="[object Function]",w="[object Number]",S="[object Object]",T="[object RegExp]",O="[object String]",C="[object ArrayBuffer]",x="[object Float32Array]",E="[object Float64Array]",A="[object Int8Array]",I="[object Int16Array]",R="[object Int32Array]",N="[object Uint8Array]",M="[object Uint8ClampedArray]",k="[object Uint16Array]",j="[object Uint32Array]",D=/\w*$/,z={};z[v]=z["[object Array]"]=z[C]=z[_]=z[b]=z[x]=z[E]=z[A]=z[I]=z[R]=z[w]=z[S]=z[T]=z[O]=z[N]=z[M]=z[k]=z[j]=!0,z["[object Error]"]=z[y]=z["[object Map]"]=z["[object Set]"]=z["[object WeakMap]"]=!1;var P=Object.prototype,L=P.hasOwnProperty,U=P.toString,B=i.ArrayBuffer,H=i.Uint8Array;n.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._arraycopy":21,"lodash._arrayeach":22,"lodash._baseassign":23,"lodash._basefor":26,"lodash.isarray":32,"lodash.keys":33}],25:[function(t,e,n){e.exports=function(t,e,n){n||(n={});for(var i=-1,r=e.length;++i<r;){var o=e[i];n[o]=t[o]}return n}},{}],26:[function(t,e,n){var i=function(t){return function(e,n,i){for(var r=-1,o=Object(e),a=i(e),s=a.length;s--;){var c=a[t?s:++r];if(!1===n(o[c],c,o))break}return e}}();e.exports=i},{}],27:[function(e,n,i){function r(t){return t}n.exports=function(e,n,i){if("function"!=typeof e)return r;if(n===t)return e;switch(i){case 1:return function(t){return e.call(n,t)};case 3:return function(t,i,r){return e.call(n,t,i,r)};case 4:return function(t,i,r,o){return e.call(n,t,i,r,o)};case 5:return function(t,i,r,o,a){return e.call(n,t,i,r,o,a)}}return function(){return e.apply(n,arguments)}}},{}],28:[function(e,n,i){function r(t){return!!t&&"object"==typeof t}function o(t){return a(t)&&h.call(t)==c}function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){return null!=t&&(o(t)?p.test(d.call(t)):r(t)&&u.test(t))}var c="[object Function]",u=/^\[object .+?Constructor\]$/,l=Object.prototype,d=Function.prototype.toString,f=l.hasOwnProperty,h=l.toString,p=RegExp("^"+d.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(e,n){var i=null==e?t:e[n];return s(i)?i:t}},{}],29:[function(t,e,n){var i=t("lodash._baseclone"),r=t("lodash._bindcallback");e.exports=function(t,e,n){return"function"==typeof e?i(t,!0,r(e,n,3)):i(t,!0)}},{"lodash._baseclone":24,"lodash._bindcallback":27}],30:[function(e,n,i){(function(e){function i(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}function r(t,e,n,a,s){var c=-1,u=t.length;for(n||(n=o),s||(s=[]);++c<u;){var l=t[c];e>0&&n(l)?e>1?r(l,e-1,n,a,s):i(s,l):a||(s[s.length]=l)}return s}function o(t){return E(t)||a(t)||!!(x&&t&&t[x])}function a(t){return c(t)&&S.call(t,"callee")&&(!C.call(t,"callee")||T.call(t)==g)}function s(t){return null!=t&&l(t.length)&&!u(t)}function c(t){return f(t)&&s(t)}function u(t){var e=d(t)?T.call(t):"";return e==m||e==v}function l(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}function d(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function f(t){return!!t&&"object"==typeof t}var h=1/0,p=9007199254740991,g="[object Arguments]",m="[object Function]",v="[object GeneratorFunction]",_="object"==typeof e&&e&&e.Object===Object&&e,b="object"==typeof self&&self&&self.Object===Object&&self,y=_||b||Function("return this")(),w=Object.prototype,S=w.hasOwnProperty,T=w.toString,O=y.Symbol,C=w.propertyIsEnumerable,x=O?O.isConcatSpreadable:t,E=Array.isArray;n.exports=function(t){return(t?t.length:0)?r(t,h):[]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(t,e,n){function i(t){return null!=t&&a(t.length)&&!o(t)}function r(t){return c(t)&&i(t)}function o(t){var e=s(t)?g.call(t):"";return e==d||e==f}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return!!t&&"object"==typeof t}var u=9007199254740991,l="[object Arguments]",d="[object Function]",f="[object GeneratorFunction]",h=Object.prototype,p=h.hasOwnProperty,g=h.toString,m=h.propertyIsEnumerable;e.exports=function(t){return r(t)&&p.call(t,"callee")&&(!m.call(t,"callee")||g.call(t)==l)}},{}],32:[function(e,n,i){function r(t){return!!t&&"object"==typeof t}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=m}function a(t){return s(t)&&p.call(t)==u}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return null!=t&&(a(t)?g.test(f.call(t)):r(t)&&l.test(t))}var u="[object Function]",l=/^\[object .+?Constructor\]$/,d=Object.prototype,f=Function.prototype.toString,h=d.hasOwnProperty,p=d.toString,g=RegExp("^"+f.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),m=9007199254740991,v=function(e,n){var i=null==e?t:e[n];return c(i)?i:t}(Array,"isArray")||function(t){return r(t)&&o(t.length)&&"[object Array]"==p.call(t)};n.exports=v},{}],33:[function(e,n,i){function r(t){return null!=t&&a(v(t))}function o(t,e){return t="number"==typeof t||h.test(t)?+t:-1,e=null==e?m:e,t>-1&&t%1==0&&t<e}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=m}function s(t){for(var e=u(t),n=e.length,i=n&&t.length,r=!!i&&a(i)&&(f(t)||d(t)),s=-1,c=[];++s<n;){var l=e[s];(r&&o(l,i)||p.call(t,l))&&c.push(l)}return c}function c(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function u(t){if(null==t)return[];c(t)||(t=Object(t));var e=t.length;e=e&&a(e)&&(f(t)||d(t))&&e||0;for(var n=t.constructor,i=-1,r="function"==typeof n&&n.prototype===t,s=Array(e),u=e>0;++i<e;)s[i]=i+"";for(var l in t)u&&o(l,e)||"constructor"==l&&(r||!p.call(t,l))||s.push(l);return s}var l=e("lodash._getnative"),d=e("lodash.isarguments"),f=e("lodash.isarray"),h=/^\d+$/,p=Object.prototype.hasOwnProperty,g=l(Object,"keys"),m=9007199254740991,v=function(e){return function(n){return null==n?t:n[e]}}("length"),_=g?function(e){var n=null==e?t:e.constructor;return"function"==typeof n&&n.prototype===e||"function"!=typeof e&&r(e)?s(e):c(e)?g(e):[]}:s;n.exports=_},{"lodash._getnative":28,"lodash.isarguments":31,"lodash.isarray":32}],34:[function(t,e,n){(function(t){(function(){function i(t,e){return t.set(e[0],e[1]),t}function r(t,e){return t.add(e),t}function o(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function a(t,e,n,i){for(var r=-1,o=null==t?0:t.length;++r<o;){var a=t[r];e(i,a,n(a),t)}return i}function s(t,e){for(var n=-1,i=null==t?0:t.length;++n<i&&!1!==e(t[n],n,t););return t}function c(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function u(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(!e(t[n],n,t))return!1;return!0}function l(t,e){for(var n=-1,i=null==t?0:t.length,r=0,o=[];++n<i;){var a=t[n];e(a,n,t)&&(o[r++]=a)}return o}function d(t,e){return!!(null==t?0:t.length)&&S(t,e,0)>-1}function f(t,e,n){for(var i=-1,r=null==t?0:t.length;++i<r;)if(n(e,t[i]))return!0;return!1}function h(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}function p(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}function g(t,e,n,i){var r=-1,o=null==t?0:t.length;for(i&&o&&(n=t[++r]);++r<o;)n=e(n,t[r],r,t);return n}function m(t,e,n,i){var r=null==t?0:t.length;for(i&&r&&(n=t[--r]);r--;)n=e(n,t[r],r,t);return n}function v(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function _(t){return t.split("")}function b(t){return t.match(Le)||[]}function y(t,e,n){var i;return n(t,function(t,n,r){if(e(t,n,r))return i=n,!1}),i}function w(t,e,n,i){for(var r=t.length,o=n+(i?1:-1);i?o--:++o<r;)if(e(t[o],o,t))return o;return-1}function S(t,e,n){return e===e?X(t,e,n):w(t,O,n)}function T(t,e,n,i){for(var r=n-1,o=t.length;++r<o;)if(i(t[r],e))return r;return-1}function O(t){return t!==t}function C(t,e){var n=null==t?0:t.length;return n?R(t,e)/n:kt}function x(t){return function(e){return null==e?nt:e[t]}}function E(t){return function(e){return null==t?nt:t[e]}}function A(t,e,n,i,r){return r(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)}),n}function I(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function R(t,e){for(var n,i=-1,r=t.length;++i<r;){var o=e(t[i]);o!==nt&&(n=n===nt?o:n+o)}return n}function N(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}function M(t,e){return h(e,function(e){return[e,t[e]]})}function k(t){return function(e){return t(e)}}function j(t,e){return h(e,function(e){return t[e]})}function D(t,e){return t.has(e)}function z(t,e){for(var n=-1,i=t.length;++n<i&&S(e,t[n],0)>-1;);return n}function P(t,e){for(var n=t.length;n--&&S(e,t[n],0)>-1;);return n}function L(t,e){for(var n=t.length,i=0;n--;)t[n]===e&&++i;return i}function U(t){return"\\"+Cn[t]}function B(t,e){return null==t?nt:t[e]}function H(t){return mn.test(t)}function q(t){return vn.test(t)}function F(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}function $(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}function V(t,e){return function(n){return t(e(n))}}function G(t,e){for(var n=-1,i=t.length,r=0,o=[];++n<i;){var a=t[n];a!==e&&a!==ct||(t[n]=ct,o[r++]=n)}return o}function J(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}function W(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}function X(t,e,n){for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function Y(t,e,n){for(var i=n+1;i--;)if(t[i]===e)return i;return i}function Q(t){return H(t)?K(t):qn(t)}function Z(t){return H(t)?tt(t):_(t)}function K(t){for(var e=pn.lastIndex=0;pn.test(t);)++e;return e}function tt(t){return t.match(pn)||[]}function et(t){return t.match(gn)||[]}var nt,it=200,rt="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",ot="Expected a function",at="__lodash_hash_undefined__",st=500,ct="__lodash_placeholder__",ut=1,lt=2,dt=4,ft=1,ht=2,pt=1,gt=2,mt=4,vt=8,_t=16,bt=32,yt=64,wt=128,St=256,Tt=512,Ot=30,Ct="...",xt=800,Et=16,At=1,It=2,Rt=1/0,Nt=9007199254740991,Mt=1.7976931348623157e308,kt=NaN,jt=4294967295,Dt=jt-1,zt=jt>>>1,Pt=[["ary",wt],["bind",pt],["bindKey",gt],["curry",vt],["curryRight",_t],["flip",Tt],["partial",bt],["partialRight",yt],["rearg",St]],Lt="[object Arguments]",Ut="[object Array]",Bt="[object AsyncFunction]",Ht="[object Boolean]",qt="[object Date]",Ft="[object DOMException]",$t="[object Error]",Vt="[object Function]",Gt="[object GeneratorFunction]",Jt="[object Map]",Wt="[object Number]",Xt="[object Null]",Yt="[object Object]",Qt="[object Proxy]",Zt="[object RegExp]",Kt="[object Set]",te="[object String]",ee="[object Symbol]",ne="[object Undefined]",ie="[object WeakMap]",re="[object WeakSet]",oe="[object ArrayBuffer]",ae="[object DataView]",se="[object Float32Array]",ce="[object Float64Array]",ue="[object Int8Array]",le="[object Int16Array]",de="[object Int32Array]",fe="[object Uint8Array]",he="[object Uint8ClampedArray]",pe="[object Uint16Array]",ge="[object Uint32Array]",me=/\b__p \+= '';/g,ve=/\b(__p \+=) '' \+/g,_e=/(__e\(.*?\)|\b__t\)) \+\n'';/g,be=/&(?:amp|lt|gt|quot|#39);/g,ye=/[&<>"']/g,we=RegExp(be.source),Se=RegExp(ye.source),Te=/<%-([\s\S]+?)%>/g,Oe=/<%([\s\S]+?)%>/g,Ce=/<%=([\s\S]+?)%>/g,xe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ee=/^\w*$/,Ae=/^\./,Ie=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Re=/[\\^$.*+?()[\]{}|]/g,Ne=RegExp(Re.source),Me=/^\s+|\s+$/g,ke=/^\s+/,je=/\s+$/,De=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ze=/\{\n\/\* \[wrapped with (.+)\] \*/,Pe=/,? & /,Le=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ue=/\\(\\)?/g,Be=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,He=/\w*$/,qe=/^[-+]0x[0-9a-f]+$/i,Fe=/^0b[01]+$/i,$e=/^\[object .+?Constructor\]$/,Ve=/^0o[0-7]+$/i,Ge=/^(?:0|[1-9]\d*)$/,Je=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,We=/($^)/,Xe=/['\n\r\u2028\u2029\\]/g,Ye="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qe="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ze="["+Qe+"]",Ke="["+Ye+"]",tn="[a-z\\xdf-\\xf6\\xf8-\\xff]",en="[^\\ud800-\\udfff"+Qe+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",nn="\\ud83c[\\udffb-\\udfff]",rn="(?:\\ud83c[\\udde6-\\uddff]){2}",on="[\\ud800-\\udbff][\\udc00-\\udfff]",an="[A-Z\\xc0-\\xd6\\xd8-\\xde]",sn="(?:"+tn+"|"+en+")",cn="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",un="[\\ufe0e\\ufe0f]?"+cn+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",rn,on].join("|")+")[\\ufe0e\\ufe0f]?"+cn+")*"),ln="(?:"+["[\\u2700-\\u27bf]",rn,on].join("|")+")"+un,dn="(?:"+["[^\\ud800-\\udfff]"+Ke+"?",Ke,rn,on,"[\\ud800-\\udfff]"].join("|")+")",fn=RegExp("[']","g"),hn=RegExp(Ke,"g"),pn=RegExp(nn+"(?="+nn+")|"+dn+un,"g"),gn=RegExp([an+"?"+tn+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[Ze,an,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[Ze,an+sn,"$"].join("|")+")",an+"?"+sn+"+(?:['](?:d|ll|m|re|s|t|ve))?",an+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)","\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)","\\d+",ln].join("|"),"g"),mn=RegExp("[\\u200d\\ud800-\\udfff"+Ye+"\\ufe0e\\ufe0f]"),vn=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_n=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],bn=-1,yn={};yn[se]=yn[ce]=yn[ue]=yn[le]=yn[de]=yn[fe]=yn[he]=yn[pe]=yn[ge]=!0,yn[Lt]=yn[Ut]=yn[oe]=yn[Ht]=yn[ae]=yn[qt]=yn[$t]=yn[Vt]=yn[Jt]=yn[Wt]=yn[Yt]=yn[Zt]=yn[Kt]=yn[te]=yn[ie]=!1;var wn={};wn[Lt]=wn[Ut]=wn[oe]=wn[ae]=wn[Ht]=wn[qt]=wn[se]=wn[ce]=wn[ue]=wn[le]=wn[de]=wn[Jt]=wn[Wt]=wn[Yt]=wn[Zt]=wn[Kt]=wn[te]=wn[ee]=wn[fe]=wn[he]=wn[pe]=wn[ge]=!0,wn[$t]=wn[Vt]=wn[ie]=!1;var Sn={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"},Tn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},On={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Cn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xn=parseFloat,En=parseInt,An="object"==typeof t&&t&&t.Object===Object&&t,In="object"==typeof self&&self&&self.Object===Object&&self,Rn=An||In||Function("return this")(),Nn="object"==typeof n&&n&&!n.nodeType&&n,Mn=Nn&&"object"==typeof e&&e&&!e.nodeType&&e,kn=Mn&&Mn.exports===Nn,jn=kn&&An.process,Dn=function(){try{return jn&&jn.binding&&jn.binding("util")}catch(t){}}(),zn=Dn&&Dn.isArrayBuffer,Pn=Dn&&Dn.isDate,Ln=Dn&&Dn.isMap,Un=Dn&&Dn.isRegExp,Bn=Dn&&Dn.isSet,Hn=Dn&&Dn.isTypedArray,qn=x("length"),Fn=E(Sn),$n=E(Tn),Vn=E(On),Gn=function t(e){function n(t){if(ea(t)&&!$c(t)&&!(t instanceof X)){if(t instanceof E)return t;if($a.call(t,"__wrapped__"))return Co(t)}return new E(t)}function _(){}function E(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=nt}function X(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=jt,this.__views__=[]}function K(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function tt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Le(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Ye(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Le;++e<n;)this.add(t[e])}function Qe(t){var e=this.__data__=new tt(t);this.size=e.size}function Ze(t,e){var n=$c(t),i=!n&&Fc(t),r=!n&&!i&&Gc(t),o=!n&&!i&&!r&&Qc(t),a=n||i||r||o,s=a?N(t.length,Pa):[],c=s.length;for(var u in t)!e&&!$a.call(t,u)||a&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||io(u,c))||s.push(u);return s}function Ke(t){var e=t.length;return e?t[Si(0,e-1)]:nt}function tn(t,e){return wo(ar(t),dn(e,0,t.length))}function en(t){return wo(ar(t))}function nn(t,e,n){(n===nt||Jo(t[e],n))&&(n!==nt||e in t)||un(t,e,n)}function rn(t,e,n){var i=t[e];$a.call(t,e)&&Jo(i,n)&&(n!==nt||e in t)||un(t,e,n)}function on(t,e){for(var n=t.length;n--;)if(Jo(t[n][0],e))return n;return-1}function an(t,e,n,i){return qs(t,function(t,r,o){e(i,t,n(t),o)}),i}function sn(t,e){return t&&sr(e,ga(e),t)}function cn(t,e){return t&&sr(e,ma(e),t)}function un(t,e,n){"__proto__"==e&&cs?cs(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ln(t,e){for(var n=-1,i=e.length,r=Ra(i),o=null==t;++n<i;)r[n]=o?nt:ha(t,e[n]);return r}function dn(t,e,n){return t===t&&(n!==nt&&(t=t<=n?t:n),e!==nt&&(t=t>=e?t:e)),t}function pn(t,e,n,i,r,o){var a,c=e&ut,u=e&lt,l=e&dt;if(n&&(a=r?n(t,i,r,o):n(t)),a!==nt)return a;if(!ta(t))return t;var d=$c(t);if(d){if(a=Zr(t),!c)return ar(t,a)}else{var f=tc(t),h=f==Vt||f==Gt;if(Gc(t))return Wi(t,c);if(f==Yt||f==Lt||h&&!r){if(a=u||h?{}:Kr(t),!c)return u?ur(t,cn(a,t)):cr(t,sn(a,t))}else{if(!wn[f])return r?t:{};a=to(t,f,pn,c)}}o||(o=new Qe);var p=o.get(t);if(p)return p;o.set(t,a);var g=l?u?Hr:Br:u?ma:ga,m=d?nt:g(t);return s(m||t,function(i,r){m&&(i=t[r=i]),rn(a,r,pn(i,e,n,r,t,o))}),a}function gn(t){var e=ga(t);return function(n){return mn(n,t,e)}}function mn(t,e,n){var i=n.length;if(null==t)return!i;for(t=Da(t);i--;){var r=n[i],o=e[r],a=t[r];if(a===nt&&!(r in t)||!o(a))return!1}return!0}function vn(t,e,n){if("function"!=typeof t)throw new La(ot);return ic(function(){t.apply(nt,n)},e)}function Sn(t,e,n,i){var r=-1,o=d,a=!0,s=t.length,c=[],u=e.length;if(!s)return c;n&&(e=h(e,k(n))),i?(o=f,a=!1):e.length>=it&&(o=D,a=!1,e=new Ye(e));t:for(;++r<s;){var l=t[r],p=null==n?l:n(l);if(l=i||0!==l?l:0,a&&p===p){for(var g=u;g--;)if(e[g]===p)continue t;c.push(l)}else o(e,p,i)||c.push(l)}return c}function Tn(t,e){var n=!0;return qs(t,function(t,i,r){return n=!!e(t,i,r)}),n}function On(t,e,n){for(var i=-1,r=t.length;++i<r;){var o=t[i],a=e(o);if(null!=a&&(s===nt?a===a&&!oa(a):n(a,s)))var s=a,c=o}return c}function Cn(t,e,n,i){var r=t.length;for((n=ca(n))<0&&(n=-n>r?0:r+n),(i=i===nt||i>r?r:ca(i))<0&&(i+=r),i=n>i?0:ua(i);n<i;)t[n++]=e;return t}function An(t,e){var n=[];return qs(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n}function In(t,e,n,i,r){var o=-1,a=t.length;for(n||(n=no),r||(r=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?In(s,e-1,n,i,r):p(r,s):i||(r[r.length]=s)}return r}function Nn(t,e){return t&&$s(t,e,ga)}function Mn(t,e){return t&&Vs(t,e,ga)}function jn(t,e){return l(e,function(e){return Qo(t[e])})}function Dn(t,e){for(var n=0,i=(e=Gi(e,t)).length;null!=t&&n<i;)t=t[So(e[n++])];return n&&n==i?t:nt}function qn(t,e,n){var i=e(t);return $c(t)?i:p(i,n(t))}function Jn(t){return null==t?t===nt?ne:Xt:ss&&ss in Da(t)?Wr(t):go(t)}function Wn(t,e){return t>e}function Xn(t,e){return null!=t&&$a.call(t,e)}function Yn(t,e){return null!=t&&e in Da(t)}function Qn(t,e,n){return t>=ys(e,n)&&t<bs(e,n)}function Zn(t,e,n){for(var i=n?f:d,r=t[0].length,o=t.length,a=o,s=Ra(o),c=1/0,u=[];a--;){var l=t[a];a&&e&&(l=h(l,k(e))),c=ys(l.length,c),s[a]=!n&&(e||r>=120&&l.length>=120)?new Ye(a&&l):nt}l=t[0];var p=-1,g=s[0];t:for(;++p<r&&u.length<c;){var m=l[p],v=e?e(m):m;if(m=n||0!==m?m:0,!(g?D(g,v):i(u,v,n))){for(a=o;--a;){var _=s[a];if(!(_?D(_,v):i(t[a],v,n)))continue t}g&&g.push(v),u.push(m)}}return u}function Kn(t,e,n,i){return Nn(t,function(t,r,o){e(i,n(t),r,o)}),i}function ti(t,e,n){var i=null==(t=vo(t,e=Gi(e,t)))?t:t[So(Ro(e))];return null==i?nt:o(i,t,n)}function ei(t){return ea(t)&&Jn(t)==Lt}function ni(t,e,n,i,r){return t===e||(null==t||null==e||!ea(t)&&!ea(e)?t!==t&&e!==e:ii(t,e,n,i,ni,r))}function ii(t,e,n,i,r,o){var a=$c(t),s=$c(e),c=a?Ut:tc(t),u=s?Ut:tc(e),l=(c=c==Lt?Yt:c)==Yt,d=(u=u==Lt?Yt:u)==Yt,f=c==u;if(f&&Gc(t)){if(!Gc(e))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new Qe),a||Qc(t)?zr(t,e,n,i,r,o):Pr(t,e,c,n,i,r,o);if(!(n&ft)){var h=l&&$a.call(t,"__wrapped__"),p=d&&$a.call(e,"__wrapped__");if(h||p){var g=h?t.value():t,m=p?e.value():e;return o||(o=new Qe),r(g,m,n,i,o)}}return!!f&&(o||(o=new Qe),Lr(t,e,n,i,r,o))}function ri(t,e,n,i){var r=n.length,o=r,a=!i;if(null==t)return!o;for(t=Da(t);r--;){var s=n[r];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++r<o;){var c=(s=n[r])[0],u=t[c],l=s[1];if(a&&s[2]){if(u===nt&&!(c in t))return!1}else{var d=new Qe;if(i)var f=i(u,l,c,t,e,d);if(!(f===nt?ni(l,u,ft|ht,i,d):f))return!1}}return!0}function oi(t){return!(!ta(t)||co(t))&&(Qo(t)?Ya:$e).test(To(t))}function ai(t){return"function"==typeof t?t:null==t?Ta:"object"==typeof t?$c(t)?fi(t[0],t[1]):di(t):Ea(t)}function si(t){if(!uo(t))return _s(t);var e=[];for(var n in Da(t))$a.call(t,n)&&"constructor"!=n&&e.push(n);return e}function ci(t){if(!ta(t))return po(t);var e=uo(t),n=[];for(var i in t)("constructor"!=i||!e&&$a.call(t,i))&&n.push(i);return n}function ui(t,e){return t<e}function li(t,e){var n=-1,i=Wo(t)?Ra(t.length):[];return qs(t,function(t,r,o){i[++n]=e(t,r,o)}),i}function di(t){var e=Gr(t);return 1==e.length&&e[0][2]?fo(e[0][0],e[0][1]):function(n){return n===t||ri(n,t,e)}}function fi(t,e){return oo(t)&&lo(e)?fo(So(t),e):function(n){var i=ha(n,t);return i===nt&&i===e?pa(n,t):ni(e,i,ft|ht)}}function hi(t,e,n,i,r){t!==e&&$s(e,function(o,a){if(ta(o))r||(r=new Qe),pi(t,e,a,n,hi,i,r);else{var s=i?i(t[a],o,a+"",t,e,r):nt;s===nt&&(s=o),nn(t,a,s)}},ma)}function pi(t,e,n,i,r,o,a){var s=t[n],c=e[n],u=a.get(c);if(u)nn(t,n,u);else{var l=o?o(s,c,n+"",t,e,a):nt,d=l===nt;if(d){var f=$c(c),h=!f&&Gc(c),p=!f&&!h&&Qc(c);l=c,f||h||p?$c(s)?l=s:Xo(s)?l=ar(s):h?(d=!1,l=Wi(c,!0)):p?(d=!1,l=er(c,!0)):l=[]:ia(c)||Fc(c)?(l=s,Fc(s)?l=da(s):(!ta(s)||i&&Qo(s))&&(l=Kr(c))):d=!1}d&&(a.set(c,l),r(l,c,i,o,a),a.delete(c)),nn(t,n,l)}}function gi(t,e){var n=t.length;if(n)return e+=e<0?n:0,io(e,n)?t[e]:nt}function mi(t,e,n){var i=-1;return e=h(e.length?e:[Ta],k($r())),I(li(t,function(t,n,r){return{criteria:h(e,function(e){return e(t)}),index:++i,value:t}}),function(t,e){return ir(t,e,n)})}function vi(t,e){return _i(t,e,function(e,n){return pa(t,n)})}function _i(t,e,n){for(var i=-1,r=e.length,o={};++i<r;){var a=e[i],s=Dn(t,a);n(s,a)&&Ai(o,Gi(a,t),s)}return o}function bi(t){return function(e){return Dn(e,t)}}function yi(t,e,n,i){var r=i?T:S,o=-1,a=e.length,s=t;for(t===e&&(e=ar(e)),n&&(s=h(t,k(n)));++o<a;)for(var c=0,u=e[o],l=n?n(u):u;(c=r(s,l,c,i))>-1;)s!==t&&rs.call(s,c,1),rs.call(t,c,1);return t}function wi(t,e){for(var n=t?e.length:0,i=n-1;n--;){var r=e[n];if(n==i||r!==o){var o=r;io(r)?rs.call(t,r,1):Li(t,r)}}return t}function Si(t,e){return t+hs(Ts()*(e-t+1))}function Ti(t,e,n,i){for(var r=-1,o=bs(fs((e-t)/(n||1)),0),a=Ra(o);o--;)a[i?o:++r]=t,t+=n;return a}function Oi(t,e){var n="";if(!t||e<1||e>Nt)return n;do{e%2&&(n+=t),(e=hs(e/2))&&(t+=t)}while(e);return n}function Ci(t,e){return rc(mo(t,e,Ta),t+"")}function xi(t){return Ke(_a(t))}function Ei(t,e){var n=_a(t);return wo(n,dn(e,0,n.length))}function Ai(t,e,n,i){if(!ta(t))return t;for(var r=-1,o=(e=Gi(e,t)).length,a=o-1,s=t;null!=s&&++r<o;){var c=So(e[r]),u=n;if(r!=a){var l=s[c];(u=i?i(l,c,s):nt)===nt&&(u=ta(l)?l:io(e[r+1])?[]:{})}rn(s,c,u),s=s[c]}return t}function Ii(t){return wo(_a(t))}function Ri(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(n=n>r?r:n)<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Ra(r);++i<r;)o[i]=t[i+e];return o}function Ni(t,e){var n;return qs(t,function(t,i,r){return!(n=e(t,i,r))}),!!n}function Mi(t,e,n){var i=0,r=null==t?i:t.length;if("number"==typeof e&&e===e&&r<=zt){for(;i<r;){var o=i+r>>>1,a=t[o];null!==a&&!oa(a)&&(n?a<=e:a<e)?i=o+1:r=o}return r}return ki(t,e,Ta,n)}function ki(t,e,n,i){e=n(e);for(var r=0,o=null==t?0:t.length,a=e!==e,s=null===e,c=oa(e),u=e===nt;r<o;){var l=hs((r+o)/2),d=n(t[l]),f=d!==nt,h=null===d,p=d===d,g=oa(d);if(a)var m=i||p;else m=u?p&&(i||f):s?p&&f&&(i||!h):c?p&&f&&!h&&(i||!g):!h&&!g&&(i?d<=e:d<e);m?r=l+1:o=l}return ys(o,Dt)}function ji(t,e){for(var n=-1,i=t.length,r=0,o=[];++n<i;){var a=t[n],s=e?e(a):a;if(!n||!Jo(s,c)){var c=s;o[r++]=0===a?0:a}}return o}function Di(t){return"number"==typeof t?t:oa(t)?kt:+t}function zi(t){if("string"==typeof t)return t;if($c(t))return h(t,zi)+"";if(oa(t))return Bs?Bs.call(t):"";var e=t+"";return"0"==e&&1/t==-Rt?"-0":e}function Pi(t,e,n){var i=-1,r=d,o=t.length,a=!0,s=[],c=s;if(n)a=!1,r=f;else if(o>=it){var u=e?null:Ys(t);if(u)return J(u);a=!1,r=D,c=new Ye}else c=e?[]:s;t:for(;++i<o;){var l=t[i],h=e?e(l):l;if(l=n||0!==l?l:0,a&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue t;e&&c.push(h),s.push(l)}else r(c,h,n)||(c!==s&&c.push(h),s.push(l))}return s}function Li(t,e){return e=Gi(e,t),null==(t=vo(t,e))||delete t[So(Ro(e))]}function Ui(t,e,n,i){return Ai(t,e,n(Dn(t,e)),i)}function Bi(t,e,n,i){for(var r=t.length,o=i?r:-1;(i?o--:++o<r)&&e(t[o],o,t););return n?Ri(t,i?0:o,i?o+1:r):Ri(t,i?o+1:0,i?r:o)}function Hi(t,e){var n=t;return n instanceof X&&(n=n.value()),g(e,function(t,e){return e.func.apply(e.thisArg,p([t],e.args))},n)}function qi(t,e,n){var i=t.length;if(i<2)return i?Pi(t[0]):[];for(var r=-1,o=Ra(i);++r<i;)for(var a=t[r],s=-1;++s<i;)s!=r&&(o[r]=Sn(o[r]||a,t[s],e,n));return Pi(In(o,1),e,n)}function Fi(t,e,n){for(var i=-1,r=t.length,o=e.length,a={};++i<r;){var s=i<o?e[i]:nt;n(a,t[i],s)}return a}function $i(t){return Xo(t)?t:[]}function Vi(t){return"function"==typeof t?t:Ta}function Gi(t,e){return $c(t)?t:oo(t,e)?[t]:oc(fa(t))}function Ji(t,e,n){var i=t.length;return n=n===nt?i:n,!e&&n>=i?t:Ri(t,e,n)}function Wi(t,e){if(e)return t.slice();var n=t.length,i=ts?ts(n):new t.constructor(n);return t.copy(i),i}function Xi(t){var e=new t.constructor(t.byteLength);return new Ka(e).set(new Ka(t)),e}function Yi(t,e){var n=e?Xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Qi(t,e,n){return g(e?n($(t),ut):$(t),i,new t.constructor)}function Zi(t){var e=new t.constructor(t.source,He.exec(t));return e.lastIndex=t.lastIndex,e}function Ki(t,e,n){return g(e?n(J(t),ut):J(t),r,new t.constructor)}function tr(t){return Us?Da(Us.call(t)):{}}function er(t,e){var n=e?Xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function nr(t,e){if(t!==e){var n=t!==nt,i=null===t,r=t===t,o=oa(t),a=e!==nt,s=null===e,c=e===e,u=oa(e);if(!s&&!u&&!o&&t>e||o&&a&&c&&!s&&!u||i&&a&&c||!n&&c||!r)return 1;if(!i&&!o&&!u&&t<e||u&&n&&r&&!i&&!o||s&&n&&r||!a&&r||!c)return-1}return 0}function ir(t,e,n){for(var i=-1,r=t.criteria,o=e.criteria,a=r.length,s=n.length;++i<a;){var c=nr(r[i],o[i]);if(c)return i>=s?c:c*("desc"==n[i]?-1:1)}return t.index-e.index}function rr(t,e,n,i){for(var r=-1,o=t.length,a=n.length,s=-1,c=e.length,u=bs(o-a,0),l=Ra(c+u),d=!i;++s<c;)l[s]=e[s];for(;++r<a;)(d||r<o)&&(l[n[r]]=t[r]);for(;u--;)l[s++]=t[r++];return l}function or(t,e,n,i){for(var r=-1,o=t.length,a=-1,s=n.length,c=-1,u=e.length,l=bs(o-s,0),d=Ra(l+u),f=!i;++r<l;)d[r]=t[r];for(var h=r;++c<u;)d[h+c]=e[c];for(;++a<s;)(f||r<o)&&(d[h+n[a]]=t[r++]);return d}function ar(t,e){var n=-1,i=t.length;for(e||(e=Ra(i));++n<i;)e[n]=t[n];return e}function sr(t,e,n,i){var r=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=i?i(n[s],t[s],s,n,t):nt;c===nt&&(c=t[s]),r?un(n,s,c):rn(n,s,c)}return n}function cr(t,e){return sr(t,Zs(t),e)}function ur(t,e){return sr(t,Ks(t),e)}function lr(t,e){return function(n,i){var r=$c(n)?a:an,o=e?e():{};return r(n,t,$r(i,2),o)}}function dr(t){return Ci(function(e,n){var i=-1,r=n.length,o=r>1?n[r-1]:nt,a=r>2?n[2]:nt;for(o=t.length>3&&"function"==typeof o?(r--,o):nt,a&&ro(n[0],n[1],a)&&(o=r<3?nt:o,r=1),e=Da(e);++i<r;){var s=n[i];s&&t(e,s,i,o)}return e})}function fr(t,e){return function(n,i){if(null==n)return n;if(!Wo(n))return t(n,i);for(var r=n.length,o=e?r:-1,a=Da(n);(e?o--:++o<r)&&!1!==i(a[o],o,a););return n}}function hr(t){return function(e,n,i){for(var r=-1,o=Da(e),a=i(e),s=a.length;s--;){var c=a[t?s:++r];if(!1===n(o[c],c,o))break}return e}}function pr(t,e,n){function i(){return(this&&this!==Rn&&this instanceof i?o:t).apply(r?n:this,arguments)}var r=e&pt,o=vr(t);return i}function gr(t){return function(e){var n=H(e=fa(e))?Z(e):nt,i=n?n[0]:e.charAt(0),r=n?Ji(n,1).join(""):e.slice(1);return i[t]()+r}}function mr(t){return function(e){return g(wa(ya(e).replace(fn,"")),t,"")}}function vr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Hs(t.prototype),i=t.apply(n,e);return ta(i)?i:n}}function _r(t,e,n){function i(){for(var a=arguments.length,s=Ra(a),c=a,u=Fr(i);c--;)s[c]=arguments[c];var l=a<3&&s[0]!==u&&s[a-1]!==u?[]:G(s,u);return(a-=l.length)<n?Ir(t,e,wr,i.placeholder,nt,s,l,nt,nt,n-a):o(this&&this!==Rn&&this instanceof i?r:t,this,s)}var r=vr(t);return i}function br(t){return function(e,n,i){var r=Da(e);if(!Wo(e)){var o=$r(n,3);e=ga(e),n=function(t){return o(r[t],t,r)}}var a=t(e,n,i);return a>-1?r[o?e[a]:a]:nt}}function yr(t){return Ur(function(e){var n=e.length,i=n,r=E.prototype.thru;for(t&&e.reverse();i--;){var o=e[i];if("function"!=typeof o)throw new La(ot);if(r&&!a&&"wrapper"==qr(o))var a=new E([],!0)}for(i=a?i:n;++i<n;){var s=qr(o=e[i]),c="wrapper"==s?Qs(o):nt;a=c&&so(c[0])&&c[1]==(wt|vt|bt|St)&&!c[4].length&&1==c[9]?a[qr(c[0])].apply(a,c[3]):1==o.length&&so(o)?a[s]():a.thru(o)}return function(){var t=arguments,i=t[0];if(a&&1==t.length&&$c(i))return a.plant(i).value();for(var r=0,o=n?e[r].apply(this,t):i;++r<n;)o=e[r].call(this,o);return o}})}function wr(t,e,n,i,r,o,a,s,c,u){function l(){for(var v=arguments.length,_=Ra(v),b=v;b--;)_[b]=arguments[b];if(p)var y=Fr(l),w=L(_,y);if(i&&(_=rr(_,i,r,p)),o&&(_=or(_,o,a,p)),v-=w,p&&v<u){var S=G(_,y);return Ir(t,e,wr,l.placeholder,n,_,S,s,c,u-v)}var T=f?n:this,O=h?T[t]:t;return v=_.length,s?_=_o(_,s):g&&v>1&&_.reverse(),d&&c<v&&(_.length=c),this&&this!==Rn&&this instanceof l&&(O=m||vr(O)),O.apply(T,_)}var d=e&wt,f=e&pt,h=e&gt,p=e&(vt|_t),g=e&Tt,m=h?nt:vr(t);return l}function Sr(t,e){return function(n,i){return Kn(n,t,e(i),{})}}function Tr(t,e){return function(n,i){var r;if(n===nt&&i===nt)return e;if(n!==nt&&(r=n),i!==nt){if(r===nt)return i;"string"==typeof n||"string"==typeof i?(n=zi(n),i=zi(i)):(n=Di(n),i=Di(i)),r=t(n,i)}return r}}function Or(t){return Ur(function(e){return e=h(e,k($r())),Ci(function(n){var i=this;return t(e,function(t){return o(t,i,n)})})})}function Cr(t,e){var n=(e=e===nt?" ":zi(e)).length;if(n<2)return n?Oi(e,t):e;var i=Oi(e,fs(t/Q(e)));return H(e)?Ji(Z(i),0,t).join(""):i.slice(0,t)}function xr(t,e,n,i){function r(){for(var e=-1,c=arguments.length,u=-1,l=i.length,d=Ra(l+c),f=this&&this!==Rn&&this instanceof r?s:t;++u<l;)d[u]=i[u];for(;c--;)d[u++]=arguments[++e];return o(f,a?n:this,d)}var a=e&pt,s=vr(t);return r}function Er(t){return function(e,n,i){return i&&"number"!=typeof i&&ro(e,n,i)&&(n=i=nt),e=sa(e),n===nt?(n=e,e=0):n=sa(n),i=i===nt?e<n?1:-1:sa(i),Ti(e,n,i,t)}}function Ar(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=la(e),n=la(n)),t(e,n)}}function Ir(t,e,n,i,r,o,a,s,c,u){var l=e&vt,d=l?a:nt,f=l?nt:a,h=l?o:nt,p=l?nt:o;e|=l?bt:yt,(e&=~(l?yt:bt))&mt||(e&=~(pt|gt));var g=[t,e,r,h,d,p,f,s,c,u],m=n.apply(nt,g);return so(t)&&nc(m,g),m.placeholder=i,bo(m,t,e)}function Rr(t){var e=ja[t];return function(t,n){if(t=la(t),n=null==n?0:ys(ca(n),292)){var i=(fa(t)+"e").split("e");return+((i=(fa(e(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return e(t)}}function Nr(t){return function(e){var n=tc(e);return n==Jt?$(e):n==Kt?W(e):M(e,t(e))}}function Mr(t,e,n,i,r,o,a,s){var c=e&gt;if(!c&&"function"!=typeof t)throw new La(ot);var u=i?i.length:0;if(u||(e&=~(bt|yt),i=r=nt),a=a===nt?a:bs(ca(a),0),s=s===nt?s:ca(s),u-=r?r.length:0,e&yt){var l=i,d=r;i=r=nt}var f=c?nt:Qs(t),h=[t,e,n,i,r,l,d,o,a,s];if(f&&ho(h,f),t=h[0],e=h[1],n=h[2],i=h[3],r=h[4],!(s=h[9]=h[9]===nt?c?0:t.length:bs(h[9]-u,0))&&e&(vt|_t)&&(e&=~(vt|_t)),e&&e!=pt)p=e==vt||e==_t?_r(t,e,s):e!=bt&&e!=(pt|bt)||r.length?wr.apply(nt,h):xr(t,e,n,i);else var p=pr(t,e,n);return bo((f?Gs:nc)(p,h),t,e)}function kr(t,e,n,i){return t===nt||Jo(t,Ha[n])&&!$a.call(i,n)?e:t}function jr(t,e,n,i,r,o){return ta(t)&&ta(e)&&(o.set(e,t),hi(t,e,nt,jr,o),o.delete(e)),t}function Dr(t){return ia(t)?nt:t}function zr(t,e,n,i,r,o){var a=n&ft,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var u=o.get(t);if(u&&o.get(e))return u==e;var l=-1,d=!0,f=n&ht?new Ye:nt;for(o.set(t,e),o.set(e,t);++l<s;){var h=t[l],p=e[l];if(i)var g=a?i(p,h,l,e,t,o):i(h,p,l,t,e,o);if(g!==nt){if(g)continue;d=!1;break}if(f){if(!v(e,function(t,e){if(!D(f,e)&&(h===t||r(h,t,n,i,o)))return f.push(e)})){d=!1;break}}else if(h!==p&&!r(h,p,n,i,o)){d=!1;break}}return o.delete(t),o.delete(e),d}function Pr(t,e,n,i,r,o,a){switch(n){case ae:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case oe:return!(t.byteLength!=e.byteLength||!o(new Ka(t),new Ka(e)));case Ht:case qt:case Wt:return Jo(+t,+e);case $t:return t.name==e.name&&t.message==e.message;case Zt:case te:return t==e+"";case Jt:var s=$;case Kt:var c=i&ft;if(s||(s=J),t.size!=e.size&&!c)return!1;var u=a.get(t);if(u)return u==e;i|=ht,a.set(t,e);var l=zr(s(t),s(e),i,r,o,a);return a.delete(t),l;case ee:if(Us)return Us.call(t)==Us.call(e)}return!1}function Lr(t,e,n,i,r,o){var a=n&ft,s=Br(t),c=s.length;if(c!=Br(e).length&&!a)return!1;for(var u=c;u--;){var l=s[u];if(!(a?l in e:$a.call(e,l)))return!1}var d=o.get(t);if(d&&o.get(e))return d==e;var f=!0;o.set(t,e),o.set(e,t);for(var h=a;++u<c;){var p=t[l=s[u]],g=e[l];if(i)var m=a?i(g,p,l,e,t,o):i(p,g,l,t,e,o);if(!(m===nt?p===g||r(p,g,n,i,o):m)){f=!1;break}h||(h="constructor"==l)}if(f&&!h){var v=t.constructor,_=e.constructor;v!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return o.delete(t),o.delete(e),f}function Ur(t){return rc(mo(t,nt,Ao),t+"")}function Br(t){return qn(t,ga,Zs)}function Hr(t){return qn(t,ma,Ks)}function qr(t){for(var e=t.name+"",n=Ms[e],i=$a.call(Ms,e)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==t)return r.name}return e}function Fr(t){return($a.call(n,"placeholder")?n:t).placeholder}function $r(){var t=n.iteratee||Oa;return t=t===Oa?ai:t,arguments.length?t(arguments[0],arguments[1]):t}function Vr(t,e){var n=t.__data__;return ao(e)?n["string"==typeof e?"string":"hash"]:n.map}function Gr(t){for(var e=ga(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,lo(r)]}return e}function Jr(t,e){var n=B(t,e);return oi(n)?n:nt}function Wr(t){var e=$a.call(t,ss),n=t[ss];try{t[ss]=nt;var i=!0}catch(t){}var r=Ja.call(t);return i&&(e?t[ss]=n:delete t[ss]),r}function Xr(t,e,n){for(var i=-1,r=n.length;++i<r;){var o=n[i],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=ys(e,t+a);break;case"takeRight":t=bs(t,e-a)}}return{start:t,end:e}}function Yr(t){var e=t.match(ze);return e?e[1].split(Pe):[]}function Qr(t,e,n){for(var i=-1,r=(e=Gi(e,t)).length,o=!1;++i<r;){var a=So(e[i]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++i!=r?o:!!(r=null==t?0:t.length)&&Ko(r)&&io(a,r)&&($c(t)||Fc(t))}function Zr(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&$a.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Kr(t){return"function"!=typeof t.constructor||uo(t)?{}:Hs(es(t))}function to(t,e,n,i){var r=t.constructor;switch(e){case oe:return Xi(t);case Ht:case qt:return new r(+t);case ae:return Yi(t,i);case se:case ce:case ue:case le:case de:case fe:case he:case pe:case ge:return er(t,i);case Jt:return Qi(t,i,n);case Wt:case te:return new r(t);case Zt:return Zi(t);case Kt:return Ki(t,i,n);case ee:return tr(t)}}function eo(t,e){var n=e.length;if(!n)return t;var i=n-1;return e[i]=(n>1?"& ":"")+e[i],e=e.join(n>2?", ":" "),t.replace(De,"{\n/* [wrapped with "+e+"] */\n")}function no(t){return $c(t)||Fc(t)||!!(os&&t&&t[os])}function io(t,e){return!!(e=null==e?Nt:e)&&("number"==typeof t||Ge.test(t))&&t>-1&&t%1==0&&t<e}function ro(t,e,n){if(!ta(n))return!1;var i=typeof e;return!!("number"==i?Wo(n)&&io(e,n.length):"string"==i&&e in n)&&Jo(n[e],t)}function oo(t,e){if($c(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!oa(t))||(Ee.test(t)||!xe.test(t)||null!=e&&t in Da(e))}function ao(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function so(t){var e=qr(t),i=n[e];if("function"!=typeof i||!(e in X.prototype))return!1;if(t===i)return!0;var r=Qs(i);return!!r&&t===r[0]}function co(t){return!!Ga&&Ga in t}function uo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ha)}function lo(t){return t===t&&!ta(t)}function fo(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==nt||t in Da(n)))}}function ho(t,e){var n=t[1],i=e[1],r=n|i,o=r<(pt|gt|wt),a=i==wt&&n==vt||i==wt&&n==St&&t[7].length<=e[8]||i==(wt|St)&&e[7].length<=e[8]&&n==vt;if(!o&&!a)return t;i&pt&&(t[2]=e[2],r|=n&pt?0:mt);var s=e[3];if(s){var c=t[3];t[3]=c?rr(c,s,e[4]):s,t[4]=c?G(t[3],ct):e[4]}return(s=e[5])&&(c=t[5],t[5]=c?or(c,s,e[6]):s,t[6]=c?G(t[5],ct):e[6]),(s=e[7])&&(t[7]=s),i&wt&&(t[8]=null==t[8]?e[8]:ys(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r,t}function po(t){var e=[];if(null!=t)for(var n in Da(t))e.push(n);return e}function go(t){return Ja.call(t)}function mo(t,e,n){return e=bs(e===nt?t.length-1:e,0),function(){for(var i=arguments,r=-1,a=bs(i.length-e,0),s=Ra(a);++r<a;)s[r]=i[e+r];r=-1;for(var c=Ra(e+1);++r<e;)c[r]=i[r];return c[e]=n(s),o(t,this,c)}}function vo(t,e){return e.length<2?t:Dn(t,Ri(e,0,-1))}function _o(t,e){for(var n=t.length,i=ys(e.length,n),r=ar(t);i--;){var o=e[i];t[i]=io(o,n)?r[o]:nt}return t}function bo(t,e,n){var i=e+"";return rc(t,eo(i,Oo(Yr(i),n)))}function yo(t){var e=0,n=0;return function(){var i=ws(),r=Et-(i-n);if(n=i,r>0){if(++e>=xt)return arguments[0]}else e=0;return t.apply(nt,arguments)}}function wo(t,e){var n=-1,i=t.length,r=i-1;for(e=e===nt?i:e;++n<e;){var o=Si(n,r),a=t[o];t[o]=t[n],t[n]=a}return t.length=e,t}function So(t){if("string"==typeof t||oa(t))return t;var e=t+"";return"0"==e&&1/t==-Rt?"-0":e}function To(t){if(null!=t){try{return Fa.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Oo(t,e){return s(Pt,function(n){var i="_."+n[0];e&n[1]&&!d(t,i)&&t.push(i)}),t.sort()}function Co(t){if(t instanceof X)return t.clone();var e=new E(t.__wrapped__,t.__chain__);return e.__actions__=ar(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function xo(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=null==n?0:ca(n);return r<0&&(r=bs(i+r,0)),w(t,$r(e,3),r)}function Eo(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=i-1;return n!==nt&&(r=ca(n),r=n<0?bs(i+r,0):ys(r,i-1)),w(t,$r(e,3),r,!0)}function Ao(t){return(null==t?0:t.length)?In(t,1):[]}function Io(t){return t&&t.length?t[0]:nt}function Ro(t){var e=null==t?0:t.length;return e?t[e-1]:nt}function No(t,e){return t&&t.length&&e&&e.length?yi(t,e):t}function Mo(t){return null==t?t:Os.call(t)}function ko(t){if(!t||!t.length)return[];var e=0;return t=l(t,function(t){if(Xo(t))return e=bs(t.length,e),!0}),N(e,function(e){return h(t,x(e))})}function jo(t,e){if(!t||!t.length)return[];var n=ko(t);return null==e?n:h(n,function(t){return o(e,nt,t)})}function Do(t){var e=n(t);return e.__chain__=!0,e}function zo(t,e){return e(t)}function Po(t,e){return($c(t)?s:qs)(t,$r(e,3))}function Lo(t,e){return($c(t)?c:Fs)(t,$r(e,3))}function Uo(t,e){return($c(t)?h:li)(t,$r(e,3))}function Bo(t,e,n){return e=n?nt:e,e=t&&null==e?t.length:e,Mr(t,wt,nt,nt,nt,nt,e)}function Ho(t,e){var n;if("function"!=typeof e)throw new La(ot);return t=ca(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=nt),n}}function qo(t,e,n){var i=Mr(t,vt,nt,nt,nt,nt,nt,e=n?nt:e);return i.placeholder=qo.placeholder,i}function Fo(t,e,n){var i=Mr(t,_t,nt,nt,nt,nt,nt,e=n?nt:e);return i.placeholder=Fo.placeholder,i}function $o(t,e,n){function i(e){var n=l,i=d;return l=d=nt,m=e,h=t.apply(i,n)}function r(t){return m=t,p=ic(s,e),v?i(t):h}function o(t){var n=t-m,i=e-(t-g);return _?ys(i,f-n):i}function a(t){var n=t-g,i=t-m;return g===nt||n>=e||n<0||_&&i>=f}function s(){var t=Mc();if(a(t))return c(t);p=ic(s,o(t))}function c(t){return p=nt,b&&l?i(t):(l=d=nt,h)}function u(){var t=Mc(),n=a(t);if(l=arguments,d=this,g=t,n){if(p===nt)return r(g);if(_)return p=ic(s,e),i(g)}return p===nt&&(p=ic(s,e)),h}var l,d,f,h,p,g,m=0,v=!1,_=!1,b=!0;if("function"!=typeof t)throw new La(ot);return e=la(e)||0,ta(n)&&(v=!!n.leading,f=(_="maxWait"in n)?bs(la(n.maxWait)||0,e):f,b="trailing"in n?!!n.trailing:b),u.cancel=function(){p!==nt&&Xs(p),m=0,l=g=d=p=nt},u.flush=function(){return p===nt?h:c(Mc())},u}function Vo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new La(ot);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(Vo.Cache||Le),n}function Go(t){if("function"!=typeof t)throw new La(ot);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Jo(t,e){return t===e||t!==t&&e!==e}function Wo(t){return null!=t&&Ko(t.length)&&!Qo(t)}function Xo(t){return ea(t)&&Wo(t)}function Yo(t){if(!ea(t))return!1;var e=Jn(t);return e==$t||e==Ft||"string"==typeof t.message&&"string"==typeof t.name&&!ia(t)}function Qo(t){if(!ta(t))return!1;var e=Jn(t);return e==Vt||e==Gt||e==Bt||e==Qt}function Zo(t){return"number"==typeof t&&t==ca(t)}function Ko(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Nt}function ta(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ea(t){return null!=t&&"object"==typeof t}function na(t){return"number"==typeof t||ea(t)&&Jn(t)==Wt}function ia(t){if(!ea(t)||Jn(t)!=Yt)return!1;var e=es(t);if(null===e)return!0;var n=$a.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Fa.call(n)==Wa}function ra(t){return"string"==typeof t||!$c(t)&&ea(t)&&Jn(t)==te}function oa(t){return"symbol"==typeof t||ea(t)&&Jn(t)==ee}function aa(t){if(!t)return[];if(Wo(t))return ra(t)?Z(t):ar(t);if(as&&t[as])return F(t[as]());var e=tc(t);return(e==Jt?$:e==Kt?J:_a)(t)}function sa(t){return t?(t=la(t),t===Rt||t===-Rt?(t<0?-1:1)*Mt:t===t?t:0):0===t?t:0}function ca(t){var e=sa(t),n=e%1;return e===e?n?e-n:e:0}function ua(t){return t?dn(ca(t),0,jt):0}function la(t){if("number"==typeof t)return t;if(oa(t))return kt;if(ta(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ta(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Me,"");var n=Fe.test(t);return n||Ve.test(t)?En(t.slice(2),n?2:8):qe.test(t)?kt:+t}function da(t){return sr(t,ma(t))}function fa(t){return null==t?"":zi(t)}function ha(t,e,n){var i=null==t?nt:Dn(t,e);return i===nt?n:i}function pa(t,e){return null!=t&&Qr(t,e,Yn)}function ga(t){return Wo(t)?Ze(t):si(t)}function ma(t){return Wo(t)?Ze(t,!0):ci(t)}function va(t,e){if(null==t)return{};var n=h(Hr(t),function(t){return[t]});return e=$r(e),_i(t,n,function(t,n){return e(t,n[0])})}function _a(t){return null==t?[]:j(t,ga(t))}function ba(t){return Tu(fa(t).toLowerCase())}function ya(t){return(t=fa(t))&&t.replace(Je,Fn).replace(hn,"")}function wa(t,e,n){return t=fa(t),e=n?nt:e,e===nt?q(t)?et(t):b(t):t.match(e)||[]}function Sa(t){return function(){return t}}function Ta(t){return t}function Oa(t){return ai("function"==typeof t?t:pn(t,ut))}function Ca(t,e,n){var i=ga(e),r=jn(e,i);null!=n||ta(e)&&(r.length||!i.length)||(n=e,e=t,t=this,r=jn(e,ga(e)));var o=!(ta(n)&&"chain"in n&&!n.chain),a=Qo(t);return s(r,function(n){var i=e[n];t[n]=i,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__);return(n.__actions__=ar(this.__actions__)).push({func:i,args:arguments,thisArg:t}),n.__chain__=e,n}return i.apply(t,p([this.value()],arguments))})}),t}function xa(){}function Ea(t){return oo(t)?x(So(t)):bi(t)}function Aa(){return[]}function Ia(){return!1}var Ra=(e=null==e?Rn:Gn.defaults(Rn.Object(),e,Gn.pick(Rn,_n))).Array,Na=e.Date,Ma=e.Error,ka=e.Function,ja=e.Math,Da=e.Object,za=e.RegExp,Pa=e.String,La=e.TypeError,Ua=Ra.prototype,Ba=ka.prototype,Ha=Da.prototype,qa=e["__core-js_shared__"],Fa=Ba.toString,$a=Ha.hasOwnProperty,Va=0,Ga=function(){var t=/[^.]+$/.exec(qa&&qa.keys&&qa.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ja=Ha.toString,Wa=Fa.call(Da),Xa=Rn._,Ya=za("^"+Fa.call($a).replace(Re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qa=kn?e.Buffer:nt,Za=e.Symbol,Ka=e.Uint8Array,ts=Qa?Qa.allocUnsafe:nt,es=V(Da.getPrototypeOf,Da),ns=Da.create,is=Ha.propertyIsEnumerable,rs=Ua.splice,os=Za?Za.isConcatSpreadable:nt,as=Za?Za.iterator:nt,ss=Za?Za.toStringTag:nt,cs=function(){try{var t=Jr(Da,"defineProperty");return t({},"",{}),t}catch(t){}}(),us=e.clearTimeout!==Rn.clearTimeout&&e.clearTimeout,ls=Na&&Na.now!==Rn.Date.now&&Na.now,ds=e.setTimeout!==Rn.setTimeout&&e.setTimeout,fs=ja.ceil,hs=ja.floor,ps=Da.getOwnPropertySymbols,gs=Qa?Qa.isBuffer:nt,ms=e.isFinite,vs=Ua.join,_s=V(Da.keys,Da),bs=ja.max,ys=ja.min,ws=Na.now,Ss=e.parseInt,Ts=ja.random,Os=Ua.reverse,Cs=Jr(e,"DataView"),xs=Jr(e,"Map"),Es=Jr(e,"Promise"),As=Jr(e,"Set"),Is=Jr(e,"WeakMap"),Rs=Jr(Da,"create"),Ns=Is&&new Is,Ms={},ks=To(Cs),js=To(xs),Ds=To(Es),zs=To(As),Ps=To(Is),Ls=Za?Za.prototype:nt,Us=Ls?Ls.valueOf:nt,Bs=Ls?Ls.toString:nt,Hs=function(){function t(){}return function(e){if(!ta(e))return{};if(ns)return ns(e);t.prototype=e;var n=new t;return t.prototype=nt,n}}();n.templateSettings={escape:Te,evaluate:Oe,interpolate:Ce,variable:"",imports:{_:n}},n.prototype=_.prototype,n.prototype.constructor=n,E.prototype=Hs(_.prototype),E.prototype.constructor=E,X.prototype=Hs(_.prototype),X.prototype.constructor=X,K.prototype.clear=function(){this.__data__=Rs?Rs(null):{},this.size=0},K.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},K.prototype.get=function(t){var e=this.__data__;if(Rs){var n=e[t];return n===at?nt:n}return $a.call(e,t)?e[t]:nt},K.prototype.has=function(t){var e=this.__data__;return Rs?e[t]!==nt:$a.call(e,t)},K.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Rs&&e===nt?at:e,this},tt.prototype.clear=function(){this.__data__=[],this.size=0},tt.prototype.delete=function(t){var e=this.__data__,n=on(e,t);return!(n<0||(n==e.length-1?e.pop():rs.call(e,n,1),--this.size,0))},tt.prototype.get=function(t){var e=this.__data__,n=on(e,t);return n<0?nt:e[n][1]},tt.prototype.has=function(t){return on(this.__data__,t)>-1},tt.prototype.set=function(t,e){var n=this.__data__,i=on(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this},Le.prototype.clear=function(){this.size=0,this.__data__={hash:new K,map:new(xs||tt),string:new K}},Le.prototype.delete=function(t){var e=Vr(this,t).delete(t);return this.size-=e?1:0,e},Le.prototype.get=function(t){return Vr(this,t).get(t)},Le.prototype.has=function(t){return Vr(this,t).has(t)},Le.prototype.set=function(t,e){var n=Vr(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this},Ye.prototype.add=Ye.prototype.push=function(t){return this.__data__.set(t,at),this},Ye.prototype.has=function(t){return this.__data__.has(t)},Qe.prototype.clear=function(){this.__data__=new tt,this.size=0},Qe.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Qe.prototype.get=function(t){return this.__data__.get(t)},Qe.prototype.has=function(t){return this.__data__.has(t)},Qe.prototype.set=function(t,e){var n=this.__data__;if(n instanceof tt){var i=n.__data__;if(!xs||i.length<it-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new Le(i)}return n.set(t,e),this.size=n.size,this};var qs=fr(Nn),Fs=fr(Mn,!0),$s=hr(),Vs=hr(!0),Gs=Ns?function(t,e){return Ns.set(t,e),t}:Ta,Js=cs?function(t,e){return cs(t,"toString",{configurable:!0,enumerable:!1,value:Sa(e),writable:!0})}:Ta,Ws=Ci,Xs=us||function(t){return Rn.clearTimeout(t)},Ys=As&&1/J(new As([,-0]))[1]==Rt?function(t){return new As(t)}:xa,Qs=Ns?function(t){return Ns.get(t)}:xa,Zs=ps?function(t){return null==t?[]:(t=Da(t),l(ps(t),function(e){return is.call(t,e)}))}:Aa,Ks=ps?function(t){for(var e=[];t;)p(e,Zs(t)),t=es(t);return e}:Aa,tc=Jn;(Cs&&tc(new Cs(new ArrayBuffer(1)))!=ae||xs&&tc(new xs)!=Jt||Es&&"[object Promise]"!=tc(Es.resolve())||As&&tc(new As)!=Kt||Is&&tc(new Is)!=ie)&&(tc=function(t){var e=Jn(t),n=e==Yt?t.constructor:nt,i=n?To(n):"";if(i)switch(i){case ks:return ae;case js:return Jt;case Ds:return"[object Promise]";case zs:return Kt;case Ps:return ie}return e});var ec=qa?Qo:Ia,nc=yo(Gs),ic=ds||function(t,e){return Rn.setTimeout(t,e)},rc=yo(Js),oc=function(t){var e=Vo(t,function(t){return n.size===st&&n.clear(),t}),n=e.cache;return e}(function(t){var e=[];return Ae.test(t)&&e.push(""),t.replace(Ie,function(t,n,i,r){e.push(i?r.replace(Ue,"$1"):n||t)}),e}),ac=Ci(function(t,e){return Xo(t)?Sn(t,In(e,1,Xo,!0)):[]}),sc=Ci(function(t,e){var n=Ro(e);return Xo(n)&&(n=nt),Xo(t)?Sn(t,In(e,1,Xo,!0),$r(n,2)):[]}),cc=Ci(function(t,e){var n=Ro(e);return Xo(n)&&(n=nt),Xo(t)?Sn(t,In(e,1,Xo,!0),nt,n):[]}),uc=Ci(function(t){var e=h(t,$i);return e.length&&e[0]===t[0]?Zn(e):[]}),lc=Ci(function(t){var e=Ro(t),n=h(t,$i);return e===Ro(n)?e=nt:n.pop(),n.length&&n[0]===t[0]?Zn(n,$r(e,2)):[]}),dc=Ci(function(t){var e=Ro(t),n=h(t,$i);return(e="function"==typeof e?e:nt)&&n.pop(),n.length&&n[0]===t[0]?Zn(n,nt,e):[]}),fc=Ci(No),hc=Ur(function(t,e){var n=null==t?0:t.length,i=ln(t,e);return wi(t,h(e,function(t){return io(t,n)?+t:t}).sort(nr)),i}),pc=Ci(function(t){return Pi(In(t,1,Xo,!0))}),gc=Ci(function(t){var e=Ro(t);return Xo(e)&&(e=nt),Pi(In(t,1,Xo,!0),$r(e,2))}),mc=Ci(function(t){var e=Ro(t);return e="function"==typeof e?e:nt,Pi(In(t,1,Xo,!0),nt,e)}),vc=Ci(function(t,e){return Xo(t)?Sn(t,e):[]}),_c=Ci(function(t){return qi(l(t,Xo))}),bc=Ci(function(t){var e=Ro(t);return Xo(e)&&(e=nt),qi(l(t,Xo),$r(e,2))}),yc=Ci(function(t){var e=Ro(t);return e="function"==typeof e?e:nt,qi(l(t,Xo),nt,e)}),wc=Ci(ko),Sc=Ci(function(t){var e=t.length,n=e>1?t[e-1]:nt;return n="function"==typeof n?(t.pop(),n):nt,jo(t,n)}),Tc=Ur(function(t){var e=t.length,n=e?t[0]:0,i=this.__wrapped__,r=function(e){return ln(e,t)};return!(e>1||this.__actions__.length)&&i instanceof X&&io(n)?((i=i.slice(n,+n+(e?1:0))).__actions__.push({func:zo,args:[r],thisArg:nt}),new E(i,this.__chain__).thru(function(t){return e&&!t.length&&t.push(nt),t})):this.thru(r)}),Oc=lr(function(t,e,n){$a.call(t,n)?++t[n]:un(t,n,1)}),Cc=br(xo),xc=br(Eo),Ec=lr(function(t,e,n){$a.call(t,n)?t[n].push(e):un(t,n,[e])}),Ac=Ci(function(t,e,n){var i=-1,r="function"==typeof e,a=Wo(t)?Ra(t.length):[];return qs(t,function(t){a[++i]=r?o(e,t,n):ti(t,e,n)}),a}),Ic=lr(function(t,e,n){un(t,n,e)}),Rc=lr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),Nc=Ci(function(t,e){if(null==t)return[];var n=e.length;return n>1&&ro(t,e[0],e[1])?e=[]:n>2&&ro(e[0],e[1],e[2])&&(e=[e[0]]),mi(t,In(e,1),[])}),Mc=ls||function(){return Rn.Date.now()},kc=Ci(function(t,e,n){var i=pt;if(n.length){var r=G(n,Fr(kc));i|=bt}return Mr(t,i,e,n,r)}),jc=Ci(function(t,e,n){var i=pt|gt;if(n.length){var r=G(n,Fr(jc));i|=bt}return Mr(e,i,t,n,r)}),Dc=Ci(function(t,e){return vn(t,1,e)}),zc=Ci(function(t,e,n){return vn(t,la(e)||0,n)});Vo.Cache=Le;var Pc=Ws(function(t,e){var n=(e=1==e.length&&$c(e[0])?h(e[0],k($r())):h(In(e,1),k($r()))).length;return Ci(function(i){for(var r=-1,a=ys(i.length,n);++r<a;)i[r]=e[r].call(this,i[r]);return o(t,this,i)})}),Lc=Ci(function(t,e){var n=G(e,Fr(Lc));return Mr(t,bt,nt,e,n)}),Uc=Ci(function(t,e){var n=G(e,Fr(Uc));return Mr(t,yt,nt,e,n)}),Bc=Ur(function(t,e){return Mr(t,St,nt,nt,nt,e)}),Hc=Ar(Wn),qc=Ar(function(t,e){return t>=e}),Fc=ei(function(){return arguments}())?ei:function(t){return ea(t)&&$a.call(t,"callee")&&!is.call(t,"callee")},$c=Ra.isArray,Vc=zn?k(zn):function(t){return ea(t)&&Jn(t)==oe},Gc=gs||Ia,Jc=Pn?k(Pn):function(t){return ea(t)&&Jn(t)==qt},Wc=Ln?k(Ln):function(t){return ea(t)&&tc(t)==Jt},Xc=Un?k(Un):function(t){return ea(t)&&Jn(t)==Zt},Yc=Bn?k(Bn):function(t){return ea(t)&&tc(t)==Kt},Qc=Hn?k(Hn):function(t){return ea(t)&&Ko(t.length)&&!!yn[Jn(t)]},Zc=Ar(ui),Kc=Ar(function(t,e){return t<=e}),tu=dr(function(t,e){if(uo(e)||Wo(e))sr(e,ga(e),t);else for(var n in e)$a.call(e,n)&&rn(t,n,e[n])}),eu=dr(function(t,e){sr(e,ma(e),t)}),nu=dr(function(t,e,n,i){sr(e,ma(e),t,i)}),iu=dr(function(t,e,n,i){sr(e,ga(e),t,i)}),ru=Ur(ln),ou=Ci(function(t){return t.push(nt,kr),o(nu,nt,t)}),au=Ci(function(t){return t.push(nt,jr),o(du,nt,t)}),su=Sr(function(t,e,n){t[e]=n},Sa(Ta)),cu=Sr(function(t,e,n){$a.call(t,e)?t[e].push(n):t[e]=[n]},$r),uu=Ci(ti),lu=dr(function(t,e,n){hi(t,e,n)}),du=dr(function(t,e,n,i){hi(t,e,n,i)}),fu=Ur(function(t,e){var n={};if(null==t)return n;var i=!1;e=h(e,function(e){return e=Gi(e,t),i||(i=e.length>1),e}),sr(t,Hr(t),n),i&&(n=pn(n,ut|lt|dt,Dr));for(var r=e.length;r--;)Li(n,e[r]);return n}),hu=Ur(function(t,e){return null==t?{}:vi(t,e)}),pu=Nr(ga),gu=Nr(ma),mu=mr(function(t,e,n){return e=e.toLowerCase(),t+(n?ba(e):e)}),vu=mr(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),_u=mr(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),bu=gr("toLowerCase"),yu=mr(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),wu=mr(function(t,e,n){return t+(n?" ":"")+Tu(e)}),Su=mr(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),Tu=gr("toUpperCase"),Ou=Ci(function(t,e){try{return o(t,nt,e)}catch(t){return Yo(t)?t:new Ma(t)}}),Cu=Ur(function(t,e){return s(e,function(e){e=So(e),un(t,e,kc(t[e],t))}),t}),xu=yr(),Eu=yr(!0),Au=Ci(function(t,e){return function(n){return ti(n,t,e)}}),Iu=Ci(function(t,e){return function(n){return ti(t,n,e)}}),Ru=Or(h),Nu=Or(u),Mu=Or(v),ku=Er(),ju=Er(!0),Du=Tr(function(t,e){return t+e},0),zu=Rr("ceil"),Pu=Tr(function(t,e){return t/e},1),Lu=Rr("floor"),Uu=Tr(function(t,e){return t*e},1),Bu=Rr("round"),Hu=Tr(function(t,e){return t-e},0);return n.after=function(t,e){if("function"!=typeof e)throw new La(ot);return t=ca(t),function(){if(--t<1)return e.apply(this,arguments)}},n.ary=Bo,n.assign=tu,n.assignIn=eu,n.assignInWith=nu,n.assignWith=iu,n.at=ru,n.before=Ho,n.bind=kc,n.bindAll=Cu,n.bindKey=jc,n.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return $c(t)?t:[t]},n.chain=Do,n.chunk=function(t,e,n){e=(n?ro(t,e,n):e===nt)?1:bs(ca(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var r=0,o=0,a=Ra(fs(i/e));r<i;)a[o++]=Ri(t,r,r+=e);return a},n.compact=function(t){for(var e=-1,n=null==t?0:t.length,i=0,r=[];++e<n;){var o=t[e];o&&(r[i++]=o)}return r},n.concat=function(){var t=arguments.length;if(!t)return[];for(var e=Ra(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return p($c(n)?ar(n):[n],In(e,1))},n.cond=function(t){var e=null==t?0:t.length,n=$r();return t=e?h(t,function(t){if("function"!=typeof t[1])throw new La(ot);return[n(t[0]),t[1]]}):[],Ci(function(n){for(var i=-1;++i<e;){var r=t[i];if(o(r[0],this,n))return o(r[1],this,n)}})},n.conforms=function(t){return gn(pn(t,ut))},n.constant=Sa,n.countBy=Oc,n.create=function(t,e){var n=Hs(t);return null==e?n:sn(n,e)},n.curry=qo,n.curryRight=Fo,n.debounce=$o,n.defaults=ou,n.defaultsDeep=au,n.defer=Dc,n.delay=zc,n.difference=ac,n.differenceBy=sc,n.differenceWith=cc,n.drop=function(t,e,n){var i=null==t?0:t.length;return i?(e=n||e===nt?1:ca(e),Ri(t,e<0?0:e,i)):[]},n.dropRight=function(t,e,n){var i=null==t?0:t.length;return i?(e=n||e===nt?1:ca(e),e=i-e,Ri(t,0,e<0?0:e)):[]},n.dropRightWhile=function(t,e){return t&&t.length?Bi(t,$r(e,3),!0,!0):[]},n.dropWhile=function(t,e){return t&&t.length?Bi(t,$r(e,3),!0):[]},n.fill=function(t,e,n,i){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&ro(t,e,n)&&(n=0,i=r),Cn(t,e,n,i)):[]},n.filter=function(t,e){return($c(t)?l:An)(t,$r(e,3))},n.flatMap=function(t,e){return In(Uo(t,e),1)},n.flatMapDeep=function(t,e){return In(Uo(t,e),Rt)},n.flatMapDepth=function(t,e,n){return n=n===nt?1:ca(n),In(Uo(t,e),n)},n.flatten=Ao,n.flattenDeep=function(t){return(null==t?0:t.length)?In(t,Rt):[]},n.flattenDepth=function(t,e){return(null==t?0:t.length)?(e=e===nt?1:ca(e),In(t,e)):[]},n.flip=function(t){return Mr(t,Tt)},n.flow=xu,n.flowRight=Eu,n.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,i={};++e<n;){var r=t[e];i[r[0]]=r[1]}return i},n.functions=function(t){return null==t?[]:jn(t,ga(t))},n.functionsIn=function(t){return null==t?[]:jn(t,ma(t))},n.groupBy=Ec,n.initial=function(t){return(null==t?0:t.length)?Ri(t,0,-1):[]},n.intersection=uc,n.intersectionBy=lc,n.intersectionWith=dc,n.invert=su,n.invertBy=cu,n.invokeMap=Ac,n.iteratee=Oa,n.keyBy=Ic,n.keys=ga,n.keysIn=ma,n.map=Uo,n.mapKeys=function(t,e){var n={};return e=$r(e,3),Nn(t,function(t,i,r){un(n,e(t,i,r),t)}),n},n.mapValues=function(t,e){var n={};return e=$r(e,3),Nn(t,function(t,i,r){un(n,i,e(t,i,r))}),n},n.matches=function(t){return di(pn(t,ut))},n.matchesProperty=function(t,e){return fi(t,pn(e,ut))},n.memoize=Vo,n.merge=lu,n.mergeWith=du,n.method=Au,n.methodOf=Iu,n.mixin=Ca,n.negate=Go,n.nthArg=function(t){return t=ca(t),Ci(function(e){return gi(e,t)})},n.omit=fu,n.omitBy=function(t,e){return va(t,Go($r(e)))},n.once=function(t){return Ho(2,t)},n.orderBy=function(t,e,n,i){return null==t?[]:($c(e)||(e=null==e?[]:[e]),n=i?nt:n,$c(n)||(n=null==n?[]:[n]),mi(t,e,n))},n.over=Ru,n.overArgs=Pc,n.overEvery=Nu,n.overSome=Mu,n.partial=Lc,n.partialRight=Uc,n.partition=Rc,n.pick=hu,n.pickBy=va,n.property=Ea,n.propertyOf=function(t){return function(e){return null==t?nt:Dn(t,e)}},n.pull=fc,n.pullAll=No,n.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?yi(t,e,$r(n,2)):t},n.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?yi(t,e,nt,n):t},n.pullAt=hc,n.range=ku,n.rangeRight=ju,n.rearg=Bc,n.reject=function(t,e){return($c(t)?l:An)(t,Go($r(e,3)))},n.remove=function(t,e){var n=[];if(!t||!t.length)return n;var i=-1,r=[],o=t.length;for(e=$r(e,3);++i<o;){var a=t[i];e(a,i,t)&&(n.push(a),r.push(i))}return wi(t,r),n},n.rest=function(t,e){if("function"!=typeof t)throw new La(ot);return e=e===nt?e:ca(e),Ci(t,e)},n.reverse=Mo,n.sampleSize=function(t,e,n){return e=(n?ro(t,e,n):e===nt)?1:ca(e),($c(t)?tn:Ei)(t,e)},n.set=function(t,e,n){return null==t?t:Ai(t,e,n)},n.setWith=function(t,e,n,i){return i="function"==typeof i?i:nt,null==t?t:Ai(t,e,n,i)},n.shuffle=function(t){return($c(t)?en:Ii)(t)},n.slice=function(t,e,n){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&ro(t,e,n)?(e=0,n=i):(e=null==e?0:ca(e),n=n===nt?i:ca(n)),Ri(t,e,n)):[]},n.sortBy=Nc,n.sortedUniq=function(t){return t&&t.length?ji(t):[]},n.sortedUniqBy=function(t,e){return t&&t.length?ji(t,$r(e,2)):[]},n.split=function(t,e,n){return n&&"number"!=typeof n&&ro(t,e,n)&&(e=n=nt),(n=n===nt?jt:n>>>0)?(t=fa(t),t&&("string"==typeof e||null!=e&&!Xc(e))&&!(e=zi(e))&&H(t)?Ji(Z(t),0,n):t.split(e,n)):[]},n.spread=function(t,e){if("function"!=typeof t)throw new La(ot);return e=null==e?0:bs(ca(e),0),Ci(function(n){var i=n[e],r=Ji(n,0,e);return i&&p(r,i),o(t,this,r)})},n.tail=function(t){var e=null==t?0:t.length;return e?Ri(t,1,e):[]},n.take=function(t,e,n){return t&&t.length?(e=n||e===nt?1:ca(e),Ri(t,0,e<0?0:e)):[]},n.takeRight=function(t,e,n){var i=null==t?0:t.length;return i?(e=n||e===nt?1:ca(e),e=i-e,Ri(t,e<0?0:e,i)):[]},n.takeRightWhile=function(t,e){return t&&t.length?Bi(t,$r(e,3),!1,!0):[]},n.takeWhile=function(t,e){return t&&t.length?Bi(t,$r(e,3)):[]},n.tap=function(t,e){return e(t),t},n.throttle=function(t,e,n){var i=!0,r=!0;if("function"!=typeof t)throw new La(ot);return ta(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),$o(t,e,{leading:i,maxWait:e,trailing:r})},n.thru=zo,n.toArray=aa,n.toPairs=pu,n.toPairsIn=gu,n.toPath=function(t){return $c(t)?h(t,So):oa(t)?[t]:ar(oc(fa(t)))},n.toPlainObject=da,n.transform=function(t,e,n){var i=$c(t),r=i||Gc(t)||Qc(t);if(e=$r(e,4),null==n){var o=t&&t.constructor;n=r?i?new o:[]:ta(t)&&Qo(o)?Hs(es(t)):{}}return(r?s:Nn)(t,function(t,i,r){return e(n,t,i,r)}),n},n.unary=function(t){return Bo(t,1)},n.union=pc,n.unionBy=gc,n.unionWith=mc,n.uniq=function(t){return t&&t.length?Pi(t):[]},n.uniqBy=function(t,e){return t&&t.length?Pi(t,$r(e,2)):[]},n.uniqWith=function(t,e){return e="function"==typeof e?e:nt,t&&t.length?Pi(t,nt,e):[]},n.unset=function(t,e){return null==t||Li(t,e)},n.unzip=ko,n.unzipWith=jo,n.update=function(t,e,n){return null==t?t:Ui(t,e,Vi(n))},n.updateWith=function(t,e,n,i){return i="function"==typeof i?i:nt,null==t?t:Ui(t,e,Vi(n),i)},n.values=_a,n.valuesIn=function(t){return null==t?[]:j(t,ma(t))},n.without=vc,n.words=wa,n.wrap=function(t,e){return Lc(Vi(e),t)},n.xor=_c,n.xorBy=bc,n.xorWith=yc,n.zip=wc,n.zipObject=function(t,e){return Fi(t||[],e||[],rn)},n.zipObjectDeep=function(t,e){return Fi(t||[],e||[],Ai)},n.zipWith=Sc,n.entries=pu,n.entriesIn=gu,n.extend=eu,n.extendWith=nu,Ca(n,n),n.add=Du,n.attempt=Ou,n.camelCase=mu,n.capitalize=ba,n.ceil=zu,n.clamp=function(t,e,n){return n===nt&&(n=e,e=nt),n!==nt&&(n=(n=la(n))===n?n:0),e!==nt&&(e=(e=la(e))===e?e:0),dn(la(t),e,n)},n.clone=function(t){return pn(t,dt)},n.cloneDeep=function(t){return pn(t,ut|dt)},n.cloneDeepWith=function(t,e){return e="function"==typeof e?e:nt,pn(t,ut|dt,e)},n.cloneWith=function(t,e){return e="function"==typeof e?e:nt,pn(t,dt,e)},n.conformsTo=function(t,e){return null==e||mn(t,e,ga(e))},n.deburr=ya,n.defaultTo=function(t,e){return null==t||t!==t?e:t},n.divide=Pu,n.endsWith=function(t,e,n){t=fa(t),e=zi(e);var i=t.length,r=n=n===nt?i:dn(ca(n),0,i);return(n-=e.length)>=0&&t.slice(n,r)==e},n.eq=Jo,n.escape=function(t){return t=fa(t),t&&Se.test(t)?t.replace(ye,$n):t},n.escapeRegExp=function(t){return t=fa(t),t&&Ne.test(t)?t.replace(Re,"\\$&"):t},n.every=function(t,e,n){var i=$c(t)?u:Tn;return n&&ro(t,e,n)&&(e=nt),i(t,$r(e,3))},n.find=Cc,n.findIndex=xo,n.findKey=function(t,e){return y(t,$r(e,3),Nn)},n.findLast=xc,n.findLastIndex=Eo,n.findLastKey=function(t,e){return y(t,$r(e,3),Mn)},n.floor=Lu,n.forEach=Po,n.forEachRight=Lo,n.forIn=function(t,e){return null==t?t:$s(t,$r(e,3),ma)},n.forInRight=function(t,e){return null==t?t:Vs(t,$r(e,3),ma)},n.forOwn=function(t,e){return t&&Nn(t,$r(e,3))},n.forOwnRight=function(t,e){return t&&Mn(t,$r(e,3))},n.get=ha,n.gt=Hc,n.gte=qc,n.has=function(t,e){return null!=t&&Qr(t,e,Xn)},n.hasIn=pa,n.head=Io,n.identity=Ta,n.includes=function(t,e,n,i){t=Wo(t)?t:_a(t),n=n&&!i?ca(n):0;var r=t.length;return n<0&&(n=bs(r+n,0)),ra(t)?n<=r&&t.indexOf(e,n)>-1:!!r&&S(t,e,n)>-1},n.indexOf=function(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=null==n?0:ca(n);return r<0&&(r=bs(i+r,0)),S(t,e,r)},n.inRange=function(t,e,n){return e=sa(e),n===nt?(n=e,e=0):n=sa(n),t=la(t),Qn(t,e,n)},n.invoke=uu,n.isArguments=Fc,n.isArray=$c,n.isArrayBuffer=Vc,n.isArrayLike=Wo,n.isArrayLikeObject=Xo,n.isBoolean=function(t){return!0===t||!1===t||ea(t)&&Jn(t)==Ht},n.isBuffer=Gc,n.isDate=Jc,n.isElement=function(t){return ea(t)&&1===t.nodeType&&!ia(t)},n.isEmpty=function(t){if(null==t)return!0;if(Wo(t)&&($c(t)||"string"==typeof t||"function"==typeof t.splice||Gc(t)||Qc(t)||Fc(t)))return!t.length;var e=tc(t);if(e==Jt||e==Kt)return!t.size;if(uo(t))return!si(t).length;for(var n in t)if($a.call(t,n))return!1;return!0},n.isEqual=function(t,e){return ni(t,e)},n.isEqualWith=function(t,e,n){var i=(n="function"==typeof n?n:nt)?n(t,e):nt;return i===nt?ni(t,e,nt,n):!!i},n.isError=Yo,n.isFinite=function(t){return"number"==typeof t&&ms(t)},n.isFunction=Qo,n.isInteger=Zo,n.isLength=Ko,n.isMap=Wc,n.isMatch=function(t,e){return t===e||ri(t,e,Gr(e))},n.isMatchWith=function(t,e,n){return n="function"==typeof n?n:nt,ri(t,e,Gr(e),n)},n.isNaN=function(t){return na(t)&&t!=+t},n.isNative=function(t){if(ec(t))throw new Ma(rt);return oi(t)},n.isNil=function(t){return null==t},n.isNull=function(t){return null===t},n.isNumber=na,n.isObject=ta,n.isObjectLike=ea,n.isPlainObject=ia,n.isRegExp=Xc,n.isSafeInteger=function(t){return Zo(t)&&t>=-Nt&&t<=Nt},n.isSet=Yc,n.isString=ra,n.isSymbol=oa,n.isTypedArray=Qc,n.isUndefined=function(t){return t===nt},n.isWeakMap=function(t){return ea(t)&&tc(t)==ie},n.isWeakSet=function(t){return ea(t)&&Jn(t)==re},n.join=function(t,e){return null==t?"":vs.call(t,e)},n.kebabCase=vu,n.last=Ro,n.lastIndexOf=function(t,e,n){var i=null==t?0:t.length;if(!i)return-1;var r=i;return n!==nt&&(r=(r=ca(n))<0?bs(i+r,0):ys(r,i-1)),e===e?Y(t,e,r):w(t,O,r,!0)},n.lowerCase=_u,n.lowerFirst=bu,n.lt=Zc,n.lte=Kc,n.max=function(t){return t&&t.length?On(t,Ta,Wn):nt},n.maxBy=function(t,e){return t&&t.length?On(t,$r(e,2),Wn):nt},n.mean=function(t){return C(t,Ta)},n.meanBy=function(t,e){return C(t,$r(e,2))},n.min=function(t){return t&&t.length?On(t,Ta,ui):nt},n.minBy=function(t,e){return t&&t.length?On(t,$r(e,2),ui):nt},n.stubArray=Aa,n.stubFalse=Ia,n.stubObject=function(){return{}},n.stubString=function(){return""},n.stubTrue=function(){return!0},n.multiply=Uu,n.nth=function(t,e){return t&&t.length?gi(t,ca(e)):nt},n.noConflict=function(){return Rn._===this&&(Rn._=Xa),this},n.noop=xa,n.now=Mc,n.pad=function(t,e,n){t=fa(t);var i=(e=ca(e))?Q(t):0;if(!e||i>=e)return t;var r=(e-i)/2;return Cr(hs(r),n)+t+Cr(fs(r),n)},n.padEnd=function(t,e,n){t=fa(t);var i=(e=ca(e))?Q(t):0;return e&&i<e?t+Cr(e-i,n):t},n.padStart=function(t,e,n){t=fa(t);var i=(e=ca(e))?Q(t):0;return e&&i<e?Cr(e-i,n)+t:t},n.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Ss(fa(t).replace(ke,""),e||0)},n.random=function(t,e,n){if(n&&"boolean"!=typeof n&&ro(t,e,n)&&(e=n=nt),n===nt&&("boolean"==typeof e?(n=e,e=nt):"boolean"==typeof t&&(n=t,t=nt)),t===nt&&e===nt?(t=0,e=1):(t=sa(t),e===nt?(e=t,t=0):e=sa(e)),t>e){var i=t;t=e,e=i}if(n||t%1||e%1){var r=Ts();return ys(t+r*(e-t+xn("1e-"+((r+"").length-1))),e)}return Si(t,e)},n.reduce=function(t,e,n){var i=$c(t)?g:A,r=arguments.length<3;return i(t,$r(e,4),n,r,qs)},n.reduceRight=function(t,e,n){var i=$c(t)?m:A,r=arguments.length<3;return i(t,$r(e,4),n,r,Fs)},n.repeat=function(t,e,n){return e=(n?ro(t,e,n):e===nt)?1:ca(e),Oi(fa(t),e)},n.replace=function(){var t=arguments,e=fa(t[0]);return t.length<3?e:e.replace(t[1],t[2])},n.result=function(t,e,n){var i=-1,r=(e=Gi(e,t)).length;for(r||(r=1,t=nt);++i<r;){var o=null==t?nt:t[So(e[i])];o===nt&&(i=r,o=n),t=Qo(o)?o.call(t):o}return t},n.round=Bu,n.runInContext=t,n.sample=function(t){return($c(t)?Ke:xi)(t)},n.size=function(t){if(null==t)return 0;if(Wo(t))return ra(t)?Q(t):t.length;var e=tc(t);return e==Jt||e==Kt?t.size:si(t).length},n.snakeCase=yu,n.some=function(t,e,n){var i=$c(t)?v:Ni;return n&&ro(t,e,n)&&(e=nt),i(t,$r(e,3))},n.sortedIndex=function(t,e){return Mi(t,e)},n.sortedIndexBy=function(t,e,n){return ki(t,e,$r(n,2))},n.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var i=Mi(t,e);if(i<n&&Jo(t[i],e))return i}return-1},n.sortedLastIndex=function(t,e){return Mi(t,e,!0)},n.sortedLastIndexBy=function(t,e,n){return ki(t,e,$r(n,2),!0)},n.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=Mi(t,e,!0)-1;if(Jo(t[n],e))return n}return-1},n.startCase=wu,n.startsWith=function(t,e,n){return t=fa(t),n=null==n?0:dn(ca(n),0,t.length),e=zi(e),t.slice(n,n+e.length)==e},n.subtract=Hu,n.sum=function(t){return t&&t.length?R(t,Ta):0},n.sumBy=function(t,e){return t&&t.length?R(t,$r(e,2)):0},n.template=function(t,e,i){var r=n.templateSettings;i&&ro(t,e,i)&&(e=nt),t=fa(t),e=nu({},e,r,kr);var o,a,s=nu({},e.imports,r.imports,kr),c=ga(s),u=j(s,c),l=0,d=e.interpolate||We,f="__p += '",h=za((e.escape||We).source+"|"+d.source+"|"+(d===Ce?Be:We).source+"|"+(e.evaluate||We).source+"|$","g"),p="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++bn+"]")+"\n";t.replace(h,function(e,n,i,r,s,c){return i||(i=r),f+=t.slice(l,c).replace(Xe,U),n&&(o=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=c+e.length,e}),f+="';\n";var g=e.variable;g||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(me,""):f).replace(ve,"$1").replace(_e,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m=Ou(function(){return ka(c,p+"return "+f).apply(nt,u)});if(m.source=f,Yo(m))throw m;return m},n.times=function(t,e){if((t=ca(t))<1||t>Nt)return[];var n=jt,i=ys(t,jt);e=$r(e),t-=jt;for(var r=N(i,e);++n<t;)e(n);return r},n.toFinite=sa,n.toInteger=ca,n.toLength=ua,n.toLower=function(t){return fa(t).toLowerCase()},n.toNumber=la,n.toSafeInteger=function(t){return t?dn(ca(t),-Nt,Nt):0===t?t:0},n.toString=fa,n.toUpper=function(t){return fa(t).toUpperCase()},n.trim=function(t,e,n){if((t=fa(t))&&(n||e===nt))return t.replace(Me,"");if(!t||!(e=zi(e)))return t;var i=Z(t),r=Z(e);return Ji(i,z(i,r),P(i,r)+1).join("")},n.trimEnd=function(t,e,n){if((t=fa(t))&&(n||e===nt))return t.replace(je,"");if(!t||!(e=zi(e)))return t;var i=Z(t);return Ji(i,0,P(i,Z(e))+1).join("")},n.trimStart=function(t,e,n){if((t=fa(t))&&(n||e===nt))return t.replace(ke,"");if(!t||!(e=zi(e)))return t;var i=Z(t);return Ji(i,z(i,Z(e))).join("")},n.truncate=function(t,e){var n=Ot,i=Ct;if(ta(e)){var r="separator"in e?e.separator:r;n="length"in e?ca(e.length):n,i="omission"in e?zi(e.omission):i}var o=(t=fa(t)).length;if(H(t)){var a=Z(t);o=a.length}if(n>=o)return t;var s=n-Q(i);if(s<1)return i;var c=a?Ji(a,0,s).join(""):t.slice(0,s);if(r===nt)return c+i;if(a&&(s+=c.length-s),Xc(r)){if(t.slice(s).search(r)){var u,l=c;for(r.global||(r=za(r.source,fa(He.exec(r))+"g")),r.lastIndex=0;u=r.exec(l);)var d=u.index;c=c.slice(0,d===nt?s:d)}}else if(t.indexOf(zi(r),s)!=s){var f=c.lastIndexOf(r);f>-1&&(c=c.slice(0,f))}return c+i},n.unescape=function(t){return t=fa(t),t&&we.test(t)?t.replace(be,Vn):t},n.uniqueId=function(t){var e=++Va;return fa(t)+e},n.upperCase=Su,n.upperFirst=Tu,n.each=Po,n.eachRight=Lo,n.first=Io,Ca(n,function(){var t={};return Nn(n,function(e,i){$a.call(n.prototype,i)||(t[i]=e)}),t}(),{chain:!1}),n.VERSION="4.17.4",s(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){n[t].placeholder=n}),s(["drop","take"],function(t,e){X.prototype[t]=function(n){n=n===nt?1:bs(ca(n),0);var i=this.__filtered__&&!e?new X(this):this.clone();return i.__filtered__?i.__takeCount__=ys(n,i.__takeCount__):i.__views__.push({size:ys(n,jt),type:t+(i.__dir__<0?"Right":"")}),i},X.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),s(["filter","map","takeWhile"],function(t,e){var n=e+1,i=n==At||3==n;X.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:$r(t,3),type:n}),e.__filtered__=e.__filtered__||i,e}}),s(["head","last"],function(t,e){var n="take"+(e?"Right":"");X.prototype[t]=function(){return this[n](1).value()[0]}}),s(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");X.prototype[t]=function(){return this.__filtered__?new X(this):this[n](1)}}),X.prototype.compact=function(){return this.filter(Ta)},X.prototype.find=function(t){return this.filter(t).head()},X.prototype.findLast=function(t){return this.reverse().find(t)},X.prototype.invokeMap=Ci(function(t,e){return"function"==typeof t?new X(this):this.map(function(n){return ti(n,t,e)})}),X.prototype.reject=function(t){return this.filter(Go($r(t)))},X.prototype.slice=function(t,e){t=ca(t);var n=this;return n.__filtered__&&(t>0||e<0)?new X(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==nt&&(n=(e=ca(e))<0?n.dropRight(-e):n.take(e-t)),n)},X.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},X.prototype.toArray=function(){return this.take(jt)},Nn(X.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),o=n[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);o&&(n.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,c=e instanceof X,u=s[0],l=c||$c(e),d=function(t){var e=o.apply(n,p([t],s));return r&&f?e[0]:e};l&&i&&"function"==typeof u&&1!=u.length&&(c=l=!1);var f=this.__chain__,h=!!this.__actions__.length,g=a&&!f,m=c&&!h;if(!a&&l){e=m?e:new X(this);var v=t.apply(e,s);return v.__actions__.push({func:zo,args:[d],thisArg:nt}),new E(v,f)}return g&&m?t.apply(this,s):(v=this.thru(d),g?r?v.value()[0]:v.value():v)})}),s(["pop","push","shift","sort","splice","unshift"],function(t){var e=Ua[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);n.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var n=this.value();return e.apply($c(n)?n:[],t)}return this[i](function(n){return e.apply($c(n)?n:[],t)})}}),Nn(X.prototype,function(t,e){var i=n[e];if(i){var r=i.name+"";(Ms[r]||(Ms[r]=[])).push({name:e,func:i})}}),Ms[wr(nt,gt).name]=[{name:"wrapper",func:nt}],X.prototype.clone=function(){var t=new X(this.__wrapped__);return t.__actions__=ar(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ar(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ar(this.__views__),t},X.prototype.reverse=function(){if(this.__filtered__){var t=new X(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},X.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=$c(t),i=e<0,r=n?t.length:0,o=Xr(0,r,this.__views__),a=o.start,s=o.end,c=s-a,u=i?s:a-1,l=this.__iteratees__,d=l.length,f=0,h=ys(c,this.__takeCount__);if(!n||!i&&r==c&&h==c)return Hi(t,this.__actions__);var p=[];t:for(;c--&&f<h;){for(var g=-1,m=t[u+=e];++g<d;){var v=l[g],_=v.iteratee,b=v.type,y=_(m);if(b==It)m=y;else if(!y){if(b==At)continue t;break t}}p[f++]=m}return p},n.prototype.at=Tc,n.prototype.chain=function(){return Do(this)},n.prototype.commit=function(){return new E(this.value(),this.__chain__)},n.prototype.next=function(){this.__values__===nt&&(this.__values__=aa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?nt:this.__values__[this.__index__++]}},n.prototype.plant=function(t){for(var e,n=this;n instanceof _;){var i=Co(n);i.__index__=0,i.__values__=nt,e?r.__wrapped__=i:e=i;var r=i;n=n.__wrapped__}return r.__wrapped__=t,e},n.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof X){var e=t;return this.__actions__.length&&(e=new X(this)),(e=e.reverse()).__actions__.push({func:zo,args:[Mo],thisArg:nt}),new E(e,this.__chain__)}return this.thru(Mo)},n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=function(){return Hi(this.__wrapped__,this.__actions__)},n.prototype.first=n.prototype.head,as&&(n.prototype[as]=function(){return this}),n}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Rn._=Gn,define(function(){return Gn})):Mn?((Mn.exports=Gn)._=Gn,Nn._=Gn):Rn._=Gn}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,n,i){!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof n&&n.exports?n.exports=e():t.Parsimmon=e()}(this,function(){"use strict";function e(t){if(!(this instanceof e))return new e(t);this._=t}function n(t){return t instanceof e}function i(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function r(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function o(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?a(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function a(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},o=0;o<n;o++)r[t[o]]=!0;for(var a=0;a<i;a++)r[e[a]]=!0;var s=[];for(var c in r)r.hasOwnProperty(c)&&s.push(c);return s.sort(),s}function s(t){if(!n(t))throw new Error("not a parser: "+t)}function c(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function u(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=y(t),n=0;n<e.length;n++){var i=e.charAt(n);if("i"!=i&&"m"!=i&&"u"!=i)throw new Error('unsupported regexp flag "'+i+'": '+t)}}function l(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function d(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function f(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function h(t,e){var n=e.index,i=n.offset;if(i===t.length)return", got the end of the input";var r=i>0?"'...":"'",o=t.length-i>12?"...'":"'";return" at line "+n.line+" column "+n.column+", got "+r+t.slice(i,i+12)+o}function p(t,e){return"expected "+f(e.expected)+h(t,e)}function g(){for(var t=[].slice.call(arguments),n=t.length,r=0;r<n;r+=1)s(t[r]);return e(function(e,r){for(var a,s=new Array(n),c=0;c<n;c+=1){if(!(a=o(t[c]._(e,r),a)).status)return a;s[c]=a.value,r=a.index}return o(i(r,s),a)})}function m(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return l(e),g.apply(null,t).map(function(t){return e.apply(null,t)})}function v(){var t=[].slice.call(arguments),n=t.length;if(0===n)return O("zero alternates");for(var i=0;i<n;i+=1)s(t[i]);return e(function(e,n){for(var i,r=0;r<t.length;r+=1)if((i=o(t[r]._(e,n),i)).status)return i;return i})}function _(t,e){s(t),s(e);var n=e.then(t).many();return t.chain(function(t){return n.map(function(e){return[t].concat(e)})})}function b(t){d(t);var n="'"+t+"'";return e(function(e,o){var a=o+t.length,s=e.slice(o,a);return s===t?i(a,s):r(o,n)})}function y(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function w(t){return RegExp("^(?:"+t.source+")",y(t))}function S(t,n){u(t),arguments.length>=2?c(n):n=0;var o=w(t),a=""+t;return e(function(t,e){var s=o.exec(t.slice(e));if(s){var c=s[0],u=s[n];if(null!=u)return i(e+c.length,u)}return r(e,a)})}function T(t){return e(function(e,n){return i(n,t)})}function O(t){return e(function(e,n){return r(n,t)})}function C(t){if(n(t))return e(function(e,n){var i=t._(e,n);return i.index=n,i.value="",i});if("string"==typeof t)return C(b(t));if(t instanceof RegExp)return C(S(t));throw new Error("not a string, regexp, or parser: "+t)}function x(t){return l(t),e(function(e,n){var o=e.charAt(n);return n<e.length&&t(o)?i(n+1,o):r(n,"a character matching "+t)})}function E(t,e){var n=t.slice(0,e).split("\n");return{offset:e,line:n.length,column:n[n.length-1].length+1}}function A(){return O("fantasy-land/empty")}var I=e.prototype;I.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(M)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:E(t,e.furthest),expected:e.expected}},I.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=p(t,e),i=new Error(n);throw i.type="ParsimmonError",i.result=e,i},I.or=function(t){return v(this,t)},I.then=function(t){if("function"==typeof t)throw new Error("chaining features of .then are no longer supported, use .chain instead");return s(t),g(this,t).map(function(t){return t[1]})},I.many=function(){var n=this;return e(function(e,r){for(var a=[],s=t;;){if(!(s=o(n._(e,r),s)).status)return o(i(r,a),s);r=s.index,a.push(s.value)}})},I.times=function(n,r){var a=this;return arguments.length<2&&(r=n),c(n),c(r),e(function(e,s){for(var c=[],u=t,l=t,d=0;d<n;d+=1){if(u=a._(e,s),l=o(u,l),!u.status)return l;s=u.index,c.push(u.value)}for(;d<r&&(u=a._(e,s),l=o(u,l),u.status);d+=1)s=u.index,c.push(u.value);return o(i(s,c),l)})},I.result=function(t){return this.map(function(){return t})},I.atMost=function(t){return this.times(0,t)},I.atLeast=function(t){return m(this.times(t),this.many(),function(t,e){return t.concat(e)})},I.map=function(t){l(t);var n=this;return e(function(e,r){var a=n._(e,r);return a.status?o(i(a.index,t(a.value)),a):a})},I["fantasy-land/map"]=I.map,I.skip=function(t){return g(this,t).map(function(t){return t[0]})},I.mark=function(){return m(k,this,k,function(t,e,n){return{start:t,value:e,end:n}})},I.lookahead=function(t){return this.skip(C(t))},I.desc=function(t){var n=this;return e(function(e,i){var r=n._(e,i);return r.status||(r.expected=[t]),r})},I.fallback=function(t){return this.or(T(t))};var R=e(function(t,e){return e>=t.length?r(e,"any character"):i(e+1,t.charAt(e))}),N=e(function(t,e){return i(t.length,t.slice(e))}),M=e(function(t,e){return e<t.length?r(e,"EOF"):i(e,null)}),k=e(function(t,e){return i(e,E(t,e))});I.concat=I.or,I["fantasy-land/concat"]=I.concat,I.empty=A,I["fantasy-land/empty"]=I.empty,I.of=T,I["fantasy-land/of"]=I.of,I.ap=function(t){return m(t,this,function(t,e){return t(e)})},I["fantasy-land/ap"]=I.ap,I.chain=function(t){var n=this;return e(function(e,i){var r=n._(e,i);return r.status?o(t(r.value)._(e,r.index),r):r})},I["fantasy-land/chain"]=I.chain;var j=S(/[0-9]/).desc("a digit"),D=S(/[0-9]*/).desc("optional digits"),z=S(/[a-z]/i).desc("a letter"),P=S(/[a-z]*/i).desc("optional letters"),L=S(/\s*/).desc("optional whitespace"),U=S(/\s+/).desc("whitespace");return e.all=N,e.alt=v,e.any=R,e.custom=function(t){return e(t(i,r))},e.digit=j,e.digits=D,e.eof=M,e.fail=O,e.formatError=p,e.index=k,e.isParser=n,e.lazy=function(n,i){arguments.length<2&&(i=n,n=t);var r=e(function(t,e){return r._=i()._,r._(t,e)});return n?r.desc(n):r},e.letter=z,e.letters=P,e.lookahead=C,e.makeFailure=r,e.makeSuccess=i,e.noneOf=function(t){return x(function(e){return t.indexOf(e)<0})},e.oneOf=function(t){return x(function(e){return t.indexOf(e)>=0})},e.optWhitespace=L,e.Parser=e,e.regex=S,e.regexp=S,e.sepBy=function(t,e){return _(t,e).or(T([]))},e.sepBy1=_,e.seq=g,e.seqMap=m,e.string=b,e.succeed=T,e.takeWhile=function(t){return l(t),e(function(e,n){for(var r=n;r<e.length&&t(e.charAt(r));)r++;return i(r,e.slice(n,r))})},e.test=x,e.whitespace=U,e.empty=A,e["fantasy-land/empty"]=A,e.of=T,e["fantasy-land/of"]=T,e})},{}],36:[function(e,n,i){(function(e){"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof i?n.exports=e():t.store=e()}(this,function(){var n,i={},r="undefined"!=typeof window?window:e,o=r.document,a="localStorage";if(i.disabled=!1,i.version="1.3.20",i.set=function(t,e){},i.get=function(t,e){},i.has=function(e){return i.get(e)!==t},i.remove=function(t){},i.clear=function(){},i.transact=function(t,e,n){null==n&&(n=e,e=null),null==e&&(e={});var r=i.get(t,e);n(r),i.set(t,r)},i.getAll=function(){},i.forEach=function(){},i.serialize=function(t){return JSON.stringify(t)},i.deserialize=function(e){if("string"!=typeof e)return t;try{return JSON.parse(e)}catch(n){return e||t}},function(){try{return a in r&&r[a]}catch(t){return!1}}())n=r[a],i.set=function(e,r){return r===t?i.remove(e):(n.setItem(e,i.serialize(r)),r)},i.get=function(e,r){var o=i.deserialize(n.getItem(e));return o===t?r:o},i.remove=function(t){n.removeItem(t)},i.clear=function(){n.clear()},i.getAll=function(){var t={};return i.forEach(function(e,n){t[e]=n}),t},i.forEach=function(t){for(var e=0;e<n.length;e++){var r=n.key(e);t(r,i.get(r))}};else if(o&&o.documentElement.addBehavior){var s,c;try{(c=new ActiveXObject("htmlfile")).open(),c.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),c.close(),s=c.w.frames[0].document,n=s.createElement("div")}catch(t){n=o.createElement("div"),s=o.body}var u=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(n),s.appendChild(n),n.addBehavior("#default#userData"),n.load(a);var r=t.apply(i,e);return s.removeChild(n),r}},l=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),d=function(t){return t.replace(/^d/,"___$&").replace(l,"___")};i.set=u(function(e,n,r){return n=d(n),r===t?i.remove(n):(e.setAttribute(n,i.serialize(r)),e.save(a),r)}),i.get=u(function(e,n,r){n=d(n);var o=i.deserialize(e.getAttribute(n));return o===t?r:o}),i.remove=u(function(t,e){e=d(e),t.removeAttribute(e),t.save(a)}),i.clear=u(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(a);for(var n=e.length-1;n>=0;n--)t.removeAttribute(e[n].name);t.save(a)}),i.getAll=function(t){var e={};return i.forEach(function(t,n){e[t]=n}),e},i.forEach=u(function(t,e){for(var n,r=t.XMLDocument.documentElement.attributes,o=0;n=r[o];++o)e(n.name,i.deserialize(t.getAttribute(n.name)))})}try{var f="__storejs__";i.set(f,f),i.get(f)!=f&&(i.disabled=!0),i.remove(f)}catch(t){i.disabled=!0}return i.enabled=!i.disabled,i})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){!function(t,i){"use strict";var r="model",o="name",a="type",s="vendor",c="version",u="mobile",l="tablet",d={extend:function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},f={rgx:function(t,e){for(var n,i,r,o,a,s,c=0;c<e.length&&!a;){var u=e[c],l=e[c+1];for(n=i=0;n<u.length&&!a;)if(a=u[n++].exec(t))for(r=0;r<l.length;r++)s=a[++i],"object"==typeof(o=l[r])&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0;c+=2}},str:function(t,e){for(var n in e)if("object"==typeof e[n]&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(d.has(e[n][i],t))return"?"===n?void 0:n}else if(d.has(e[n],t))return"?"===n?void 0:n;return t}},h={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,c],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],c],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],c],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[o,c],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],c],[/(edge)\/((\d+)?[\w\.]+)/i],[o,c],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],c],[/(puffin)\/([\w\.]+)/i],[[o,"Puffin"],c],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],c],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],c],[/(QQ)\/([\d\.]+)/i],[o,c],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[o,c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[c,[o,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[c,[o,"Facebook"]],[/(headlesschrome) ([\w\.]+)/i],[c,[o,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],c],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[o,/(.+(?:g|us))(.+)/,"$1 $2"],c],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[c,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[o,c],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],c],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],c],[/(coast)\/([\w\.]+)/i],[[o,"Opera Coast"],c],[/fxios\/([\w\.-]+)/i],[c,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[c,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[c,o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[c,f.str,h.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],c],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",d.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",d.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",d.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,s,[a,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[s,"Apple"],[a,l]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,r,[a,l]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[r,[s,"Amazon"],[a,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[r,f.str,h.device.amazon.model],[s,"Amazon"],[a,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,s,[a,u]],[/\((ip[honed|\s\w*]+);/i],[r,[s,"Apple"],[a,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,r,[a,u]],[/\(bb10;\s(\w+)/i],[r,[s,"BlackBerry"],[a,u]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[s,"Asus"],[a,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[r,"Xperia Tablet"],[a,l]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[r,[s,"Sony"],[a,u]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,r,[a,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[s,"Nvidia"],[a,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[s,"Sony"],[a,"console"]],[/(sprint\s(\w+))/i],[[s,f.str,h.device.sprint.vendor],[r,f.str,h.device.sprint.model],[a,u]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,r,[a,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[r,/_/g," "],[a,u]],[/(nexus\s9)/i],[r,[s,"HTC"],[a,l]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[r,[s,"Huawei"],[a,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,r,[a,u]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[s,"Microsoft"],[a,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[s,"Microsoft"],[a,u]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[s,"Motorola"],[a,u]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[s,"Motorola"],[a,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,d.trim],[r,d.trim],[a,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[s,"Samsung"],[a,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[s,"Sharp"],[a,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],r,[a,l]],[/smart-tv.+(samsung)/i],[s,[a,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],r,[a,u]],[/sie-(\w+)*/i],[r,[s,"Siemens"],[a,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],r,[a,u]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[s,"Acer"],[a,l]],[/android.+([vl]k\-?\d{3})\s+build/i],[r,[s,"LG"],[a,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],r,[a,l]],[/(lg) netcast\.tv/i],[s,r,[a,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[r,[s,"LG"],[a,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[s,"Lenovo"],[a,l]],[/linux;.+((jolla));/i],[s,r,[a,u]],[/((pebble))app\/[\d\.]+\s/i],[s,r,[a,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[s,r,[a,u]],[/crkey/i],[[r,"Chromecast"],[s,"Google"]],[/android.+;\s(glass)\s\d/i],[r,[s,"Google"],[a,"wearable"]],[/android.+;\s(pixel c)\s/i],[r,[s,"Google"],[a,l]],[/android.+;\s(pixel xl|pixel)\s/i],[r,[s,"Google"],[a,u]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[r,/_/g," "],[s,"Xiaomi"],[a,u]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[r,[s,"Meizu"],[a,l]],[/android.+a000(1)\s+build/i],[r,[s,"OnePlus"],[a,u]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[r,[s,"RCA"],[a,l]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[r,[s,"Dell"],[a,l]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[r,[s,"Verizon"],[a,l]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[s,"Barnes & Noble"],r,[a,l]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[r,[s,"NuVision"],[a,l]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[s,"ZTE"],r,[a,l]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[r,[s,"Swiss"],[a,u]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[r,[s,"Swiss"],[a,l]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[r,[s,"Zeki"],[a,l]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[s,"Dragon Touch"],r,[a,l]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[r,[s,"Insignia"],[a,l]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[r,[s,"NextBook"],[a,l]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[s,"Voice"],r,[a,u]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[s,"LvTel"],r,[a,u]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[r,[s,"Envizen"],[a,l]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[s,r,[a,l]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[r,[s,"MachSpeed"],[a,l]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[s,r,[a,l]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[r,[s,"Rotor"],[a,l]],[/android.+(KS(.+))\s+build/i],[r,[s,"Amazon"],[a,l]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[s,r,[a,l]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[a,d.lowerize],s,r],[/(android.+)[;\/].+build/i],[r,[s,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[c,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,c],[/rv\:([\w\.]+).*(gecko)/i],[c,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,c],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[c,f.str,h.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[c,f.str,h.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[o,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[o,"Symbian"],c],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],c],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[o,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[o,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[o,c],[/(haiku)\s(\w+)/i],[o,c],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[c,/_/g,"."],[o,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[c,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[o,c]]},g=function(t,e){this[o]=t,this[c]=e},m=function(t){this.architecture=t},v=function(t,e,n){this[s]=t,this[r]=e,this[a]=n},_=g,b=g,y=function(e,n){if("object"==typeof e&&(n=e,e=void 0),!(this instanceof y))return new y(e,n).getResult();var i=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),r=n?d.extend(p,n):p,o=new g,a=new m,s=new v,c=new _,u=new b;return this.getBrowser=function(){return f.rgx.call(o,i,r.browser),o.major=d.major(o.version),o},this.getCPU=function(){return f.rgx.call(a,i,r.cpu),a},this.getDevice=function(){return f.rgx.call(s,i,r.device),s},this.getEngine=function(){return f.rgx.call(c,i,r.engine),c},this.getOS=function(){return f.rgx.call(u,i,r.os),u},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,o=new g,a=new m,s=new v,c=new _,u=new b,this},this};y.VERSION="0.7.14",y.BROWSER={NAME:o,MAJOR:"major",VERSION:c},y.CPU={ARCHITECTURE:"architecture"},y.DEVICE={MODEL:r,VENDOR:s,TYPE:a,CONSOLE:"console",MOBILE:u,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"},y.ENGINE={NAME:o,VERSION:c},y.OS={NAME:o,VERSION:c},void 0!==n?(void 0!==e&&e.exports&&(n=e.exports=y),n.UAParser=y):"function"==typeof define&&define.amd?define(function(){return y}):t&&(t.UAParser=y);var w=t&&(t.jQuery||t.Zepto);if(void 0!==w){var S=new y;w.ua=S.getResult(),w.ua.get=function(){return S.getUA()},w.ua.set=function(t){S.setUA(t);var e=S.getResult();for(var n in e)w.ua[n]=e[n]}}}("object"==typeof window?window:this)},{}],38:[function(t,e,n){!function(t){var e={max:0,changeHandler:function(){},className:"",maxReachedClassName:"",maxReachedText:""};t.fn.charcount=function(n){var i,r,o,a,s=this,c=+(n=t.extend({},e,n)).max,u=function(t){var e=t?s.val():"",u=i!==e,l=e.length===c;if(u&&(i=e,r.text(c-e.length).removeClass(n.maxReachedClassName),o.hide(),!a)){var d=s.width();d>0&&(s.width(d-r.outerWidth()-5),a=!0)}u&&l?(r.addClass(n.maxReachedClassName),o.enable()):l&&(o.show(),o.disable())};return c>0&&(s.attr("maxlength",c),r=t('<div class="'+n.className+'" title="'+n.maxReachedText+'"/>').appendTo(s.parent()),o=r.tipsy({trigger:"manual",gravity:"se",offset:4,opacity:.95}).tipsy(!0),u(),s.bind("keydown change paste input propertychange",u)),s}}(iAdvize.$)},{}],39:[function(t,e,n){!function(t){function e(){}function n(t){a=[t]}function i(t,e,n){return t&&t.apply&&t.apply(e.context||e,n)}function r(t){return/\?/.test(t)?"&":"?"}function o(o){function h(t){X++||(Y(),$&&(x[G]={s:[t]}),B&&(t=B.apply(o,[t])),i(P,o,[t,w,o]),i(U,o,[o,w]))}function N(t){X++||(Y(),$&&t!=S&&(x[G]=t),i(L,o,[o,t]),i(U,o,[o,t]))}var M,k,j,D,z,P=(o=t.extend({},A,o)).success,L=o.error,U=o.complete,B=o.dataFilter,H=o.callbackParameter,q=o.callback,F=o.cache,$=o.pageCache,V=o.charset,G=o.url,J=o.data,W=o.timeout,X=0,Y=e;return O&&O(function(t){t.done(P).fail(L),P=t.resolve,L=t.reject}).promise(o),o.abort=function(){!X++&&Y()},!1===i(o.beforeSend,o,[o])||X?o:(G=G||u,J=J?"string"==typeof J?J:t.param(J,o.traditional):u,G+=J?r(G)+J:u,H&&(G+=r(G)+encodeURIComponent(H)+"=?"),!F&&!$&&(G+=r(G)+"_"+(new Date).getTime()+"="),G=G.replace(/=\?(&|$)/,"="+q+"$1"),$&&(M=x[G])?M.s?h(M.s[0]):N(M):(T[q]=n,j=t(y)[0],j.id=f+E++,V&&(j[c]=V),I&&I.version()<11.6?(D=t(y)[0]).text="document.getElementById('"+j.id+"')."+g+"()":j[s]=s,R&&(j.htmlFor=j.id,j.event=p),j[m]=j[g]=j[v]=function(t){if(!j[_]||!/i/.test(j[_])){try{j[p]&&j[p]()}catch(t){}t=a,a=0,t?h(t[0]):N(l)}},j.src=G,Y=function(t){z&&clearTimeout(z),j[v]=j[m]=j[g]=null,C[b](j),D&&C[b](D)},C[d](j,k=C.firstChild),D&&C[d](D,k),z=W>0&&setTimeout(function(){N(S)},W)),o)}var a,s="async",c="charset",u="",l="error",d="insertBefore",f="_jqjsp",h="on",p="onclick",g=h+l,m="onload",v="onreadystatechange",_="readyState",b="removeChild",y="<script>",w="success",S="timeout",T=window,O=t.Deferred,C=t("head")[0]||document.documentElement,x={},E=0,A={callback:f,url:location.href},I=T.opera,R=!!t("<div>").html("\x3c!--[if IE]><i><![endif]--\x3e").find("i").length;o.setup=function(e){t.extend(A,e)},t.jsonp=o}(iAdvize.$)},{}],40:[function(t,e,n){!function(t){function e(t,e){return"function"==typeof t?t.call(e):t}function n(e,n){this.$element=t(e),this.options=n,this.enabled=!0,this.fixTitle()}n.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var i=this.tip();i.find(".tipsy-inner")[this.options.html?"html":"text"](n),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(this.$element.offsetParent());var r,o=t.extend({},this.$element.position(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),a=i[0].offsetWidth,s=i[0].offsetHeight,c=e(this.options.gravity,this.$element[0]);switch(c.charAt(0)){case"n":r={top:o.top+o.height+this.options.offset,left:o.left+o.width/2-a/2};break;case"s":r={top:o.top-s-this.options.offset,left:o.left+o.width/2-a/2};break;case"e":r={top:o.top+o.height/2-s/2,left:o.left-a-this.options.offset};break;case"w":r={top:o.top+o.height/2-s/2,left:o.left+o.width+this.options.offset}}2==c.length&&("w"==c.charAt(1)?r.left=o.left+o.width/2-15:r.left=o.left+o.width/2-a+15),i.css(r).addClass("tipsy-"+c),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+c.charAt(0),this.options.className&&i.addClass(e(this.options.className,this.$element[0])),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){t(this).remove()}):this.tip().remove()},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("original-title"))&&t.attr("original-title",t.attr("title")||"").removeAttr("title")},getTitle:function(){var t,e=this.$element,n=this.options;return this.fixTitle(),"string"==typeof n.title?t=e.attr("title"==n.title?"original-title":n.title):"function"==typeof n.title&&(t=n.title.call(e[0])),(t=(""+t).replace(/(^\s*|\s*$)/,""))||n.fallback},tip:function(){return this.$tip||(this.$tip=t('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},t.fn.tipsy=function(e){function i(i){var r=t.data(i,"tipsy");return r||(r=new n(i,t.fn.tipsy.elementOptions(i,e)),t.data(i,"tipsy",r)),r}if(!0===e)return this.data("tipsy");if("string"==typeof e){var r=this.data("tipsy");return r&&r[e](),this}if((e=t.extend({},t.fn.tipsy.defaults,e)).live||this.each(function(){i(this)}),"manual"!=e.trigger){var o=e.live?"live":"bind",a="hover"==e.trigger?"mouseenter":"focus",s="hover"==e.trigger?"mouseleave":"blur";this[o](a,function(){var t=i(this);t.hoverState="in",0==e.delayIn?t.show():(t.fixTitle(),setTimeout(function(){"in"==t.hoverState&&t.show()},e.delayIn))})[o](s,function(){var t=i(this);t.hoverState="out",0==e.delayOut?t.hide():setTimeout(function(){"out"==t.hoverState&&t.hide()},e.delayOut)})}return this},t.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},t.fn.tipsy.elementOptions=function(e,n){return t.metadata?t.extend({},n,t(e).metadata()):n},t.fn.tipsy.autoNS=function(){return t(this).offset().top>t(document).scrollTop()+t(window).height()/2?"s":"n"},t.fn.tipsy.autoWE=function(){return t(this).offset().left>t(document).scrollLeft()+t(window).width()/2?"e":"w"},t.fn.tipsy.autoBounds=function(e,n){return function(){var i={ns:n[0],ew:n.length>1&&n[1]},r=t(document).scrollTop()+e,o=t(document).scrollLeft()+e,a=t(this);return a.offset().top<r&&(i.ns="n"),a.offset().left<o&&(i.ew="w"),t(window).width()+t(document).scrollLeft()-a.offset().left<e&&(i.ew="e"),t(window).height()+t(document).scrollTop()-a.offset().top<e&&(i.ns="s"),i.ns+(i.ew?i.ew:"")}}}(iAdvize.$)},{}],41:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=i(t("./modules/messenger-tag")),o=i(t("./modules/conversation")),a=iAdvize.$,s="undefined"!=typeof idzCutomData?idzCutomData:{},c=a('<div id="idz-root"></div>').appendTo("body").get(0),u=(0,r.default)(a,iAdvize,s),l=(0,o.default)(c,a,iAdvize,iAdvize.flags,iAdvize.JSONStore,u);t("./modules/targeting/src")(a,iAdvize,l,u)},{"./modules/conversation":44,"./modules/messenger-tag":92,"./modules/targeting/src":105}],42:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return{hasContactOngoing:function(){return t.chat&&(2==t.chat.status||3==t.chat.status&&t.chat.history_id>0)}}}},{}],43:[function(e,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=function(e,n,i,r){var o=null,a=!!i.get("isMessengerChatboxOpen"),s={create:function(t){var e=!1;this.observer=new MutationObserver(function(t){t.forEach(function(t){e?"IFRAME"===t.target.tagName&&"style"===t.attributeName&&(a="inline"===t.target.style.display&&"360pt"===t.target.style.height,i.set("isMessengerChatboxOpen",a)):"fb-xfbml-state"===t.attributeName&&"rendered"===t.target.getAttribute("fb-xfbml-state")&&(e=!0)})}),this.observer.observe(t,{subtree:!0,attributes:!0})},destroy:function(){this.observer.disconnect()}},c={chatbox:{render:function(a){var c=arguments.length>1&&arguments[1]!==t?arguments[1]:"";if(o)throw new Error("A messenger chatbox is already rendered");i.set("messengerChatboxPageId",a),o=n('<div class="fb-customerchat" page_id="'+a+'" ref="'+c+'"></div>').appendTo(e),s.create(o.get(0)),r.renderTagElement(o.get(0))},destroy:function(){n("#fb-root .fb_dialog").remove(),o.remove(),s.destroy(),o=null}},hasContactOngoing:function(){return a}};return a&&c.chatbox.render(i.get("messengerChatboxPageId")),c}},{}],44:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,e,n,i,c,u){var l=(0,o.default)(c,i),d={legacy:(0,a.default)(n),messenger:(0,s.default)(t,e,l,u)};return{hasContactOngoing:function(){return(0,r.some)((0,r.values)(d),function(t){return t.hasContactOngoing()})},getEngine:function(t){return(0,r.omit)(d,"legacy")[t]}}};var r=t("lodash"),o=i(t("./stateStore")),a=i(t("./channels/legacy")),s=i(t("./channels/messenger"))},{"./channels/legacy":42,"./channels/messenger":43,"./stateStore":45,lodash:34}],45:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("lodash");n.default=function(t,e){var n=(0,i.clone)(e);return{get:function(t){return(0,i.get)(n,t)},set:function(e,r){n[e]=r,t.saveData((0,i.pick)(n,e))}}}},{lodash:34}],46:[function(t,e,n){var i=new(0,t("events").EventEmitter),r=t("./events.enum");iAdvize.define("eventManager",function(t,e){return i.events=r,i}),e.exports=i},{"./events.enum":47,events:19}],47:[function(t,e,n){e.exports={chatButtonDisplayed:"ChatButtonDisplayed",callButtonDisplayed:"CallButtonDisplayed",callMeetingConfirmed:"CallMeetingConfirmed",videoButtonDisplayed:"VideoButtonDisplayed",OnXmppConnectionConnected:"xmpp.connection.connected",OnConversationVisioRequested:"conversations.visio.requested",OnConversationVisioClosed:"conversations.visio.closed",OnConversationVisioRefused:"conversations.visio.refused",OnConversationVisioTimeout:"conversations.visio.timeout",OnConversationVisioClose:"conversations.visio.close",OnXmppOOBReceived:"xmpp.message.oob.received",OnXmppConnectionDisconnected:"xmpp.connection.disconnected",OnXmppReconnectionFailed:"xmpp.reconnection.failed",OnConversationChatFileSelected:"conversation.chat.file.selected",OnConversationChatUploadAborted:"conversation.chat.upload.aborted"}},{}],48:[function(t,e,n){"use strict";function i(t){var e=[];return e=r(t),e=o(e)}function r(t){for(var e=[],n=0;n<t.length;n++)"interaction"===t[n].type&&e.push(t[n]);return e}function o(t){for(var e=[],n=0;n<t.length;n++)t[n].is_community||e.push(t[n]);return e}function a(t){return!u.hasJustLoaded&&t.gt_threshold&&null!==t.gt_threshold&&(u.hasTimeRule||!u.hasTimeRule&&f!==t.gt_threshold)}var s=iAdvize.require("eventManager"),c=iAdvize.$,u=t("./stateProvider"),l=t("./thresholdCalculationManager"),d=t("./rulesModificationManager"),f="";iAdvize.gtEnabled&&(s.on("targeting.loaded",function(t){f=iAdvize.gtEnabled,u.hasJustLoaded=!0,u.gtThreshold=iAdvize.gtThreshold;var e={list:i(t.list)},n=c.extend(!0,{},e);l.addRuleParams(e),iAdvize.gtThreshold&&(l.addParamsToCriterias(n),d.setRulesForModification(iAdvize.gtThreshold,n),u.stopModularity=!1),u.hasJustLoaded=!1}),s.on("targeting.rule.triggered",function(t){if("interaction"===t.type){var e=u.areRulesModified;u.areRulesModified=!1,u.stopModularity=!1,l.sendParams("",1,e)}}),s.on("targeting.poll.callback",function(t){if(u.gtThreshold=t.gt_threshold,u.statusCanChange){if(a(t)){u.stopModularity=!1;var e={list:u.cloneOriginRules},n=c.extend(!0,{},e);d.setRulesForModification(t.gt_threshold,n),f=t.gt_threshold}u.hasJustLoaded=!1}}))},{"./rulesModificationManager":49,"./stateProvider":50,"./thresholdCalculationManager":51}],49:[function(t,e,n){"use strict";function i(t){for(var e=0;e<t.length;e++){var n=t[e];u.isTimeCriteria(t,n,e)}}function r(t,e,n){for(var i=t.length,r=0;r<i;r++){var o=n,a=t[r];a.isModular&&(a.value<0&&e&&(a.value=1),void 0===a.getValue()&&a.isModular&&u.setNewStat(a),null===a.geniusTargetingMaxBoundary&&null===a.geniusTargetingMinBoundary||(o=u.hasBoundaries(a,o,e)),u.modifyCriteriaValue(a,o,e),a.value=a.value.toString())}}function o(t,e){t.executed||0!==t[e].conditions.length||(t.executed=!0,iAdvize.gtDarkLaunchEnabled||c.hasJustLoaded||iAdvize.ProActif.fireRule(t[e]),c.stopModularity=!0,u.sendParams("",1,!0))}function a(){c.stopModularity,u.sendParams("",0,!0)}var s=iAdvize.$,c=t("./stateProvider"),u=t("./thresholdCalculationManager"),l=[];n.setRulesForModification=function(t,e){var n,d=!1,f=e.list,h=f.length;iAdvize.gtDarkLaunchEnabled||(c.areRulesModified=!0),t>0?d=!0:t*=-1,n=t;for(var p=0;p<h;p++){var g=f[p].conditions;r(g,d,n),i(g),l.push(s.extend(!0,{},f[p])),u.oldParseRules(f[p]),c.stopModularity||o(f,p)}c.stopModularity||a(),!iAdvize.gtDarkLaunchEnabled&&c.hasJustLoaded&&(iAdvize.proactifData=l)}},{"./stateProvider":50,"./thresholdCalculationManager":51}],50:[function(t,e,n){"use strict";var i={statusCanChange:!0,stopModularity:!1,hasJustLoaded:!1,hasTimeRule:!1,noneModularRules:[],cloneOriginRules:"",sentThreshold:"",areRulesModified:!1,startTime:new Date};e.exports=i},{}],51:[function(e,n,i){"use strict";function r(t,e){var n={list:t.list},i=H.extend(!0,{},n);f(e);var r={list:e},s=H.extend(!0,{},r);s=O(i,q.noneModularRules,s),q.cloneOriginRules=H.extend(!0,{},s),q.cloneOriginRules=q.cloneOriginRules.list,o(s),q.hasTimeRule&&a(t,e)}function o(t){$||q.statusCanChange?$&&!q.statusCanChange?(x("null",1,!1),t.list=[]):q.statusCanChange&&t.list.length>0&&E(t):(x("null",0,!1),t.list=[]),iAdvize.ProActif._ModifiedDatas=t.list}function a(t,e){setTimeout(function(){q.statusCanChange=!0,V=!1,r(t,e)},3e4)}function s(t){for(var e=t.list,n=e.length,i=0;i<n;i++)for(var r=e[i].conditions.length,o=0;o<r;o++)c(iAdvize.ProActif.createCondition(e[i].conditions[o]));return e}function c(t){t.isModular=u(t),t.isModular?t.originVal=t.value:l(t)}function u(t){var e=t.criteria;return!("INTEGER"!==t.getType()&&"FHTML"!==t.getType()&&"HTML"!==t.getType()&&"IHTML"!==t.getType()&&"FLOAT"!==t.getType()&&"ACTIVITY"!==t.getType()||isNaN(t.getValue())&&void 0!==t.getValue()||t.logicalOperator!==J.opMoreThan&&t.logicalOperator!==J.opLessThan||"lastseen"===e.field||"chatcount"===e.field)}function l(t){"dureePageEnCours"===t.criteria.field&&(q.hasTimeRule=!0,d(t))}function d(t){var e=new Date,n=1e3*t.value;t.time=new Date(e.setMilliseconds(q.startTime.getMilliseconds()+n))}function f(t){for(var e=t.length,n=[];e--;)h(t,e,n);m(n),b(n)}function h(t,e,n){var i=t[e],r={list:i},o={list:i},a=H.extend(!0,{},r),s=H.extend(!0,{},o),c=i.conditions.length;for(p(s.list,e);c--;)a.list.conditions=[],y(n,w(a,t,e,c))}function p(t,e){for(var n=t.conditions,i=0;i<n.length;i++)n[i]=iAdvize.ProActif.createCondition(n[i]),g(n,n[i],i);D(t),0===t.conditions.length&&($=!0,V=!0)}function g(t,e,n){"dureePageEnCours"===e.criteria.field&&(S(e),e.isValid&&t.splice(n,1))}function m(t){for(var e=t.length,n=0;n<e;n++){var i=t[n],r=[];v(i.conditions.length,i,r),_(r,i)}}function v(t,e,n){for(var i=0;i<t;i++)e.conditions[i].isModular||e.conditions[i].isValid||n.push(2),!e.conditions[i].isModular&&e.conditions[i].isValid&&(e.modularRule=!0,n.push(1)),e.conditions[i].isModular&&n.push(0)}function _(t,e){B.indexOf(t,2)>=0?e.modularRule=!1:B.indexOf(t,1)<0?e.modularRule=!0:B.indexOf(t,1)>=0&&B.indexOf(t,0)>=0?e.modularRule=!0:(e.modularRule=!1,q.statusCanChange=!1,G=e.id)}function b(t){var e=t.length;q.noneModularRules=[];for(var n=0;n<e;n++)t[n].modularRule||q.noneModularRules.push(t[n])}function y(t,e){if(t.length){for(var n=!1,i=t.length,r=0;r<i;r++)t[r].label===e.label&&(n=!0);if(n)for(var o=0;o<i;o++){var a=H.inArray(e.conditions[0],t[o].conditions);t[o].label===e.label&&a<0&&t[o].conditions.push(e.conditions[0])}else t.push(e)}else t.push(e)}function w(t,e,n,i){var r={list:t.list},o=H.extend(!0,{},r),a=iAdvize.ProActif.createCondition(e[n].conditions[i]);return void 0===a.getValue()&&a.isModular&&T(a),t.list.conditions.push(a),D(t.list),t.list.conditions.length?a.isValid=!1:a.isValid=!0,S(a),o.list.conditions.push(a),o.list}function S(t){t.time&&new Date>=t.time&&(t.isValid=!0)}function T(t){var e=t.criteria;iAdvize.ProActif.vStatsI||(iAdvize.ProActif.vStatsI={}),iAdvize.ProActif.vStatsI[e.field]||(iAdvize.ProActif.vStatsI[e.field]=!0,iAdvize.vStats[e.field]=60*iAdvize.vStats[e.field]||0)}function O(t,e,n){if(e.length){var i=t.list.length,r=e.length;r===i&&(q.statusCanChange=!1);for(var o=0;o<i;o++)for(var a=t.list[o],s=0;s<r;s++)C(a,e,s,n)}return n}function C(t,e,n,i){if(t.label===e[n].label)for(var r=0;r<i.list.length;r++)if(t.label===i.list[r].label){var o=B.indexOf(i.list,i.list[r]);i.list.splice(o,1)}}function x(t,e,n){F.setParam("ruleId",G),""!==t&&F.setParam("visitorThreshold",t),iAdvize.gtDarkLaunchEnabled?n?F.setParam("ghostEligibility",e):F.setParam("isEligible",e):n?F.setParam("isEligible",e):F.setParam("disabledEligibility",e),iAdvize.gtDarkLaunchEnabled||q.gtThreshold||n||F.setParam("isEligible",e),!iAdvize.gtDarkLaunchEnabled||q.gtThreshold||n||F.setParam("ghostEligibility",e)}function E(t){for(var e=t.list.length,n=0;n<e;n++){for(var i=0;i<t.list[n].conditions.length;i++){var r=t.list[n].conditions[i];r.isModular&&(r.toModify=A(r),r.toModify?I(t.list[n],n,r):R(r),L(t.list[n],r))}U(t.list,n),t.list.visitorThreshold==t.list[n].threshold&&(G=t.list[n].id)}var o=+$;"boolean"==typeof t.list.visitorThreshold&&(t.list.visitorThreshold="null"),x(t.list.visitorThreshold,o,!1)}function A(t){return V&&t.isValid||!V&&!t.isValid}function I(t,e,n){var i=N(n);null===n.geniusTargetingMaxBoundary&&null===n.geniusTargetingMinBoundary||(i=M(n,i,V)),k(n,i,V),j(t,e,n)}function R(t){t.threshold=0}function N(e){var n=0;return e.previousStep=0,e.step!==t&&(e.previousStep=e.step,e.step=n=e.step+5),n}function M(t,e,n){var i=t.geniusTargetingMaxBoundary,r=t.geniusTargetingMinBoundary;return null!==i&&(n&&t.logicalOperator===J.opMoreThan&&e>i||!n&&t.logicalOperator===J.opLessThan&&e>i)?(e=i,t.modifiedWithBoundary=!0):null!==r&&(n&&t.logicalOperator===J.opLessThan&&e>r||!n&&t.logicalOperator===J.opMoreThan&&e>r)&&(e=r,t.modifiedWithBoundary=!0),e}function k(t,e,n){t.step=e,t.value=parseFloat(t.originVal);var i=t.value*e/100;n?(t.logicalOperator===J.opMoreThan&&(t.value=t.value+i),t.logicalOperator===J.opLessThan&&(t.value=t.value-i)):(t.logicalOperator===J.opMoreThan&&(t.value=t.value-i),t.logicalOperator===J.opLessThan&&(t.value=t.value+i))}function j(t,e,n){var i=H.extend(!0,{},t);i.conditions=[],i.conditions.push(n),D(i),z(i,e,n)}function D(t){t.conditions=B.map(t.conditions,iAdvize.ProActif.createCondition),t.conditions=B.reject(t.conditions,B.partial(iAdvize.ProActif.isRuleConditionMet.bind(iAdvize.ProActif),B,t.id))}function z(t,e,n){V&&0===t.conditions.length||!V&&t.conditions.length>0?n.modifiedWithBoundary?n.threshold=V:I(t,e,n):P(n)}function P(t){t.threshold="-"+t.step,V&&(t.threshold="+"+t.previousStep),0==t.threshold&&(t.threshold=t.threshold.slice(1,2))}function L(e,n){e.threshold===t||!0===e.threshold&&!0!==n.threshold?e.threshold=n.threshold:!1===e.threshold||!1===n.threshold?e.threshold=!1:!0===e.threshold&&!0===n.threshold?e.threshold=!0:!0===n.threshold&&!0!==e.threshold?e.threshold=e.threshold:e.threshold=Math.min(e.threshold,n.threshold)}function U(t,e){t.visitorThreshold?!0===t.visitorThreshold||!0===t[e].threshold?t.visitorThreshold="null":!1===t.visitorThreshold&&!1!==t[e].threshold?t.visitorThreshold=t[e].threshold:!1!==t.visitorThreshold&&!1===t[e].threshold?t.visitorThreshold=t.visitorThreshold:t.visitorThreshold=Math.max(t.visitorThreshold,t[e].threshold):"boolean"==typeof t[e].threshold?t.visitorThreshold=t[e].threshold:t.visitorThreshold=parseInt(t[e].threshold,10),t.visitorThreshold>0&&(t.visitorThreshold="+"+t.visitorThreshold)}var B=e("lodash"),H=iAdvize.$,q=e("./stateProvider"),F=e("../../livechat/src/polling"),$=!1,V=!1,G="",J={opMoreThan:"more than",opLessThan:"less than"};i.addRuleParams=function(t){r(t,s(t))},i.hasBoundaries=M,i.modifyCriteriaValue=k,i.setNewStat=T,i.sendParams=x,i.addParamsToCriterias=s,i.isTimeCriteria=g,i.oldParseRules=D},{"../../livechat/src/polling":75,"./stateProvider":50,lodash:34}],52:[function(t,e,n){"use strict";var i=iAdvize.require("eventManager");i.on("targeting.rule.presence.updated",function(t){iAdvize.callbacks.onTargetingRuleTriggered(t)}),i.on("call.popin.open",function(){iAdvize.callbacks.onVisitorCallboxDisplayed()})},{}],53:[function(t,e,n){!function(t){function e(){}var n=t.callbacks={onScriptLoaded:e,onInvitationDisplayed:e,onChatDisplayed:e,onChatHidden:e,onChatButtonDisplayed:e,onCallButtonDisplayed:e,onVideoButtonDisplayed:e,onChatStarted:e,onChatEnded:e,onCallStarted:e,onCallEnded:e,onStatusChanged:e,onCallStatusChanged:e,onRuleStarted:e,onCookieSaved:e,onMessageReceived:e,onMessageSent:e,onAlertReceived:e,onOperatorWriting:e,onOperatorStopWriting:e,onVisitorWriting:e,onVisitorStopWriting:e,onOfferReceived:e,onLinkReceived:e,onCobrowsingRequested:e,onCobrowsingAccepted:e,onCobrowsingRefused:e,onCobrowsingStopped:e,onSatisfactionDisplayed:e,onSatisfactionAnswered:e,onVisitorTransferred:e,onVisitorCallboxDisplayed:e,onTargetingRuleTriggered:e},i={onInvitation:"onInvitationDisplayed",onC2cStatusChanged:"onCallStatusChanged",onOperatorMsg:"onMessageReceived",onVisitorMsg:"onMessageSent"};if("undefined"!=typeof iAdvizeCallbacks){var r=iAdvizeCallbacks;for(var o in r)"function"==typeof r[o]&&(n[o in i?i[o]:o]=function(t){return function(){try{r[t].apply(this,arguments)}catch(t){}}}(o))}}(iAdvize)},{}],54:[function(t,e,n){function i(t,e){return["sid="+e.website_id,"u="+e.vuid,"data="+encodeURIComponent(JSON.stringify(t)),"callback=?"].join("&")}function r(){}var o=t("lodash");e.exports=function(t,e){var n={},a={};n.onSave=function(t){this.saveData(t)},n.save=function(n){var o=n;o||(o=a,a={}),t.getJSON(e.chaturl+"rpc/jsonstore.php?"+i(o,e),r)};var s=o.debounce(n.save,1600);return n.saveData=function(t){o.each(t,function(t,e){a[e]=t}),s()},n}},{lodash:34}],55:[function(t,e,n){!function(t){var e=null,n=t.chaturl+"popout.php?idzchat&sid="+t.website_id;t.PopOut={popChatOut:function(i){var r="resizable=no, location=no, status=no, menubar=no";(i=i||{}).template&&(n+="&tpl="+i.template),i.width?r+=", width="+i.width:r+=", width=565",i.height?r+=", height="+i.height:r+=", height=325",i.top&&(r+=", top="+i.top),i.left&&(r+=", left="+i.left),t.Templates.hideUI(),e=window.open(n,"idzchat",r),window.focus&&e&&e.focus()}}}(iAdvize)},{}],56:[function(e,n,i){iAdvize.Store=function(){function e(t){return JSON.stringify(t)}function n(e){var n;if("string"!=typeof e)return t;try{n=JSON.parse(e)}catch(t){}return n}var i={},r={};return i.set=function(){},i.get=function(){},i.remove=function(){},i.clear=function(){},window.sessionStorage?(i.set=function(t,n){try{window.sessionStorage.setItem(t,e(n))}catch(t){}},i.get=function(t){return n(window.sessionStorage.getItem(t))},i.remove=function(t){window.sessionStorage.removeItem(t)},i.clear=function(){window.sessionStorage.clear()}):(i.get=function(t){return r[t]},i.set=function(t,e){return r[t]=e},i.remove=function(t){delete r[t]},i.clear=function(){for(var t in r)delete r[t]}),i.addToItem=function(t,e){var n=i.get(t);n=n?n+e:e,i.set(t,n)},i.incrementItem=function(t){this.addToItem(t,1)},i.decrementItem=function(t){this.addToItem(t,-1)},i}()},{}],57:[function(t,e,n){e.exports=function(t,e){e.util={detectDoctype:function(){var t=/\s+(X?HTML)\s+([\d\.]+)\s*([^\/]+)*\//gi,e=0;if(void 0!==document.namespaces){if(8!=document.all[0].nodeType)return null;t.exec(document.all[0].nodeValue),-1!=document.all[0].nodeValue.indexOf("loose")&&(e=1)}else{if(null==document.doctype)return null;t.exec(document.doctype.publicId),document.doctype.systemId&&-1!=document.doctype.systemId.indexOf("loose")&&(e=1)}return{xhtml:RegExp.$1,version:RegExp.$2,importance:RegExp.$3,loose:e}},get_body:function(){var t=document.getElementsByTagName("html")||"",e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0];var n=null;return(t=document.getElementsByTagName("body")||"").length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),e.appendChild(n)),n},get_head:function(){var t=document.getElementsByTagName("html"),e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0];var n=null;return(t=document.getElementsByTagName("head")).length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),e.appendChild(n)),n},load_js:function(t,e){var n=this.get_head(),i=document.createElement("script");i.async=!0,i.setAttribute("language","javascript"),i.setAttribute("type","text/javascript"),i.setAttribute("src",t),n.insertBefore(i,n.firstChild);i.onload=i.onreadystatechange=function(){this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||e()}},load_css:function(t){var e=this.get_head(),n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t),e.appendChild(n)},addScript:function(t,e){var n=new Date,i=document.getElementById(t);null!==i&&i.parentNode.removeChild(i);var r=this.get_head(),o=document.createElement("script");o.id=t,o.type="text/javascript",o.async=!0,o.src=e+"&random="+n.getTime(),r.insertBefore(o,r.firstChild);o.onload=o.onreadystatechange=function(){!this.readyState||"complete"===this.readyState||this.readyState}},delScript:function(t){var e=document.getElementById(t);null!==e&&e.parentNode.removeChild(e)},addEvent:function(t,e,n,i){return t.addEventListener?(t.addEventListener(e,n,i),!0):t.attachEvent?t.attachEvent("on"+e,n):void 0},removeEvent:function(t,e,n,i){return t.removeEventListener?(t.removeEventListener(e,n,i),!0):t.detachEvent?t.detachEvent("on"+e,n):void 0},setCookie:function(t,e){var n=new Date;n.setTime(n.getTime()+6e4),document.cookie=t+"="+e+"; expires="+n.toGMTString()},getCookie:function(t){var e=document.cookie.indexOf(t+"="),n=e+t.length+1;if(!e&&t!=document.cookie.substring(0,t.length))return null;if(-1==e)return null;var i=document.cookie.indexOf(";",n);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(n,i))},delCookie:function(t){var e=new Date;e.setTime(e.getTime()-6e4),document.cookie=t+"= ; expires="+e.toGMTString()},nl2br:function(t){return(t+"").replace(/([^>]?)(\r\n|\n\r|\n|\r)/g,"$1<br/>")},htmlspecialchars:function(t){return"string"==typeof t&&(t=(t=(t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#039;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/\\/g,"&#92;")),t},htmlSimpleEscape:function(t){return"string"==typeof t&&(t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;")),t},long2ip:function(t){var e=!1;return!isNaN(t)&&(t>=0||t<=4294967295)&&(e=Math.floor(t/Math.pow(256,3))+"."+Math.floor(t%Math.pow(256,3)/Math.pow(256,2))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)/Math.pow(256,1))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)%Math.pow(256,1)/Math.pow(256,0))),e},sec2minsec:function(t){var e=Math.floor(t/60),n=t%60;return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},getDebounce:function(t,e){var n=null,i=[],r=function(){e(i),i=[],n=null};return function(){n&&(clearTimeout(n),n=null),i.push(arguments),n=setTimeout(r,t)}},proxy:function(t,e){return outfunc=function(){return t.apply(e||this,arguments)},outfunc},runOnce:function(t,e){var n=null,i=!1;return function(){!1===i&&(i=!0,e(arguments)),n||(n=setTimeout(function(){i=!1,n=null},t))}},retry:function(t,n,i,r,o){var a=o||e.$.Deferred();return--t,n.apply(i,r).done(function(t){a.resolve(t)}).fail(function(){t?e.util.retry(t,n,i,r,a):a.reject()}),a.promise()},string:{padLeft:function(t,e,n){for(var i=t;i.length<n;)i=e+i;return i}},date:{getMonthName:function(t){if(!t)return"";switch(t.getMonth()){case 0:return e.T("january");case 1:return e.T("february");case 2:return e.T("march");case 3:return e.T("april");case 4:return e.T("may");case 5:return e.T("june");case 6:return e.T("july");case 7:return e.T("august");case 8:return e.T("september");case 9:return e.T("october");case 10:return e.T("november");case 11:return e.T("december");default:return""}},getDayName:function(t){if(!t)return"";switch(t.getDay()){case 0:return e.T("sunday");case 1:return e.T("monday");case 2:return e.T("tuesday");case 3:return e.T("wednesday");case 4:return e.T("thursday");case 5:return e.T("friday");case 6:return e.T("saturday");default:return""}},formatDate:function(t,n){var i=this.getMonthName(t),r=this.getDayName(t);return n.replace(/yyyy/g,t.getFullYear()).replace(/yy/g,String(t.getFullYear()).substr(2,2)).replace(/MMM/g,i.substr(0,3).toUpperCase()).replace(/Mmm/g,i.substr(0,3)).replace(/MM\*/g,i.toUpperCase()).replace(/Mm\*/g,i).replace(/mm/g,e.util.string.padLeft(String(t.getMonth()+1),"0",2)).replace(/DDD/g,r.substr(0,3).toUpperCase()).replace(/Ddd/g,r.substr(0,3)).replace(/DD\*/g,r.toUpperCase()).replace(/Dd\*/g,r).replace(/dd/g,e.util.string.padLeft(String(t.getDate()),"0",2)).replace(/d\*/g,t.getDate()).replace(/hh/g,e.util.string.padLeft(String(t.getHours()),"0",2)).replace(/ii/g,e.util.string.padLeft(String(t.getMinutes()),"0",2))},getDateISOString:function(t){if(t.toISOString)return t.toISOString();var n=e.util.string.padLeft(String(t.getUTCMonth()+1),"0",2),i=e.util.string.padLeft(String(t.getUTCDate()),"0",2),r=e.util.string.padLeft(String(t.getUTCHours()),"0",2),o=e.util.string.padLeft(String(t.getUTCMinutes()),"0",2),a=e.util.string.padLeft(String(t.getUTCSeconds()),"0",2),s=e.util.string.padLeft(String(t.getUTCMilliseconds()),"0",3),c=t.getUTCFullYear()+"-"+n+"-"+i+"T";return c+=r+":"+o+":"+a+"."+s+"Z"}},object:{mapKey:function(t,e){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[e(i)]=t[i]);return n}},JSONStringify:function(e){for(var n="",i=["Array","Object","String"],r={},o=0;o<i.length;o++)t[i[o]].prototype.toJSON&&(r[i[o]]=t[i[o]].prototype.toJSON,delete t[i[o]].prototype.toJSON);try{n=JSON.stringify(e)}catch(t){}finally{for(var a in r)r.hasOwnProperty(a)&&(t[a].prototype.toJSON=r[a])}return n}}}},{}],58:[function(t,e,n){"use strict";e.exports=function(t,e){var n=iAdvize,i=!1,r=function(){return!!(window.File&&window.FileList&&window.FileReader)&&void 0!==window.FormData};t.on(e.OnConversationChatFileSelected,function(n){for(var i=n.target.files,r=0;r<i.length;r++){var o=i[r];o.size>3e7?t.emit(e.OnConversationChatUploadMaxSizeReached,3e7,o):/image\//.test(o.type)||/application\/pdf/.test(o.type)?t.emit(e.OnConversationChatUploadFilesChecked,o):t.emit(e.OnConversationChatUploadBadMimeType,o)}}),t.on(e.OnXmppConnectionConnected,function(){r()&&n.Templates.upload&&!i&&(n.Templates.upload.initialize(),i=!0,t.emit(e.OnConversationChatUploadInitialized))})}},{}],59:[function(t,e,n){"use strict";e.exports=function(t,e,n){var i=function(e){var n=t.$("#idz_msgmsg").get(0),i=n.selectionStart,r=[n.value.substr(0,n.selectionStart),e,n.value.substr(n.selectionStart,n.value.length-1)].join("");t.$(n).val(r).focus().trigger("change"),n.setSelectionRange(i+e.length,i+e.length)};e.on(n.OnConversationChatEmojiSelected,function(t,e){i(":"+t.shortname+":")})}},{}],60:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){var o=t.$,a=null,s=0,c=!1;1===t.preferences.mirroring_enabled&&(a=t.require("mirror"));var u=function(e){return t.operator.barejid===e&&2===t.chat.status},l=function(e,n){t.operator.nick+"@"+t.bosh_host===n&&(t.operator.is_online=e,t.operator.barejid=n,0===e&&a&&a.disable&&a.disable())};e.on(n.OnXmppRosterUserAvailable,function(e){if(u(e))return s>0?(clearTimeout(s),void(s=0)):void(c&&(t.chat.put_dialog(t.Templates.opAlert.replace(/\{MSG\}/g,t.T("OPERATEUR_RECONNECTION")).replace(/\{TIME\}/g,t.chat.getMsgTime())),c=!1))}),e.on(n.OnXmppRosterUserUnavailable,function(e){u(e)&&(s=i.delay(function(e){s=0,r.isOnline(e)||(t.chat.put_dialog(t.Templates.opAlert.replace(/\{MSG\}/g,t.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,t.chat.getMsgTime())),o(".idz_writting").html(" "),c=!0)},1e4,e))}),e.on(n.OnXmppRosterUserUnavailable,i.partial(l,0)),e.on(n.OnXmppRosterUserAvailable,i.partial(l,1))}},{lodash:34}],61:[function(t,e,n){"use strict";e.exports={OnUploadMessage:"conversations.message.upload.received",OnProductMessage:"conversations.message.product.received",OnMessageWithMultipleChoicesMessage:"conversations.message.multiple-choices.received",OnTextMessage:"conversations.message.text.received",OnConversationChatFileSelected:"conversation.chat.file.selected",OnConversationChatUploadFilesChecked:"conversation.chat.files.checked",OnConversationChatUploadMaxSizeReached:"conversation.chat.file.maxSizeReached",OnConversationChatUploadBadMimeType:"conversation.chat.file.badMimeType",OnConversationChatUploadStarted:"conversation.chat.upload.started",OnConversationChatUploadProgress:"conversation.chat.upload.progress",OnConversationChatUploadCompleted:"conversation.chat.upload.completed",OnConversationChatUploadFailed:"conversation.chat.upload.failed",OnConversationChatUploadAborted:"conversation.chat.upload.aborted",OnConversationChatUploadInitialized:"conversation.chat.upload.initialized",OnConversationChatEmojiSelected:"conversation.chat.emoji.selected",OnConversationEmojisLoaded:"conversation.emojis.loaded"}},{}],62:[function(t,e,n){"use strict";e.exports=function(e,n,i,r){t("./richContentHandler")(n,i),t("./FileUploadHandler")(n,i),t("./InputsHandler")(e,n,i),t("./OperatorPresenceHandler")(e,n,i,r)}},{"./FileUploadHandler":58,"./InputsHandler":59,"./OperatorPresenceHandler":60,"./richContentHandler":65}],63:[function(t,e,n){"use strict";var i=function(t,e){this.url=t||"",this.name=e.name||"unknown",this.mimeType=e.type||"unknown"};i.prototype.getUrl=function(){return this.url},i.prototype.getName=function(){return this.name},i.prototype.getMimeType=function(){return this.mimeType},e.exports=i},{}],64:[function(t,e,n){"use strict";var i=function(t,e){this.url=e.productUrl||"",this.title=e.title||"",this.imageUrl=e.imageUrl||"",this.priceCatalog=e.priceCatalog||"",this.pricePromotion=e.pricePromotion||"",this.isAvailable=!!e.available};i.prototype.getUrl=function(){return this.url},i.prototype.getTitle=function(){return this.title},i.prototype.getPrice=function(){return""!==this.pricePromotion?this.pricePromotion:this.priceCatalog},i.prototype.getImage=function(){return this.imageUrl},i.prototype.getPriceOriginal=function(){return""!==this.pricePromotion?this.priceCatalog:""},i.prototype.getIsAvailable=function(){return this.isAvailable},e.exports=i},{}],65:[function(t,e,n){"use strict";var i=t("./models/file"),r=t("./models/product");e.exports=function(t,e){t.on(e.OnXmppOOBReceived,function(n,o,a,s,c,u,l){switch(s){case"upload":var d=new i(c,u);t.emit(e.OnUploadMessage,n,o,a,d,l);break;case"product":var f=new r(c,u);t.emit(e.OnProductMessage,n,o,a,f,l);break;case"message-with-multiple-choices":t.emit(e.OnMessageWithMultipleChoicesMessage,n,o,a,u,l)}})}},{"./models/file":63,"./models/product":64}],66:[function(t,e,n){"use strict";e.exports=function(e,n,i){var r=t("@iadvize/front-emojis-service")({baseUrl:e.static_url+"images/emojis",blackList:["reversed-hand-with-middle-finger-extended","registered-sign","copyright-sign","trade-mark-sign"]});return e.$.get(r.getJSONUrl("apple"),function(t){r.setEmojis("apple",t),n.emit(i.OnConversationEmojisLoaded)}),e.define("emojis-service",function(){return r}),r}},{"@iadvize/front-emojis-service":6}],67:[function(t,e,n){"use strict";var i=t("lodash").assign;e.exports=i(t("./xmpp/events"),t("./conversations/events"))},{"./conversations/events":61,"./xmpp/events":83,lodash:34}],68:[function(t,e,n){"use strict";function i(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="UploadError",this.statusCode=e}function r(t){this.stack=(new Error).stack,this.message=t||"Upload aborted",this.name="AbortUploadError"}function o(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="HttpError",this.statusCode=e}function a(t){this.stack=(new Error).stack,this.message=t||"Request aborted",this.name="AbortedRequestError"}(i.prototype=Object.create(Error.prototype)).constructor=i,(r.prototype=Object.create(Error.prototype)).constructor=r,(o.prototype=Object.create(Error.prototype)).constructor=o,(a.prototype=Object.create(Error.prototype)).constructor=a,e.exports={HttpError:o,AbortedRequestError:a,UploadError:i,AbortUploadError:r}},{}],69:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(e){var n={},r=t("./errors"),o=function(t,n,o,a){function s(t,e){return t.abort=e,t.then=i.wrap(t.then.bind(t),function(t,n,i){return s(t(n,i),e)}),t}var c=e.Deferred(),u=!1,l=i.noop;return a=a||{},o=i.assign({dataType:"json",contentType:"application/json",data:a,type:n,url:t,beforeSend:function(t,e){return l=t.abort,!u}},o),e.ajax(o).then(function(t){c.resolve(t)},function(t){var e=new r.HttpError(""+t.statusText,t.status||0);0===t.status&&"abort"===t.statusText&&(e=new r.AbortedRequestError("Aborted")),c.reject(e)}),s(c.promise(),function(){u=!0,l()})};return i.forEach(["get","post","put","delete"],function(t){n[t]=function(e,n,i){return o(e,t.toUpperCase(),n,i)}}),n}},{"./errors":68,lodash:34}],70:[function(t,e,n){"use strict";e.exports=function(e){var n=e.$,i=t("./httpService")(n);return{httpService:i,uploadService:t("./uploadService")(n,i)}}},{"./httpService":69,"./uploadService":71}],71:[function(t,e,n){"use strict";var i=t("lodash").assign;e.exports=function(e,n){var r={},o=t("./errors"),a=function(t){throw"AbortedRequestError"===t.name?new o.AbortUploadError(t.message):new o.UploadError(t.message,t.statusCode)};return r.upload=function(t,r,o,s){s=s||{};var c=i({data:t,processData:!1,contentType:t.type,cache:!1,dataType:"xml",xhr:function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){if(o){var e=parseInt(t.loaded/t.total*100,10);o(e)}},!1),t}},s);return n.put(r,c).fail(a)},r}},{"./errors":68,lodash:34}],72:[function(t,e,n){"use strict";!function(e){var n=e.require("eventManager"),i=t("./events"),r=t("./http")(e),o=t("./logmatic")(e);e.JSONStore=t("./JSONStore")(e.$,e);var a=t("./xmpp")(n,i,o,e,r.uploadService),s=t("./emojis")(e,n,i);t("./conversations")(e,n,i,a.roster),t("./templates")(n,i,e,s),t("./Util")(window,e)}(iAdvize)},{"./JSONStore":54,"./Util":57,"./conversations":62,"./emojis":66,"./events":67,"./http":70,"./logmatic":73,"./templates":76,"./xmpp":91}],73:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t){function e(e,n,i,a){if(!t.PROD)return console.error(n,e,i,a);r.push({desc:e,err:JSON.stringify(n),msg:i,extras:JSON.stringify(a)}),o()}function n(e,n,i){if(!t.PROD)return console.log(e,n,i);r.push({desc:e,msg:n,extras:JSON.stringify(i)}),o()}var r=[],o=i.debounce(function(){t.$.ajax({type:"POST",contentType:"application/json; charset=UTF-8",url:t.chaturl+"rpc/mail_error.php",data:JSON.stringify(r),processData:!1,complete:function(){}}),r=[]},15e3,{leading:!1,trailing:!0});return t.define("logger",function(){return{error:e,info:n}}),{error:e,info:n}}},{lodash:34}],74:[function(t,e,n){var i=iAdvize,r=i.require("eventManager"),o={record:function(t,e){try{if("gtm"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN){var n=i.preferences.plugins.GOOGLEANALYTICS_GTM_NAME;window[n].push({category:"iAdvize",action:t,label:e,event:"iAdvize"})}"ga"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN&&_gaq.push(["_trackEvent","iAdvize",t,e]),"gau"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN&&ga("send","event","iAdvize",t,e)}catch(t){}},handleEvents:function(){r.on("conversation.call.started",function(){o.record("Call",i.c2coperator.pseudo)}),r.on("conversation.chat.started",function(){o.record("Chat",i.operator.pseudo)}),r.on("conversation.video.started",function(){o.record("Video",i.operator.pseudo)})}};o.handleEvents(),e.exports=o},{}],75:[function(t,e,n){var i={},r=iAdvize,o=r.$;n.setParam=function(t,e){i[t]=e},n.find=function(t,e){t=t||{};var a={findop:r.website_id,u:r.vuid,dep:r.forceDep,s:r.chat.status,o:r.forceAgent||0};o.extend(a,t,i);var s=e||o.Deferred();return document.visibilityState&&"hidden"===document.visibilityState?(setTimeout(function(){n.find(t,s)},1e3),s.promise()):(o.getJSON(r.chaturl+"rpc/"+iAdvize.pollingEndPoint+"?callback=?",a).done(r.findOpCallback).done(s.resolve).fail(function(){setTimeout(function(){n.find(t,s)},1e4)}),s.promise())};var a=0;n.oldPolling=function(){return n.find().done(function(){clearTimeout(a),a=setTimeout(function(){n.oldPolling()},3e4)})},r.AvailableOp=n},{}],76:[function(t,e,n){"use strict";e.exports=function(e,n,i,r){return{renderingController:t("./renderingController.js")(e,n,i,r)}}},{"./renderingController.js":77}],77:[function(t,e,n){"use strict";var i=t("filesize");e.exports=function(t,e,n,r){var o=function(t){return t.length>29&&(t=t.substring(0,18-"...".length)+"..."+t.substring(t.length-11,t.length)),t},a=function(){if(n.Templates&&n.Templates.emojis){if(0!==n.$(".idzEmojisPopupToggler").length||0===Object.keys(r.getEmojis("apple",!1)).length)return;if(!n.$("#idz_msgmsg").length)return;var i=!1,o=r.getEmojis("apple",!0),a=r.getIcons(),s=n.$("#idz_chatglobal"),c=n.Templates.emojis.getEmojisPopupDOM(),u=c.find(".idzFloatingPopupArrow"),l=c.find(".idzEmojisList"),d=c.find(".idzEmojisCategories"),f=n.Templates.emojis.getTogglerDOM();for(var h in a){var p=o[h].fullName,g=o[h].emojis,m=n.Templates.emojis.getEmojisCategoryDOM(p,h),v=n.Templates.emojis.getCategoryTabDOM(h,a[h]);for(var _ in g){var b=n.Templates.emojis.getEmojiDOM(g[_].shortname);m.find(".idzEmojisCategoryEmojis").append(b),"noRecent"!==g[_].shortname&&b.on("click",function(i){var r=n.$(this).data("emoji");t.emit(e.OnConversationChatEmojiSelected,r,i),f.click()}).data("emoji",g[_])}v.on("click",function(t){var e=n.$(this).data("category");l.animate({scrollTop:n.$('.idzEmojisCategory[data-category="'+e+'"]').get(0).offsetTop},500),t.preventDefault()}),c.find(".idzEmojisList").append(m),d.append(v)}var y=d.find(".idzEmojiCategoryChar"),w=l.find(".idzEmojisCategory");y.first().addClass("selected"),l.on("scroll",function(t){var e=parseInt(l.css("padding-top"),10),i=l.get(0).scrollTop+e+1;n.$(".idzEmojiCategoryChar").removeClass("selected");for(var r=0;r<w.length;r++){var o=w[r],a={top:o.offsetTop,bottom:o.offsetTop+o.offsetHeight};i>a.top&&i<a.bottom&&n.$(y[r]).addClass("selected")}t.stopPropagation()});var S=n.$("#idz_chat_actions"),T=n.$("#idz_msgmsg");f.on("click",function(t){i=!i;var e=s.get(0).getBoundingClientRect(),r=n.$(this).get(0).getBoundingClientRect(),o=Math.abs(e.top-r.top),a=Math.abs(e.left-r.left),l=o-c.height()-10,d=e.width-c.width();c.css({bottom:"auto",right:"auto",left:d,top:l}).toggleClass("opened"),u.css({left:a-d+2}),f.toggleClass("active"),t.stopPropagation()}),s.append(c),S.prepend(f);var O=S.width();T.css({paddingRight:O,width:T.get(0).offsetWidth-O}),c.find(".idzEmojiChar").css("background-image","url("+r.getSpriteUrl("apple")+")"),n.$(document).on("click.emojis",function(t){var e=c.get(0);e&&e.contains(t.target)||!i||(t.stopPropagation(),t.preventDefault(),f.click())})}};t.on(e.OnUploadMessage,function(t,e,i,r,o){if(n.Templates.upload&&n.Templates.upload.getUploadedFileDOM){var a="",s=i||n.chat.getMsgTime();switch(e){case"operator":n.operator&&n.operator.pseudo&&(a=n.operator.pseudo);break;case"visitor":a=n.T("VOUS")}var c=n.Templates.upload.getUploadedFileDOM(a,e,s,r.getName(),r.getMimeType(),r.getUrl());c.attr("data-id",t),o?o.append(c):n.chat.putOpFile(t,c)}else n.chat.putOpMsg(t,r.getUrl(),0)}),t.on(e.OnTextMessage,function(t,e,i,r,o){switch(e){case"operator":n.chat.putOpMsg(t,r,0)}}),t.on(e.OnProductMessage,function(t,e,i,r,o){var a=i||n.chat.getMsgTime(),s="";switch(e){case"operator":n.operator&&n.operator.pseudo&&(s=n.operator.pseudo)}if(n.Templates.products&&n.Templates.products.getProductDOM){var c=n.Templates.products.getProductDOM(r.getImage(),r.getTitle(),r.getPrice(),r.getPriceOriginal(),r.getIsAvailable(),r.getUrl(),s,a,n.T("chatbox.products.link_label"));o?o.append(c):n.chat.putOpProduct(t,c)}else""!=r.getUrl()&&n.chat.putOpMsg(t,r.getUrl(),0)}),t.on(e.OnMessageWithMultipleChoicesMessage,function(t,e,i,r,o){var a=i||n.chat.getMsgTime(),s=n.operator.pseudo?n.operator.pseudo+" : ":"";if(n.Templates.messageWithMultipleChoices&&n.Templates.messageWithMultipleChoices.getDOM){var c=n.Templates.messageWithMultipleChoices.getDOM(r.message,r.choices,a,s,n.chat.getOperatorAvatarUrl());n.chat.putOpMessageWithMultipleChoices(t,c,o)}}),t.on(e.OnConversationChatUploadMaxSizeReached,function(t,e){var r=n.T("livechat.conversations.upload.fileTooBig").replace("%maxSize%",i(t)).replace("%fileName%",e.name),o=n.Templates.upload.getUploadErrorMessageDOM(r);n.chat.putOpFile("error",o)}),t.on(e.OnConversationChatUploadBadMimeType,function(t){var e=t.name+": "+n.T("livechat.conversations.upload.badType"),i=n.Templates.upload.getUploadErrorMessageDOM(e);n.chat.putOpFile("error",i)}),t.on(e.OnConversationChatUploadStarted,function(t,e){var i=n.Templates.upload.getUploadProgressDOM(o(t.name),e);n.chat.putOpFile(e,i)}),t.on(e.OnConversationChatUploadProgress,function(t,e){n.$('.idz_upload[data-id="'+e+'"]').find(".idz_progress").css("width",t+"%")}),t.on(e.OnConversationChatUploadCompleted,function(t){n.$('.idz_upload[data-id="'+t+'"]').remove()}),t.on(e.OnConversationChatUploadFailed,function(t,e){n.$('.idz_upload[data-id="'+t+'"]').addClass("idz_upload_error").html(e)}),t.on(e.OnConversationChatUploadInitialized,function(){if(n.Templates.hasUpload&&n.Templates.upload&&n.Templates.dragNDrop){var i=n.$("#idz_chatbox").find(".chatboxDropZoneContainer"),r=function(){n.$(window).focus(),i.removeClass("displayed"),i.find(".chatboxDropZone").removeClass("active")},o=n.Templates.dragNDrop.getDropZone();o.on("dragenter dragover",function(){var t=n.$(this).addClass("active").find("img");t.attr("src",t.data("src-on"))}).on("dragleave",function(){var t=n.$(this).removeClass("active").find("img");t.attr("src",t.data("src-off"))}),o.find("input").on("change",function(i){t.emit(e.OnConversationChatFileSelected,i),n.$(this).val(""),r()}),o.find(".chatFileUploader").on("click",function(t){n.$(t.target).find("input").click()});var a=o.find("img");a.attr("src",a.data("src-off")),n.$(window).on("dragenter",function(){n.$(window).focus(),i.addClass("displayed")}),n.$(window).on("mouseleave",r),i.append(o)}}),t.on(e.OnXmppConnectionConnected,a),t.on(e.OnConversationEmojisLoaded,a)}},{filesize:20}],78:[function(t,e,n){"use strict";e.exports=function(t){var e=[];return{get:function(){var n=t.Deferred();return e.push(n),n.promise()},reject:function(t){e.map(function(e){e.reject(t)}),e=[]},resolve:function(){var t=arguments;e.map(function(e){e.resolve.apply(e,t)}),e=[]}}}},{}],79:[function(t,e,n){e.exports=function(t){var e=t.split(" ");this.name=e.shift().substr(1),this.param1=e.shift()||"",this.param2=e.join(" ")}},{}],80:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=t("lodash");e.exports=function t(e){i(this,t),this.name="",this.barejid="",this.resources=[],r.assign(this,e)}},{lodash:34}],81:[function(t,e,n){function i(t){r.call(this,t);var e=this,n=o(t),i=n.find("error");this.text=i.length?i.find("text").text():[],this.fromUsername=(n.attr("from")||"").split("@")[0],this.code=parseInt(i.attr("code"),10),this.retry=0,o.each(n.find("x"),function(t,n){"https://iadvize.com/schemas/retry"===n.getAttribute("xmlns")&&(e.retry=parseInt(n.getAttribute("retry"),10))})}var r=t("./Message"),o=iAdvize.$;i.prototype=r.prototype,i.constructor=i,i.prototype.canRetry=function(){return this.retry<3},e.exports=i},{"./Message":82}],82:[function(t,e,n){function i(t){var e=o(t);this.raw=e,this.id=e.attr("id")||null,this.to=e.attr("to"),this.from=e.attr("from").toLowerCase(),this.barejid=Strophe.getBareJidFromJid(this.from),this.type=e.attr("type"),this.bodies=e.find("body"),this.body=this.bodies.length?Strophe.xmlunescape(Strophe.getText(this.bodies[0])):"",this.x=e.find("x")}var r=t("./Command"),o=iAdvize.$;i.prototype={isChat:function(){return("chat"===this.type||"groupchat"===this.type)&&this.bodies.length>0&&!this.isCommand()},isCommand:function(){return 0===this.body.indexOf("!")},getCommand:function(){return this.command||(this.command=new r(this.body))}},e.exports=i},{"./Command":79}],83:[function(t,e,n){"use strict";e.exports={OnXmppConnectionConnected:"xmpp.connection.connected",OnXmppConnectionDisconnected:"xmpp.connection.disconnected",OnXmppReconnectionFailed:"xmpp.reconnection.failed",OnXmppRoomInvitation:"xmpp.room.invited",OnXmppRoomJoined:"xmpp.room.joined",OnXmppOOBReceived:"xmpp.message.oob.received",OnXmppRosterUserAvailable:"xmpp.roster.user.available",OnXmppRosterUserUnavailable:"xmpp.roster.user.unavailable"}},{}],84:[function(t,e,n){"use strict";var i=t("@iadvize/strophe.js");window.Strophe=i.Strophe,window.$build=i.$build,window.$iq=i.$iq,window.$msg=i.$msg,window.$pres=i.$pres,t("@iadvize/strophe-muc"),t("@iadvize/strophe-receipts"),t("@iadvize/strophe-http-file-upload")(window.Strophe),t("@iadvize/strophe-outofband")(window.Strophe);var r=t("lodash");e.exports=function(t,e,n,i,o,a,s,c){var u=i.$,l=0,d=0,f=!1,h=!1,p=function(){return r.isObject(window.WebSocket)&&i.ws_enabled},g=function(){return p()&&!f?i.ws_url:i.bosh_url},m=new Strophe.Connection(g()),v=!1,_=null,b=null,y={},w={jid:null,nick:null},S=function(n){if(m.connected||v)return _.promise();_=_&&"pending"===_.state()?_:u.Deferred(),v=!0;var r={website_id:iAdvize.website_id,vuid:iAdvize.vuid};return i.popout&&(r.pop=1),u.ajax(i.chaturl+"api/connect?callback=?",{data:r,dataType:"json",timeout:5e3}).done(function(n){var i=n.nick,r=n.pass,o=n.vhost;if(""===i||""===r||""===o)return _.reject("Unable to retrieve valid credentials");m.connect(i+"@"+o+"/"+ +new Date,r,function(n){return n===Strophe.Status.ATTACHED||n===Strophe.Status.CONNECTED?(!p()||h||f||(h=!0),t.emit(e.OnXmppConnectionConnected)):n===Strophe.Status.DISCONNECTED&&t.emit(e.OnXmppConnectionDisconnected),!0})}).fail(function(){n?t.emit(e.OnXmppConnectionDisconnected):_.reject("Error while retrieving credentials")}),_.promise()},T=function(t){return function(e){var n=new s(e);return c.error("livechat.xmpp.stanza.error".replace("stanza",t),Strophe.serialize(e),n.text,{id:e.id,code:parseInt(n.code,10),rooms:m.muc.roomNames,conversationId:n.fromUsername}),!0}},O=function(t){var e=new s(t);return e.from!==i.conversationJid||406!==e.code&&404!==e.code||M(e),!0},C=function(t){var e=new s(t);return n.reject(e),e.from!==i.conversationJid||406!=e.code&&404!=e.code||!w.jid||A(w.jid,w.nick,0).catch(function(){}),!0},x=function(t){var e=new o(t);if(e.x.length>0&&"jabber:x:delay"===e.x[0].getAttribute("xmlns"))return!0;try{e.isChat()?i.chat.onMessage(e):e.isCommand()&&i.chat.onCommand(e)}catch(t){c.error("livechat.xmpp.handler.onMessage",t,e)}return!0},E=function(t){var e=u(t).attr("from").toLowerCase(),n=Strophe.getResourceFromJid(e),r=t.childNodes[0].localName;return i.chat.onChatStates(n,r),!0},A=function(i,r,o){var a=n.get(),s={seconds:o||0};w.jid=i,w.nick=r;return m.muc.join(i,r,null,null,null,null,s),m.muc.rooms[i].addHandler("presence",function(r){if(!r)return!0;var o=u(r).find("status"),a=u.map(o,function(t){return parseInt(u(t).attr("code"),10)});return!(-1!==u.inArray(110,a))||(t.emit(e.OnXmppRoomJoined),n.resolve(i),z(i),!1)}),a},I=function(t){D();var e=m.muc.roomNames.indexOf(t);delete m.muc[t],e>=0&&(m.muc.roomNames.splice(e,1),0===m.muc.roomNames.length&&(m.deleteHandler(m.muc._muc_handler),m.muc._muc_handler=null))},R=function(t){var e=u.Deferred();if(y[t.id]&&y[t.id].reject("desk.publish.error.outside",t,e.promise()),!t.canRetry())return c.error("livechat.xmpp.retry.error",t,"Max retry reached",{code:parseInt(t.code,10),rooms:m.muc.roomNames,conversationId:t.fromUsername}),e.reject("desk.publish.error.retry.max",t);var n=$msg({to:t.from,from:m.jid,type:"groupchat",id:t.id}).c("body").t(t.body).up();n.c("x",{xmlns:"https://iadvize.com/schemas/retry",retry:t.retry+1});var i=+new Date;return m.muc.rooms[t.from].addHandler("message",N(e,t.id,i,t)),m.send(n),y[t.id]=e,e.promise()},N=function(t,e,n,i){return function(o){var a=u(o).attr("id"),s=+new Date;if(a===e){i&&c.info("livechat.xmpp.retry.success","Successfully retried "+i.id,r.merge(i,{conversationId:i.fromUsername}));var l=s-n;return c.info("livechat.xmpp.message.latency","Successfully delivered in "+l+" ms",{id:e,latency:l}),t.resolve(e),!1}return!0}},M=function t(e){if(w.jid){I(e.from);var n=A(w.jid,w.nick,0);e.body&&n.done(function(){if(e.body)return R(e)}).fail(function(){t(e)})}},k=function(t){var e=new o(t);return i.chat.onMessageReceipt(e),!0},j=function(t){var e=m.getUniqueId(),n=$msg({to:t,from:m.jid,type:"groupchat",id:e}).c("ping",{xmlns:"urn:xmpp:ping"});n.up(),m.send(n)},D=function(){clearInterval(b)},z=function(t){D(),b=setInterval(function(){j(t)},6e4)};return t.on(e.OnXmppConnectionDisconnected,function(){if(v=!1,i.chat.connected=!1,++l>=5){if(p()&&(f||h)||!p())return t.emit(e.OnXmppReconnectionFailed),_.reject();f=!0,l=1,m.reset(),m=new Strophe.Connection(g())}clearTimeout(d),d=setTimeout(function(){S(!0)},l>1?3e3:2300)}),t.on(e.OnXmppConnectionConnected,function(){v=!1,_.resolve(),i.chat.connected=!0,m.addHandler(x,null,"message","chat"),m.addHandler(x,null,"message","groupchat"),m.addHandler(x,null,"message","command"),m.addHandler(T("presence"),null,"presence","error"),m.addHandler(T("message"),null,"message","error"),m.addHandler(O,null,"message","error"),m.addHandler(C,null,"presence","error"),m.addHandler(E,"http://jabber.org/protocol/chatstates","message","groupchat"),m.receipts.addReceiptHandler(k),l=0}),{sendChatState:function(t){m.connected&&m.send&&m.send($msg({to:i.conversationJid,from:m.jid,type:"groupchat",website:i.website_id}).c(t).attrs({xmlns:"http://jabber.org/protocol/chatstates"}))},getConnection:function(){return m},connect:S,room:{groupchat:function(t,e){var n=u.Deferred(),i=e||m.getUniqueId(),r=function(){var e=+new Date;m.muc.rooms[w.jid].addHandler("message",N(n,i,e)),m.muc.groupchat(w.jid,t,null,i)};return y[i]=n,m.muc.rooms[w.jid]?r():A(w.jid,w.nick,0).always(r),n.promise()},leave:function(t,e){D(),m.muc.leave(t,e),w.jid=w.nick=null},join:A}}}},{"@iadvize/strophe-http-file-upload":9,"@iadvize/strophe-muc":10,"@iadvize/strophe-outofband":11,"@iadvize/strophe-receipts":12,"@iadvize/strophe.js":13,lodash:34}],85:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){var o=n.$;return r().addHandler(function(t){return!0},Strophe.NS.MUC_USER,"message",null),{sendEngage:function(t,e,n,a,s,c,u){var l=o.Deferred(),d="!visitor_engage "+(e||""),f={id:t||r().getUniqueId(),to:a+"/operators",from:r().jid,type:"chat",website:s,history:c,channel:u||"chat",conversationJid:n},h=$msg(f).c("body").t(d).up().c("active",{xmlns:"http://jabber.org/protocol/chatstates"});return r().receipts.sendMessage(h,i.partial(l.resolve,t),l.reject),l.promise()}}}},{lodash:34}],86:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){function a(t){try{var e={},n=t.childNodes[0].childNodes;return e[n[0].tagName]=n[0].textContent,e[n[1].tagName]=n[1].textContent,e.id=c(t).attr("id"),e}catch(t){throw new u(t.message)}}var s=iAdvize,c=s.$,u=t("./XmppSlotParseError"),l=t("./XmppUploadError"),d={};i().outofband.addOutOfBandHandler(function(t){var r=c(t),o=r.attr("id"),a=r.attr("from"),s=r.find("url").text(),u=r.find("desc").text();try{var l=JSON.parse(u),d=l.type,f=l.data;e.emit(n.OnXmppOOBReceived,o,"operator",null,d,s,f),i().send($iq({type:"result",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND}))}catch(t){e.emit(n.OnTextMessage,o,"operator",s),i().send($iq({type:"error",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND})),console.error(t)}return!0},"set"),e.on(n.OnConversationChatUploadFilesChecked,function(t){var c=t.name+0;e.emit(n.OnConversationChatUploadStarted,t,c),i().fileupload.requestSlot({name:o+"/"+t.name,size:t.size,contentType:t.type},function(o){var u=a(o);d[c]=r.upload(t,u.put,function(t){e.emit(n.OnConversationChatUploadProgress,t,c)}).then(function(){var r={type:"upload",data:{url:u.get,type:t.type,name:t.name}},o=JSON.stringify(r);e.emit(n.OnConversationChatUploadCompleted,c),e.emit(n.OnXmppOOBReceived,u.id,"visitor",null,"upload",u.get,r.data),i().outofband.sendUrl(iAdvize.operator.barejid+"/operators",u.get,o),s.chat.updateHistory(s.chat.MESSAGE_TYPES.VISITOR_RICH_CONTENT,JSON.stringify(r),u.id)}).catch(function(t){var i=s.T("livechat.conversations.upload.error");"AbortUploadError"===t.name&&(i=s.T("livechat.conversations.upload.abort")),e.emit(n.OnConversationChatUploadFailed,c,i)})},function(t){throw e.emit(n.OnConversationChatUploadFailed,c,s.T("livechat.conversations.upload.error")),new l(t.message)},1e4)}),e.on(n.OnConversationChatUploadAborted,function(t){d[t]&&d[t].abort()})}},{"./XmppSlotParseError":89,"./XmppUploadError":90}],87:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){var r=n.$;i().addHandler(function(t){var e=r(t).attr("from"),n=Strophe.getBareJidFromJid(e);return i().send($pres({to:n,type:"subscribed"})),i().send($pres({to:n,type:"subscribe"})),!0},Strophe.NS.CLIENT,"presence","subscribe",null,null),i().addHandler(function(t){var e=r(t).attr("from"),n=Strophe.getBareJidFromJid(e);return i().send($pres({to:n,type:"unsubscribed"})),i().send($pres({to:n,type:"unsubscribe"})),!0},Strophe.NS.CLIENT,"presence","unsubscribe",null,null)}},{}],88:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r,o){var a=n.$,s=[],c=function(t){return i.find(s,function(e){return e.barejid===t})};return r().addHandler(function(t){var e=a(t).find("item");return i.forEach(e,function(t){var e=a(t).attr("jid"),n=Strophe.getBareJidFromJid(e);"from"===a(t).attr("subscription")&&s.push(new o({barejid:n}))}),r().send($iq({type:"result",id:a(t).attr("id")})),!0},Strophe.NS.ROSTER,"iq","set"),r().addHandler(function(t){var e=a(t).attr("from"),n=Strophe.getBareJidFromJid(e);return i.remove(s,function(t){return t.barejid===n}),!0},Strophe.NS.CLIENT,"presence","unsubscribe",null,null),r().addHandler(function(n){var r=a(n).attr("type");if(i.includes.unsubscribe,r)return!0;var o=a(n).attr("from"),s=Strophe.getBareJidFromJid(o),u=Strophe.getResourceFromJid(o),l=c(s);return!l||(0===l.resources.length&&t.emit(e.OnXmppRosterUserAvailable,s),l.resources.push(u),!0)},Strophe.NS.CLIENT,"presence",null,null,null),r().addHandler(function(n){var r=a(n).attr("from"),o=Strophe.getBareJidFromJid(r),s=Strophe.getResourceFromJid(r),u=c(o);return!u||(i.remove(u.resources,function(t){return s===t}),0===u.resources.length&&t.emit(e.OnXmppRosterUserUnavailable,o),!0)},Strophe.NS.CLIENT,"presence","unavailable",null,null),t.on(e.OnXmppConnectionConnected,function(){r().sendIQ($iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER}),function(t){var e=a(t).find("item");s=i.filter(e,function(t){return"both"===a(t).attr("subscription")}).map(function(t){var e=a(t).attr("jid"),n=Strophe.getBareJidFromJid(e);return new o({barejid:n})}),i.filter(e,function(t){return"from"===a(t).attr("subscription")&&"subscribe"!==a(t).attr("ask")}).forEach(function(t){var e=a(t).attr("jid");r().send($pres({to:e,type:"subscribe"}))}),n.doInit()})}),{isOnline:function(t){var e=c(t);return!!e&&e.resources.length>0}}}},{lodash:34}],89:[function(t,e,n){"use strict";function i(t){this.stack=(new Error).stack,this.message=t||"Failed to get an upload slot from Xmpp server",this.name="XmppSlotParseError"}(i.prototype=Object.create(Error.prototype)).constructor=i,e.exports=i},{}],90:[function(t,e,n){"use strict";function i(t){this.stack=(new Error).stack,this.message=t||"Failed to upload file",this.name="XmppUploadError"}(i.prototype=Object.create(Error.prototype)).constructor=i,e.exports=i},{}],91:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){var a=t("./domain/Contact"),s=t("./domain/Command"),c=t("./domain/Message"),u=t("./domain/Error"),l=new(t("./DeferredManager"))(r.$),d=t("./handlers/ConnectionHandler")(e,n,l,r,c,s,u,i);t("./handlers/OutOfBandHandler")(e,n,d.getConnection,o,r.website_id),t("./handlers/PresenceHandler")(e,n,r,d.getConnection);var f=t("./handlers/RosterHandler")(e,n,r,d.getConnection,a),h=t("./handlers/InvitationHandler")(e,n,r,d.getConnection);return r.define("xmpp",function(){return{invitation:h,connect:d.connect,getConnection:d.getConnection,sendChatState:d.sendChatState,room:d.room,isOnline:f.isOnline}}),{invitation:h,connection:d,roster:f}}},{"./DeferredManager":78,"./domain/Command":79,"./domain/Contact":80,"./domain/Error":81,"./domain/Message":82,"./handlers/ConnectionHandler":84,"./handlers/InvitationHandler":85,"./handlers/OutOfBandHandler":86,"./handlers/PresenceHandler":87,"./handlers/RosterHandler":88}],92:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){return t&&t.__esModule?t:{default:t}}(t("./messengerTagService"));n.default=function(t,e,n){var r=n.social_notification_customer_id||n.extID||n.ExtID,o=(0,i.default)(t,e.visitor.locale,e.secure_url+"rpc/",e.social.facebook.messenger.appId,r);return e.social.facebook.messenger.renderButton=o.renderButton,o}},{"./messengerTagService":93}],93:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.default=function(t,e,n,s,c){function u(t){FB.init({appId:t||s,xfbml:!0,version:"v2.10"}),g.resolve()}function l(t){if("undefined"!=typeof FB)u(t);else if(!p){var n=e.replace("-","_"),i=void 0;(i=n.match(/([a-z]{2}$)/))&&(n=n.replace(/([a-z]{2}$)/,i[0].toUpperCase()));var o=window.fbAsyncInit||r.noop;window.fbAsyncInit=function(){o.call(this,arguments),u(t)},function(t,e,i){var r=t.getElementsByTagName(e)[0];if(!t.getElementById(i)){p=!0;var o=t.createElement(e);o.id=i,o.src="//connect.facebook.net/"+n+"/sdk/xfbml.customerchat.js",r.parentNode.insertBefore(o,r)}}(document,"script","idz-facebook-jssdk")}}function d(t){if(!(t&&t instanceof Element))throw new Error("Facebook element is not defined or invalid");g.isResolved()?FB.XFBML.parse(t):l()}function f(e,n,i){if(0===t(e).children(".idz_social_facebook_messenger_button").length){var r=t(n);r.attr(i),t(e).each(function(e,n){var i=t(n),o=r.clone();o.attr("user_ref")&&(o.attr("user_ref",o.attr("user_ref")+e),i.parents().andSelf().filter("form").each(function(e,n){t(n).one("submit",function(){return o.get(0).onsubmit()})})),i.append(o),d(o.get(0))})}}function h(e,i,r){if(!e)return t.Deferred().reject(new Error("Page id isn't defined"));if(!i)return t.Deferred().reject(new Error("Customer id isn't defined"));var o=a[r];if(!o)return t.Deferred().reject(new Error("Unsupported request for button type"));var s=n+"social/facebook/messenger/pages/%PAGE_ID%/customers/%CUSTOMER_ID%/buttons/%BUTTON_URI%".replace("%PAGE_ID%",e).replace("%CUSTOMER_ID%",i).replace("%BUTTON_URI%",o);return t.ajax({url:s,type:"GET",crossDomain:!0})}var p=!1,g=new t.Deferred;return g.isResolved=function(){return"resolved"===this.state},{renderButton:function(e,n,a,u,l,d,p){u=!u||u instanceof Object?c:u;var g=Array.prototype.slice.call(arguments);p=g[g.length-1]instanceof Function?g.pop():function(){};var m=t.extend({color:"string"==typeof l?l:"blue",size:"string"==typeof d?d:"large"},"object"===i(g[g.length-1])?g.pop():{});if(o[n]){var v=o[n].replace(/%APP_ID%/g,s).replace(/%PAGE_ID%/g,a).replace(/%ORIGIN%/g,window.location.origin);-1!==v.indexOf("%STATE_VALUE%")?h(a,u,n).done(function(t){"object"===(void 0===t?"undefined":i(t))&&t.state&&t.userRef?(v=v.replace(/%STATE_VALUE%/g,t.state).replace(/%USER_REF%/g,t.userRef),f(e,v,m),p(null,t.alreadyOptin)):p(new Error("Error while getting messenger button state"))}).fail(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=(0,r.find)(e,function(t){return t instanceof Error});p(i||new Error("An error occured while building messenger button"))}):(f(e,v,m),p())}else p(new Error("The messenger button type does not exist"))},renderTagElement:d}};var r=t("lodash"),o={"fb-send-to-messenger":'<div class="fb-send-to-messenger idz_social_facebook_messenger_button" messenger_app_id="%APP_ID%" page_id="%PAGE_ID%" data-ref="%STATE_VALUE%"></div>',"fb-messenger-checkbox":"<div class=\"fb-messenger-checkbox idz_social_facebook_messenger_button\" origin=\"%ORIGIN%\" page_id=\"%PAGE_ID%\" messenger_app_id=\"%APP_ID%\" data-ref=\"%STATE_VALUE%\" user_ref=\"%USER_REF%\" prechecked=\"false\" allow_login=\"true\" onsubmit=\"FB.AppEvents.logEvent('MessengerCheckboxUserConfirmation', null, {'app_id':'%APP_ID%', 'page_id':'%PAGE_ID%', 'ref':'%STATE_VALUE%', 'user_ref':iAdvize.$(this).attr('user_ref')})\"></div>","fb-messengermessageus":'<div class="fb-messengermessageus idz_social_facebook_messenger_button" messenger_app_id="%APP_ID%" page_id="%PAGE_ID%"></div>'},a={"fb-send-to-messenger":"sendToMessenger","fb-messenger-checkbox":"checkbox"}},{lodash:34}],94:[function(t,e,n){var i=t("ua-parser-js"),r=t("lodash"),o=(new i).getResult();e.exports=function(t){return{browser:r.get(o,"browser.name")||"unknown",version:parseInt(r.get(o,"browser.major"))||"unknown",OS:r.get(o,"os.name")||"unknown",deviceType:function(e){return e===i.DEVICE.MOBILE?t.MOBILE:e===i.DEVICE.TABLET?t.TABLET:t.DESKTOP}(r.get(o,"device.type"))}}},{lodash:34,"ua-parser-js":37}],95:[function(e,n,i){!function(e){var n=[],i=!1,r=!1,o=function(){!function(){for(var t=n.length,e=0;e<t;e++){var o=n[e][1]();n[e][0]!==o&&(n[e][0]=o,n[e][2](o))}r?i=!1:setTimeout(arguments.callee,850)}(),i=!0},a={add:function(e,a,s){for(var c in n)if(n[c][3]==s)return;var u=[t,e,a,s];n.push(u),!1===i&&(r=!1,o())},start:function(){r=!1,!1===i&&o()},clear:function(){n=[],r=!0},stop:function(){r=!0}};e.Watcher=a}(iAdvize)},{}],96:[function(t,e,n){function i(t){return o[t]instanceof r||(o[t]=new r(t)),o[t]}var r=t("./model/channel"),o={};n.chat=i("chat"),n.call=i("call"),n.visio=i("visio"),n.all=i("all"),n.getChannel=i},{"./model/channel":106}],97:[function(t,e,n){e.exports=function(){return{MOBILE:"mobile",TABLET:"tablet",DESKTOP:"desktop"}}},{}],98:[function(t,e,n){"use strict";e.exports={TargetingLoaded:"targeting.loaded",TargetingRuleTriggered:"targeting.rule.triggered",TargetingRulePresenceUpdated:"targeting.rule.presence.updated",TargetingEngineRan:"targeting.engine.ran",UserNavigated:"used.navigated",TargetingEngineCheckAvailability:"targeting.engine.checkAvailability"}},{}],99:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(e,n){var i=t.Deferred();return l.push({targetingRuleId:e,executeApiCall:n,defer:i}),f(),i.promise()}function a(t){return o(t.rule.id,t.rule.isInAbtest()&&t.rule.hasActionRequiringDisplay(t.availability)).then(function(e){return{ruleWithAvailability:t,isVisitorAllowed:e}})}function s(t){return i.each(t.availability,function(t){t.available=!1}),t}function c(t,e){return e.isVisitorAllowed||(u(e.ruleWithAvailability),s(e.ruleWithAvailability)),t.push(e.ruleWithAvailability),t}function u(t){i.forEach(t.rule.actions,function(e){e.shouldExecute(t.availability)&&e.recordExecution()})}var l=[],d=!1,f=function i(){if(!d){var o=l.shift();if(o){d=!0;var a=o.defer,s=o.targetingRuleId;if(!o.executeApiCall)return d=!1,setTimeout(i,0),void a.resolve(!0);t.ajax({url:e+"rpc/getVisitorAbTesting.php",data:{targetingRuleId:s,vuid:n,siteId:r},method:"GET",success:function(t){a.resolve(!0===t.isVisitorAllowed)},error:function(){a.resolve(!1)},complete:function(){d=!1,setTimeout(i,0)}})}}};return{checkAbTest:function(e){var n=t.Deferred();return t.when.apply(t,i.map(e,a)).then(function(){n.resolve(i.reduce(arguments,c,[]))}),n.promise()}}}},{lodash:34}],100:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e){function n(e,n,r){var o={rule:r},a=i.find(e,{id:r.id+""});return"interaction"===r.type&&a?(o.availability=a.availability,"call"!==r.channel.type&&"all"!==r.channel.type||(o.availability.call.available=o.availability.call.available||t.callOffline.enabled&&t.callOffline.available),n.push(o)):"qualification"===r.type&&n.push(o),n}function r(t,e){return i.reduce(t,i.partial(n,e),[])}return{getRulesAvailabilities:function(t){var n=i.filter(t,{type:"interaction"});return e.checkRulesAvailability(n).then(i.partial(r,t))},reduceRulesToAvailabilities:r}}},{lodash:34}],101:[function(e,n,i){"use strict";var r=function(){function e(e,n){var i=[],r=!0,o=!1,a=t;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(i.push(s.value),!n||i.length!==n);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}return i}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("lodash");n.exports=function(t,e,n){function i(e){t.opOffline=e.chat.available?0:1,t.c2cOffline=e.call.available||t.callMeeting.available&&t.callMeeting.enabled?0:1,t.c2vOffline=e.video.available?0:1,t.callInstant&&(t.callInstant.available=e.call.available),t.opBusy=e.chat.busy?1:0}function a(e,a){var s=!1;e.actions.filter(function(t){return e.displayed&&t.shouldCancel(a)}).forEach(function(t){return t.cancel()});var c=o.partition(e.actions,function(t){return t.isVisible()}),u=r(c,2),l=u[0];return u[1].filter(function(t){return t.shouldExecute(a)}).forEach(function(t){return t.execute(a)}),o.chain(l).groupBy("type").map(function(t){return[o.find(t,function(t){return t.isExecuted()||t.shouldExecute(a)}),t]}).filter(function(t){var e=r(t,1)[0];return e&&e.shouldExecute(a)}).forEach(function(t){var c=r(t,2),u=c[0],l=c[1],d=l.indexOf(u);o.chain(l.slice(d+1)).filter(function(t){return t.isExecuted()}).forEach(function(t){return t.cancel()}).value(),u.isVisible()&&("interaction"===e.type&&n&&i(a),s=!0),u.execute(a)}).value(),s&&(t.callbacks.onRuleStarted({id:e.id,label:e.label}),t.flags.message=t.T("LA_REGLE")+" "+e.label+" "+t.T("VIENT_ETRE_EXECUTEE"),t.flags.proactif_alert="!proactif "+e.label,t.proactif_now=1,t.flags.proactif_activatedId=e.id,e.displayed=!0,t.ProActif.saveData()),e}function s(t,e){return o.isEmpty(t.actions)?t:a(t,e)}return{executeInteractionRules:function(t){var n=e.Deferred(),i=o.filter(t,{rule:{type:"interaction"}});return o.forEach(i,function(t){return s(t.rule,t.availability)}),n.resolve(o.map(t,"rule")),n.promise()},doActions:s}}},{lodash:34}],102:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e){function n(t){var e=t.rule,n=t.availability,i={id:e.id,type:e.type,exec:e.shouldIncrementExecutionCount()?1:0,dis:e.shouldIncrementDisplayCount(n)?1:0};return n&&(i.chatoff=n.chat.available?0:1,i.calloff=n.call.available?0:1,i.busy=n.chat.busy?1:0),i}function r(e){return{s:t.website_id,u:t.vuid,rules:i.map(e,n)}}function o(){return"ha"===t.platform&&"833"===t.website_id}function a(){return"ha"===t.platform&&155===t.client_id||"sd"===t.platform&&8925===t.client_id}var s=t.chaturl+"rpc/proactif_count.php";return{sendProactifCount:function(n){var i=e.Deferred();if(2===t.chat.status||!o()&&!a())return i.resolve(n),i.promise();var c={url:s,data:r(n),type:"post"};return e.ajax(c),i.resolve(n),i.promise()}}}},{lodash:34}],103:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(){return{chat:{available:!t.opOffline,busy:!!t.opBusy},call:{available:!t.c2cOffline},video:{available:!t.c2vOffline}}}function a(i){var o=e.Deferred();return 2!=t.chat.status&&(r||i)?(t.forceDep=i,n.find({forceDep:i}).done(function(){o.resolve()})):o.resolve(),o.promise()}function s(t){return i.map(t,function(t){var e={rule:t};return"interaction"===t.type&&(e.availability=o()),e})}function c(t){var e=i.slice(t);return i.get(i.chain(e).reverse().find(function(t){return"interaction"===t.type&&t.skill}).value(),"skill.id")}return{getRulesAvailabilities:function(t){var n=e.Deferred();return i.some(t,{type:"interaction"})?a(c(t)).then(function(){n.resolve(s(t))}):n.resolve(s(t)),n.promise()},getFirstEligibleSkillIdForRules:c}}},{lodash:34}],104:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(t){var e=t.rule,n=t.availability;return{id:e.id,isVisibleAndAvailable:e.hasActionRequiringDisplay(n),canBeDisplayed:e.hasActionRequiringDisplay(n),shouldIncrementDisplayCount:e.shouldIncrementDisplayCount(n),shouldIncrementMissedDisplayCount:e.shouldIncrementMissedDisplayCount(n),availability:n}}function a(t,e){var n=e.rule;return"qualification"===n.type?(t.qualificationRules.push(n.id),t):(n.shouldIncrementExecutionCount()&&t.interactionRules.push(o(e)),t)}function s(e){var n=i.reduce(e,a,{qualificationRules:[],interactionRules:[]});return{visitor:{id:t.vuid,websiteId:+t.website_id,sessionId:t.vStats.sessionId},qualificationRules:n.qualificationRules,interactionRules:n.interactionRules}}function c(n){var r=e.Deferred();if(!t.targetedVisitors||!t.targetedVisitors.enabled)return r.resolve([]),r.promise();var o=s(n);if(0===o.interactionRules.length&&0===o.qualificationRules.length)return r.resolve([]),r.promise();var a={url:u,data:t.util.JSONStringify(o),contentType:"application/json",processData:!1,type:"post",success:function(t){r.resolve(i.map(t.authorizedRules))},error:function(){r.resolve([])}};return e.ajax(a),r.promise()}var u=t.targetedVisitors.url+"triggered-rules?platform="+t.platform;return{getRulesOpportunities:function(o){var a=e.Deferred();return 2===t.chat.status?(a.resolve(o),a.promise()):(c(o).then(function(t){var e=i.reject(o,function(e){var o=e.rule,a=e.availability,s=i.includes(t,o.id),c=o.hasActionRequiringDisplay(a);return"interaction"!==o.type||!s&&c||n.emit(r.TargetingRulePresenceUpdated,o,a),c&&!s});a.resolve(e)}),a.promise())}}}},{lodash:34}],105:[function(t,e,n){"use strict";var i=t("lodash"),r=t("./events"),o=t("lodash.clonedeep");e.exports=function(e,n,a,s){function c(t){return!t||!e("#idzc2c").is(":visible")&&(t instanceof E||(t=new E(t)),t.executed=!0,void("qualification"===t.type?(j.doActions(t,{}),u(t)):h(t).then(u)))}function u(t){D.setRule(t.id,t),D.setStatus(t.id,"pending"),z()}function l(t){if(t)return t.executed=!1,t.displayed=!1,i.forEach(t.actions,function(t){t.cancel()}),t}function d(t){var n=e.Deferred();return C.emit(r.TargetingRuleTriggered,t),n.resolve(t),n.promise()}function f(){return!/(ip-label|WatchMouse)/.test(navigator.userAgent)}function h(t){var i=e.Deferred();return!a.hasContactOngoing()&&t.checkHash&&n.vStats.merpHash?b.find({h:n.vStats.merpHash}).done(function(e){e.merpData?(n.forceAgent=e.merpData.operatorId,0==e.opOffline?i.resolve(t):(n.setStatus(),i.reject(t))):i.reject(t)}).fail(function(){i.reject(t)}):i.resolve(t),i.promise()}function p(t){if("all"===t.type)return p(y.chat),void p(y.call);var e={chat:"",call:"c2c_",visio:"visio_"}[t.type];n.preferences["param_"+e+"connectedwidget"]=0,n.preferences["param_"+e+"noconnectedwidget"]=0,n.setStatus()}function g(t){var e=0;return"qualification"===t.type&&--e,t.channel&&"all"===t.channel.type&&++e,e}var m=t("./deviceType")(),v=t("./DeviceInformationExtractor")(m),_=t("./vStats")(n,e,v),b=t("../../livechat/src/polling"),y=t("./channels");t("./Watcher");var w={},S=t("./model/rule/condition")(n.vStats,w,n),T=window.iAdvizeCallbacks&&(window.iAdvizeCallbacks.onStatusChanged||window.iAdvizeCallbacks.onCallStatusChanged||window.iAdvizeCallbacks.onTargetingRuleTriggered),O=n.routing&&n.routing.enabled||!T,C=n.require("eventManager"),x=t("./visitor")(n.vStats,n.JSONStore),E=t("./model/rule")(n,C,y,x,a),A=t("./handlers/OldAvailabilityHandler")(n,n.$,b,O),I=!1;if(n.routing&&n.routing.enabled){var R=t("./routingService")(n,n.$,b,A.getFirstEligibleSkillIdForRules);A=t("./handlers/AvailabilityHandler")(n,R),I=!0}var N=t("./handlers/OpportunityHandler")(n,n.$,C,r),M=t("./handlers/GeniusTargetingHandler")(n,n.$),k=t("./handlers/AbTestHandler")(e,n.chaturl,n.vStats.vuid,n.vStats.site_id),j=t("./handlers/ExecutionHandler")(n,n.$,I),D={data:{rules:{},status:{}},setStatus:function(t,e){this.data.status[t]=e},getTriggeredRules:function(){var t=this.data;return i.chain(this.data.status).pickBy(function(t){return"pending"===t}).forEach(function(e,n){t.status[n]="done"}).keys().map(function(e){return t.rules[e]}).value()},setRule:function(t,e){this.data.rules[t]=e},clean:function(){this.data.rules={},this.data.status={}}};C.on("rule.action.executed.button",p);var z=i.debounce(function(){var t=D.getTriggeredRules();0!==t.length&&A.getRulesAvailabilities(t).then(k.checkAbTest).then(N.getRulesOpportunities).then(M.sendProactifCount).then(j.executeInteractionRules).then(function(t){i.some(t,"displayed")&&C.emit(r.TargetingEngineCheckAvailability),i.forEach(t,d)})},2e3),P=n.ProActif={_datas:[],vStatsI:w,run:function(t){if(!f())return!0;if(void 0!==window.idzCustomData)for(var e in idzCustomData)idzCustomData.hasOwnProperty(e)&&void 0!==idzCustomData[e]&&null!==idzCustomData[e]&&n.vStats.val(e,idzCustomData[e]);if(a.hasContactOngoing())return!0;var r=this._datas;r=t?i.filter(r,function(e){return e.id==t}):i.sortBy(r,g);for(var o=0;o<r.length;o++){var s=r[o];this.areRuleConditionsMet(s)?c(s):s.executed&&(s=l(s))}return r},reRun:function(){if(!a.hasContactOngoing()){var t=i.filter(P._datas,"displayed");i.isEmpty(t)||A.getRulesAvailabilities(t).then(j.executeInteractionRules).then(function(){C.emit(r.TargetingEngineCheckAvailability)})}},areRuleConditionsMet:function(t){var e=i.chain(t.conditions).filter("criteria").forEach(function(e){var n=e.criteria;void 0!==e.getValue()&&"merpLink"===n.field&&(t.checkHash=!0)}).map(i.partial(this.isRuleConditionMet,i,t.id)).value();return i.every(e)},isRuleConditionMet:function(t,e){if(void 0!==t.getValue()){if(t.tRefreshData instanceof Function&&t.tRefreshData(),t.isMet())return!0;t.tIsFalse instanceof Function&&t.tIsFalse(e)}return!1},fireRule:c,saveData:function(){f()&&setTimeout(function(){n.JSONStore.saveData({proactif_activated:n.flags.proactif_activated,proactif_showchatbar:n.flags.proactif_showchatbar,proactif_message:n.util.htmlspecialchars(n.flags.proactif_message),message:n.util.htmlspecialchars(n.flags.message),proactif_invit:n.flags.proactif_invit,proactif_activatedId:n.flags.proactif_activatedId,proactif_alert:n.flags.proactif_alert,phoneDisplayed:n.flags.phoneDisplayed})},400)},watchCustomData:function(t,i,r,o,a){n.Watcher.add(function(){var n=e(t).text()||e(t).val();return n&&"INTEGER"==r&&"count"!==o&&(n=parseInt(n.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),n&&"FLOAT"==r&&"count"!==o&&(n=parseFloat(n.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),n},function(t){var e=n.vStats[i],s=n.Store.get(i);if("count"!=o&&void 0===s&&(s=t),"current"==o)void 0!==t?n.vStats[i]=t:delete n.vStats[i];else if("max"==o)void 0!==t&&t>=s&&(s=t,n.Store.set(i,s)),void 0!==s&&(n.vStats[i]=s);else if(void 0!==t&&"min"==o)void 0!==t&&t<=s&&(s=t,n.Store.set(i,s)),void 0!==s&&(n.vStats[i]=s);else if("count"==o){if(a){var c=!1;"STRING"!=r&&t==a?c=!0:"STRING"==r&&void 0!==t&&-1!=t.indexOf(a)&&(c=!0),c&&(s=s||0,s++,n.Store.set(i,s))}n.vStats[i]=s||0}n.vStats[i]!=e&&setTimeout(function(){n.ProActif.run()},200)},i)},setData:function(t){t&&(this._datas=i.map(t,function(t){var e=new E(t);return e.conditions=i.map(e.targetingConditions,function(t){var e=t.targetingConditionCriteria||t.visitorAttribute;if(t.criteria=e,e&&t.visitorAttribute&&(e.field="ext_"+e.field),-1!=t.value.indexOf("IDZ_CDATA_")){t.isValCustom=!0;var n=JSON.parse(t.value.substr(10));t.valField="ext_"+n.field,t.valPath=n.path,t.valBaseType=n.basetype,t.valValType=n.valtype,""!=t.valPath&&P.watchCustomData(t.valPath,t.valField,t.valBaseType,t.valValType)}return t=S(t),e&&e.path&&""!=e.path&&P.watchCustomData(e.path,e.field,t.getBaseType(),e.valueType,e.value),t}),e}))},match:function(t){C.on(r.TargetingRuleTriggered,t)},createCondition:S};P.setData(n.proactifData),C.emit(r.TargetingLoaded,o({list:P._datas}));var L=t("./replayTargeting")(n,C,r,function(){D.clean(),i.forEach(n.ProActif._datas,function(t){"qualification"===t.type&&t.executed&&l(t)});var t=n.ProActif.run();t instanceof Array&&C.emit(r.TargetingEngineRan,t)},_);L.launch(),n.navigate=L.navigate,C.on(r.TargetingEngineCheckAvailability,i.debounce(P.reRun,3e4))}},{"../../livechat/src/polling":75,"./DeviceInformationExtractor":94,"./Watcher":95,"./channels":96,"./deviceType":97,"./events":98,"./handlers/AbTestHandler":99,"./handlers/AvailabilityHandler":100,"./handlers/ExecutionHandler":101,"./handlers/GeniusTargetingHandler":102,"./handlers/OldAvailabilityHandler":103,"./handlers/OpportunityHandler":104,"./model/rule":121,"./model/rule/condition":118,"./replayTargeting":122,"./routingService":123,"./vStats":124,"./visitor":125,lodash:34,"lodash.clonedeep":29}],106:[function(t,e,n){"use strict";function i(t){"both"===t&&(t="all"),this.type=t}var r={chat:function(t){return t.chat.available},call:function(t){return t.call.available},visio:function(t){return t.video.available},all:function(t){return r.chat(t)||r.call(t)},"social-facebook-messenger-messageUs":function(){return!0},"social-facebook-messenger-sendToMessenger":function(){return!0},"social-facebook-messenger-chatbox":function(){return!0},"social-sms-desktop":function(){return!0},"social-sms-mobile":function(){return!0},"social-whatsapp-desktop":function(){return!0},"social-whatsapp-mobile":function(){return!0},none:function(){return!1}},o={chat:function(t){return t.chat.busy},call:function(t){return t.call.busy},visio:function(t){return t.video.busy},all:function(t){return o.chat(t)||o.call(t)},none:function(){return!1}},a=i.prototype;a.isAvailable=function(t){return!!(r[this.type]||r.none)(t)},a.isBusy=function(t){return!!(o[this.type]||o.none)(t)},e.exports=i},{}],107:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("lodash"),a=function(){function t(e){i(this,t),this.executed=!1,(0,o.assign)(this,e)}return r(t,[{key:"execute",value:function(){this.executed=!0,this.recordExecution()}},{key:"recordExecution",value:function(){}},{key:"cancel",value:function(){this.executed=!1}},{key:"isAvailable",value:function(){return!0}},{key:"isExecuted",value:function(){return this.executed}},{key:"isVisible",value:function(){return this.visible}},{key:"shouldIncrementExecutionCount",value:function(){return!0}},{key:"canBeDisplayed",value:function(t){return this.isAvailable(t)&&this.isVisible()}},{key:"shouldExecute",value:function(t){return!this.isExecuted()&&this.isAvailable(t)}},{key:"shouldCancel",value:function(t){return this.isExecuted()&&!this.isAvailable(t)}}],[{key:"canHandle",value:function(t){return!1}}]),t}();a.prototype.visible=!1,n.default=a},{lodash:34}],108:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n){var i=function(i){function u(t){r(this,u);var e=o(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t));return e.channel=n.getChannel(e.data.button.type),e}return a(u,i),s(u,[{key:"isAvailable",value:function(e){var n=this.data.button;return!("call"!==n.type&&"both"!==n.type||!t.callMeeting.available||!t.callMeeting.enabled)||this.channel.isAvailable(e)}},{key:"execute",value:function(){c(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"execute",this).call(this),t.floatingWidget.switchWidget(this.data.button),e.emit("rule.action.executed.button",this.channel)}},{key:"cancel",value:function(){c(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"cancel",this).call(this),t.floatingWidget.destroy(this.data.button)}}],[{key:"canHandle",value:function(t){return"button"===t.type}}]),u}(u.default);return i.prototype.visible=!0,i}},{"./AbstractAction":107}],109:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n){var i=function(e){function i(){return r(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return a(i,e),s(i,[{key:"isAvailable",value:function(t){return n.chat.isAvailable(t)}},{key:"execute",value:function(){c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"execute",this).call(this),t.Templates.showUI()}}],[{key:"canHandle",value:function(t){return"chatbox"===t.type}}]),i}(u.default);return i.prototype.visible=!0,i}},{"./AbstractAction":107}],110:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=e("lodash"),l=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n,i){var d={chat:function(){return t.chat.onClickChatWidget()},call:function(){return t.chat.onClickC2cWidget()},video:function(){return n.emit(n.events.OnConversationVisioRequested)}},f=function(t){function l(t){r(this,l);var n=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,t));return n.channel=i.getChannel(n.data.button.type),e(n.data.button.onlineCssSelector).click(function(){return(0,u.get)(d,n.channel.type,u.noop)(),!1}),n}return a(l,t),s(l,[{key:"isAvailable",value:function(t){return this.channel.isAvailable(t)}},{key:"shouldExecute",value:function(){return!0}},{key:"shouldCancel",value:function(){return!1}},{key:"execute",value:function(t){c(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"execute",this).call(this),n.emit("rule.action.executed.button",this.channel);var i=this.data.button;e(i.onlineCssSelector).hide(),e(i.busyCssSelector).hide(),e(i.offlineCssSelector).hide(),this.isAvailable(t)?e(i.onlineCssSelector).show():this.channel.isBusy(t)?e(i.busyCssSelector).show():e(i.offlineCssSelector).show()}}],[{key:"canHandle",value:function(t){return"fixed_buttons"===t.type}}]),l}(l.default);return f.prototype.visible=!0,f}},{"./AbstractAction":107,lodash:34}],111:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n){var i=function(e){function i(){return r(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return a(i,e),s(i,[{key:"isAvailable",value:function(e){var i=this.data.invitation,r=n.getChannel(i.type);return 2!=t.chat.status&&(null==t.flags.proactif_invit||-1===t.flags.proactif_invit.indexOf(i.id))&&r.isAvailable(e)}},{key:"execute",value:function(){c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"execute",this).call(this);var e=this.data.invitation;t.chat.loadInvitation(e.id)}},{key:"recordExecution",value:function(){var e=this.data.invitation;t.flags.proactif_invit=t.flags.proactif_invit||"",t.flags.proactif_invit+=e.id+","}},{key:"shouldIncrementExecutionCount",value:function(){return null==t.flags.proactif_invit||-1===t.flags.proactif_invit.indexOf(this.data.invitation.id)}}],[{key:"canHandle",value:function(t){return"invitation"===t.type}}]),i}(u.default);return i.prototype.visible=!0,i}},{"./AbstractAction":107}],112:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n){var i=function(e){function i(){return r(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return a(i,e),s(i,[{key:"isAvailable",value:function(e){return n.chat.isAvailable(e)&&2!=t.chat.status&&null==t.flags.proactif_message&&1!=t.opBusy}},{key:"execute",value:function(){c(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"execute",this).call(this),t.chat.putOpMsg(null,this.data.text,0)}},{key:"recordExecution",value:function(){t.flags.proactif_message=t.flags.proactif_message||""}},{key:"shouldIncrementExecutionCount",value:function(){return null==t.flags.proactif_message}}],[{key:"canHandle",value:function(t){return"message"===t.type}}]),i}(u.default);return i.prototype.visible=!0,i}},{"./AbstractAction":107}],113:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t,e,n,i){var l=function(t){function u(t){r(this,u);var e=o(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t));return e.channel=n.getChannel(e.data.button.type),e}return a(u,t),s(u,[{key:"isAvailable",value:function(t){return this.channel.isAvailable(t)}},{key:"execute",value:function(){c(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"execute",this).call(this),i.getEngine("messenger").chatbox.render(this.data.button.btnpageid),e.emit("rule.action.executed.button",this.channel)}},{key:"cancel",value:function(){c(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"cancel",this).call(this),i.getEngine("messenger").chatbox.destroy()}}],[{key:"canHandle",value:function(t){return"button"===t.type&&"social-facebook-messenger-chatbox"===t.data.button.type}}]),u}(u.default);return l.prototype.visible=!0,l}},{"./AbstractAction":107}],114:[function(e,n,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function e(n,i,r){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(o===t){var a=Object.getPrototypeOf(n);return null===a?t:e(a,i,r)}if("value"in o)return o.value;var s=o.get;return s===t?t:s.call(r)},u=function(t){return t&&t.__esModule?t:{default:t}}(e("./AbstractAction"));i.default=function(t){var e=function(e){function n(){return r(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return a(n,e),s(n,[{key:"execute",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"execute",this).call(this);var e=this.data.visitorAttribute;if(e){var i=e.field,r=+t.getAttribute(i,0),o=this.visitorAttributeModifier(r,this.data.value);t.setAttribute(i,o).persist()}}}]),n}(u.default);return{IncreaseVisitorAttributeAction:function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return t+e}}],[{key:"canHandle",value:function(t){return"increase_visitor_attribute"===t.type}}]),e}(e),DecreaseVisitorAttributeAction:function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return t-e}}],[{key:"canHandle",value:function(t){return"decrease_visitor_attribute"===t.type}}]),e}(e),ModifyVisitorAttributeAction:function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"visitorAttributeModifier",value:function(t,e){return e}}],[{key:"canHandle",value:function(t){return"modify_visitor_attribute"===t.type}}]),e}(e)}}},{"./AbstractAction":107}],115:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=i(t("./VisitorAttributeActions")),o=i(t("./MessengerChatboxButtonAction")),a=i(t("./ButtonAction")),s=i(t("./InvitationAction")),c=i(t("./ChatboxAction")),u=i(t("./MessageAction")),l=i(t("./FixedButtonAction"));n.default=function(t,e,n,i,d){var f=(0,r.default)(i);return{IncreaseVisitorAttributeAction:f.IncreaseVisitorAttributeAction,DecreaseVisitorAttributeAction:f.DecreaseVisitorAttributeAction,ModifyVisitorAttributeAction:f.ModifyVisitorAttributeAction,MessengerChatboxButtonAction:(0,o.default)(t,e,n,d),ButtonAction:(0,a.default)(t,e,n),InvitationAction:(0,s.default)(t,e,n),ChatboxAction:(0,c.default)(t,e,n),MessageAction:(0,u.default)(t,e,n),FixedButtonAction:(0,l.default)(t,t.$,e,n)}}},{"./ButtonAction":108,"./ChatboxAction":109,"./FixedButtonAction":110,"./InvitationAction":111,"./MessageAction":112,"./MessengerChatboxButtonAction":113,"./VisitorAttributeActions":114}],116:[function(t,e,n){"use strict";var i=t("lodash"),r=function(t){return t&&t.__esModule?t:{default:t}}(t("./actions"));e.exports=function(t,e,n,o,a){var s=(0,r.default)(t,e,n,o,a);return function(t){var e=(0,i.find)(s,function(e){return e.canHandle(t)});if(!e)throw new Error("Unknown targeting rule action type "+t.type);return new e(t)}}},{"./actions":115,lodash:34}],117:[function(t,e,n){"use strict";var i=t("lodash"),r=t("./operators");e.exports=function(t){function e(t){i.assign(this,t),this.types=[]}return e.prototype.super=function(){return Object.getPrototypeOf(this)},e.prototype.sanitizeValue=function(t){return null===t||void 0===t?t:(""+t).toLowerCase()},e.prototype.getValue=function(){return this.sanitizeValue(t[this.criteria.field])},e.prototype.getTestValue=function(){return this.sanitizeValue(this.isValCustom?t[this.valField]:this.value)},e.prototype.isMet=function(){var t=i.get(r,this.logicalOperator);if(!t)throw new Error("The operator "+this.logicalOperator+" isn't recognized");return t(this.getValue(),this.getTestValue())},e.prototype.getType=function(){return i.last(this.types)},e.prototype.getBaseType=function(){return i.head(this.types)},e}},{"./operators":119,lodash:34}],118:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(e,n,r){var o=t("./Condition")(e),a=t("./types")(o,e,n,r);return function(t){var e=t.criteria||{},n=e.type;return e.valueType&&"count"===e.valueType&&(n="INTEGER"),new(i.get(a,n,o))(t)}}},{"./Condition":117,"./types":120,lodash:34}],119:[function(t,e,n){"use strict";var i=t("lodash");e.exports={is:function(t,e){return t==e},"is not":function(t,e){return t!=e},contains:function(t,e){return-1!==t.indexOf(e)},"not contains":function(t,e){return-1===t.indexOf(e)},"ends with":function(t,e){return i.endsWith(t,e)},"begins with":function(t,e){return i.startsWith(t,e)},regex:function(t,e){return new RegExp(e).test(t)},"not regex":function(t,e){return!new RegExp(e).test(t)},equal:function(t,e){return t==e},"less than":function(t,e){return t<e},"more than":function(t,e){return t>e},"less than or equal":function(t,e){return t<=e},"more than or equal":function(t,e){return t>=e}}},{lodash:34}],120:[function(e,n,i){"use strict";var r=e("lodash");n.exports=function(e,n,i,o){function a(n){function i(t){c.call(this,t),this.types.push(n),i.prototype.tInit instanceof Function&&i.prototype.tInit.call(this)}var o=arguments.length>1&&arguments[1]!==t?arguments[1]:{},a=arguments.length>2&&arguments[2]!==t?arguments[2]:null,c=r.get(s,a,e);i.prototype=r.create(c.prototype,o),i.prototype.constructor=i,s[n]=i}var s={};return a("BOOL",{sanitizeValue:function(t){return r.isString(t)?"true"===t||"1"===t:!!t}}),a("INTEGER",{sanitizeValue:function(t){return null===t||void 0===t?t:parseInt(t,10)}}),a("FLOAT",{sanitizeValue:function(t){return null===t||void 0===t?t:parseFloat(t)}}),a("STRING"),a("TIME",{_tTimeBegin:0,_timeOut:null,tInit:function(){this.value*=60;var t=this.criteria.field;i[t]||(i[t]=!0,n[t]=60*n[t]||0),this._tTimeBegin=new Date},tRefreshData:function(){var t=new Date;this.value-=Math.ceil((t.getTime()-this._tTimeBegin.getTime())/1e3),this._tTimeBegin=t},tIsFalse:function(t){this.tRefreshData();var e=1e3+1e3*(this.value-n[this.criteria.field]);"equal"===this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"===this.logicalOperator&&(e-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){o.ProActif.run(t)},Math.abs(e))}},"INTEGER"),a("ACTIVITY",{_timeOut:null,tInit:function(){var t=this.criteria.field;this.value*=60,n[t]=n[t]||0},tRefreshData:function(){var t=new Date,e=Math.ceil((t.getTime()-n.lastMove)/1e3);n.activeSince=e>5?n.activeSince:t.getTime(),n[this.criteria.field]=Math.ceil((t.getTime()-n.activeSince)/1e3)},tIsFalse:function(t){var e=1e3+1e3*(this.value-n[this.criteria.field]);"equal"===this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"===this.logicalOperator&&(e-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){o.ProActif.run(t)},Math.abs(e))}},"FLOAT"),a("HTML",null,"STRING"),a("IHTML",null,"INTEGER"),a("FHTML",null,"FLOAT"),a("COUNTRY",null,"STRING"),a("TOWN",null,"STRING"),a("REFERRER",null,"STRING"),a("LANG",null,"STRING"),a("DAY",null,"INTEGER"),a("HOUR",null,"INTEGER"),a("DEVICE",null,"STRING"),s}},{lodash:34}],121:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("lodash");e.exports=function(e,n,a,s,c){var u=t("./action")(e,n,a,s,c);return function(){function t(e){i(this,t),o.assign(this,e),e.channel&&(this.channel=a.getChannel(e.channel)),e.targetingActions&&(this.actions=e.targetingActions.map(u))}return r(t,[{key:"hasButtonAction",value:function(){return o.some(this.actions,{type:"button"})}},{key:"hasActionRequiringDisplay",value:function(t){return o.some(this.actions,function(e){return e.canBeDisplayed(t)})}},{key:"shouldIncrementDisplayCount",value:function(t){return o.chain(this.actions).groupBy("type").map(function(t){return o.head(t)}).some(function(e){return e.canBeDisplayed(t)}).value()}},{key:"shouldIncrementMissedDisplayCount",value:function(t){return!this.hasActionRequiringDisplay(t)&&o.some(this.actions,function(t){return t.isVisible()})}},{key:"isInAbtest",value:function(){return!0===this.abtest_enabled}},{key:"shouldIncrementExecutionCount",value:function(){return o.some(this.actions,function(t){return t.shouldIncrementExecutionCount()})}}]),t}()}},{"./action":116,lodash:34}],122:[function(t,e,n){var i=t("lodash").throttle,r=t("lodash");e.exports=function(t,e,n,o,a){function s(e){a.refresh(e),2==t.chat.status&&t.chat.sendPresence("dnd"),o()}function c(t){var e=document.location.href;f!==e&&(u(e),f=e),setTimeout(c,t)}function u(t){"string"==typeof t?l(function(){e.emit(h,t)}):console.warn("navigate first argument must be a string")}function l(e){var n=t.chaturl+"rpc/maintainVisitorState.php?s="+t.website_id+"&u="+t.vuid+"&lang="+t.curlang;t.$.ajax(n,{dataType:"jsonp",complete:function(){t.config&&(t.flags=t.config.flags,t.vProf=t.config.vProf,a.resetFlags(t.flags),a.resetProfile(t.vProf),delete t.config),e()}})}function d(e){2!=t.chat.status&&r.chain(e).filter({executed:!0}).isEmpty().value()&&t.Templates.hideUI()}var f=document.location.href,h=n.UserNavigated;return{launch:function(t){c(t||50),e.on(h,s),e.on(n.TargetingEngineRan,d)},stop:function(){e.off(h,s)},navigate:i(u,1e3,{trailing:!0,leading:!1})}}},{lodash:34}],123:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(t){return{id:t.id,availability:t.attributes}}function a(t){return i.map(t,o)}function s(t,n){e.ajax({url:t,method:"GET",error:function(){return n.resolve([])},success:function(t){return n.resolve(a(t.data))}})}var c=!1,u=function(e){return t.routing.url+"targeting-rules/available?platform="+t.platform+"&lang="+t.curlang+"&ids[]="+e.join("&ids[]=")};return{checkRulesAvailability:function o(a,l){var d=l||e.Deferred();if(0===a.length)return d.resolve([]),d.promise();if(document.visibilityState&&"hidden"===document.visibilityState)return setTimeout(function(){o(a,d)},1e3),d.promise();var f=i.chain(a).filter({type:"interaction"}).map("id").value(),h=u(f);return c?s(h,d):(c=!0,t.forceDep=r(a),n.find().done(function(){s(h,d)})),d.promise()}}}},{lodash:34}],124:[function(e,n,i){n.exports=function(e,n,i){var r=e.vStats={val:function(t,e){return this["ext_"+t]=e,this},getValue:function(t){return this["ext_"+t]},customData:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&-1!==e.indexOf("ext_")&&(t[e.substr(4).replace(/_/g," ")]=this[e]);return JSON.stringify(t)},getProfile:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&-1===e.indexOf("ext_")&&("navTime"===e&&(this[e]=1e3*Math.round(+new Date/1e3-this.connectionTime),this[e]<0&&(this[e]=3e3)),t[e]=this[e]);return JSON.stringify(t)}},o=function(t){if(t){r.history_id=+t.history_id;for(var e in t)if(t.hasOwnProperty(e)&&"va_"===e.substring(0,3)){var n=e.substring(3),i=t[e];r.val(n,i)}r.transactionProbability=t.transactionProbability,r.isLastEventProbability=t.isLastEventProbability,r.addCartProbability=t.addCartProbability,r.chatAcceptedProbability=t.chatAcceptedProbability}},a=function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])},s=function(o){if(r.actualURI=decodeURI(document.location.href),r.referrer_lastPage=document.referrer,o?(r.referrer_lastPage=r.actualScreen,r.actualScreen=o):r.actualScreen=r.actualURI,r.actualURI.search(/idz-[a-z0-9]{5}$/)>0&&(r.merpLink=!0,r.merpHash=r.actualURI.substr(r.actualURI.indexOf("idz-"))),r.winWidth=n(window).width(),r.winHeight=n(window).height(),r.browserInfo=i.browser+" "+i.version,r.deviceInfo=i.OS,r.userAgent=navigator.userAgent,r.deviceType=i.deviceType,r.vuid=e.vuid,void 0!==window.idzCustomData){for(var a in idzCustomData)null!==idzCustomData[a]&&"undefined"!==idzCustomData[a]&&r.val(a,idzCustomData[a]);var s=idzCustomData.custProfile||"",c=idzCustomData.extID||"";ue=idzCustomData.cust_email||idzCustomData.user_email||"",""===s&&""===c&&""===ue||e.JSONStore.saveData({custProfile:s,extID:c,email:ue})}try{for(var u=0,l=e.insiteCD.length;u<l;u++){var d=e.insiteCD[u],f=n(d.path).text()||n(d.path).val();f&&"INTEGER"===d.type&&(f=parseInt(f.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),f&&"FLOAT"===d.type&&(f=parseFloat(f.replace(/,/g,".").replace(/[^\d.]+/g,""),10));var h=e.Store.get("ext_"+d.field);if("count"!==d.valtype&&"prev"!==d.valtype&&h===t&&(h=f),"current"===d.valtype)f!==t?r["ext_"+d.field]=f:delete r["ext_"+d.field];else if("prev"===d.valtype)h!==t&&(r["ext_"+d.field]=h),f!==t&&(h=f,e.Store.set("ext_"+d.field,h));else if("max"===d.valtype)f!==t&&f>=h&&(h=f,e.Store.set("ext_"+d.field,h)),h!==t&&(r["ext_"+d.field]=h);else if(f!==t&&"min"===d.valtype)f!==t&&f<=h&&(h=f,e.Store.set("ext_"+d.field,h)),h!==t&&(r["ext_"+d.field]=h);else if("count"===d.valtype){if(d.val){var p=!1;"STRING"!==d.type&&f==d.val?p=!0:"STRING"===d.type&&f&&-1!==f.indexOf(d.val)&&(p=!0),p&&(h=h||0,h++,e.Store.set("ext_"+d.field,h))}r["ext_"+d.field]=h||0}}}catch(t){console&&console.log&&console.log(t)}};return a(e.vProf),r.lang=e.curlang,r.activeSince=r.lastMove=(new Date).getTime(),r.history_id=0,o(e.flags),s(),{refresh:s,resetFlags:o,resetProfile:a}}},{}],125:[function(e,n,i){n.exports=function(e,n){return{getAttribute:function(n,i){var r=e.getValue(n);return r===t?i:r},setAttribute:function(t,i){return e.val(t,i),{persist:function(){var e={};e["va_"+t]=i,n.saveData(e)}}}}}},{}]},{},[40,38,39,46,48,53,61,58,62,59,63,64,60,65,66,67,68,69,70,71,72,54,73,74,75,55,56,76,77,57,78,79,80,81,82,83,84,85,86,87,88,89,90,91,41,52,5,3,4,2,1]),e&&(define=e)}();